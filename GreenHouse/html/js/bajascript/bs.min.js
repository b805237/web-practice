/*
 Copyright 2010, Tridium, Inc. All Rights Reserved.
*/
var BaseBajaObj=function(){},baja=new BaseBajaObj;
(function(a,U){U.prototype.equals=function(R){return this===R};U.prototype.valueOf=function(){return this};Function.prototype.$extend=function(R){if(typeof R==="function"){this.prototype=new R;this.$super=R}else{this.prototype=R;this.$super=R.constructor}this.prototype.constructor=this;return this};if(typeof Array.prototype.contains!=="function")Array.prototype.contains=typeof Array.prototype.indexOf==="function"?function(R){return this.indexOf(R)>-1}:function(R){var T;for(T=0;T<this.length;T++)if(this[T]===
R)return true;return false}})(baja,BaseBajaObj);
(function(a,U){a.version="1.0.0.0";var R={},T=null,V={},O={};(function(){function G(u,o){var q=u.name+": ";if(u.stack){u.message&&typeof u.stack==="string"&&u.stack.indexOf(q+u.message)!==0&&o(q+u.message);o(u.stack)}else{u.message?o(q+u.message):o(q+u);try{var b,e;q=arguments;var f=0,g=a.stackTraceLimit||20;if(q.callee&&q.callee.caller){for(b=q.callee.caller;typeof b==="function"&&f<g;){e=b.name;if(!e){e=b.toString().replace(/[\r\n]/g," ");if(e.length>200)e=e.substring(0,200)+"..."}o(" at "+e);b=
b.caller;f++}f>=g&&o("Stack trace limit exceeded ("+g+")")}}catch(p){}}}a.outln=function(u){if(a.isStopping())return this;typeof bajaJsPrint==="function"&&bajaJsPrint(u);return this};a.clearOut=function(){return this};a.error=function(u){if(a.isStopping())return this;u=u instanceof Error?u:Error(u);G(u,a.outln);if(a.isStarted()&&a.isLogClientErrorsInServer()&&u&&!(u instanceof a.comm.ServerError)){var o="";G(u,function(q){o+=q+"\n"});a.comm.error(o)}return this};a.stackTraceLimit=20})();a.fail=function(G){G=
G||Error();a.error(G instanceof Error?G:Error(G))};a.ok=function(){};a.noop=a.ok;var Q=function(G,u){a.strictAllArgs([G,u],[String,Object]);this.$moduleName=G;this.$data=u}.$extend(U);Q.prototype.get=function(G){G=a.objectify(G,"key");G.def=a.def(G.def,null);var u=this.$data.hasOwnProperty(G.key)?this.$data[G.key]:G.def;if(G.args&&typeof u==="string"){var o=G.args;if(o.constructor!==Array)o=[o];u=u.replace(/\{[0-9]+\}/g,function(q){var b=parseInt(q.substring(1,q.length-1),10);return o[b]!==undefined?
o[b]:q})}return u};Q.prototype.getModuleName=function(){return this.$moduleName};(function(){function G(o){if(o.$index<o.$keys.length){++o.$index;return o.$index!==o.$keys.length}else return false}a.strictArg=function(o,q,b){if(o===undefined)if(b)throw Error(b);else{o="Invalid argument (undefined)";if(q)o+=". Expected "+q.name;throw Error(o);}else if(o===null)return o;if(q===undefined||q===null)return o;b=typeof q;if(b==="function"&&(o.constructor===q||o instanceof q))return o;if(b==="string"||b===
"object"){q=a.lt(q);if(!a.hasType(o))throw Error("Invalid argument. Expected Type: "+q);if(!o.getType().is(q))throw Error("Invalid argument. Type "+o.getType()+" is not expected Type: "+q);return o}b=q.name;if(!b&&q.$name)b=q.$name;q=o.constructor.name;if(!q&&o.constructor.$name)q=o.constructor.$name;throw Error("Invalid argument type. Expected "+b+", received "+q+" instead");};a.strictAllArgs=function(o,q){if(q.length!==o.length)throw Error("Invalid number of arguments. Expected "+q.length+", received "+
o.length+" instead.");var b;for(b=0;b<o.length;b++)a.strictArg(o[b],q[b])};a.def=function(o,q){return o===undefined?q:o};var u=a.strictArg;a.throttle=function(o,q){function b(){var r=a.clock.ticks(),F=v-r;if(F<=0)v=r+e;return F}q=a.objectify(q,"interval");var e=q.interval||100,f=q.ok||a.ok,g=q.fail||a.fail,p=q.drop,v=0,B=a.clock.expiredTicket;return function(){var r=this,F=Array.prototype.slice.call(arguments),k,m=b();if(!(m>0&&p)){k=function(){try{f(o.apply(r,F))}catch(A){g(A)}finally{b()}};B.cancel();
if(m<=0)a.runAsync(k);else p||(B=a.clock.schedule(k,m))}}};a.hasType=function(o,q){if(o===null||o===undefined)return false;if(o&&typeof o==="object"&&o instanceof a.Slot)return false;if(typeof o.getType==="function"){if(q)return o.getType().is(q);return true}else return false};a.objectify=function(o,q){if(!(o===undefined||o===null))if(o.constructor===Object)return o;else if(typeof q==="string"){var b={};b[q]=o;return b}return{}};a.lex=function(o){o=a.objectify(o,"module");var q=o.module,b=new a.comm.Callback(o.ok,
o.fail,o.batch),e;if(R.hasOwnProperty(q)){e=R[q];b.ok(e);return e}o=typeof o.ok==="function";try{b.addOk(function(g,p,v){if(T)T.lexicons[q]=v;e=new Q(q,v);R[q]=e;g(e)});a.comm.lex(q,b,o)}catch(f){b.fail(f)}return e};a.runAsync=function(o){a.clock.schedule(o,0)};(function(){function o(b,e,f,g){for(var p;e<f;e++){p=g(b[e],e);if(p!==undefined)return p}}function q(b,e,f){for(var g;b<e;b++){g=f(b);if(g!==undefined)return g}}a.iterate=function(){var b=arguments,e=b[0],f=b[1],g=b[2];b=b[3];var p=Object.prototype.toString.call(e);
if(e===undefined||e===null)throw Error("undefined passed to baja.iterate()");if(p==="[object Array]")switch(arguments.length){case 2:return o(e,0,e.length,f);case 3:return o(e,f,e.length,g);case 4:return o(e,f,g,b)}else if(p==="[object Object]"){if(e instanceof a.Cursor)f=e.each(f);else if(typeof g==="function")a:{for(;e;){var v=f(e);if(v!==undefined){f=v;break a}else e=g(e)}f=void 0}else a:{for(v in e)if(e.hasOwnProperty(v)){g=f(e[v],v);if(g!==undefined){f=g;break a}}f=void 0}return f}else if(p===
"[object Number]")return typeof f==="number"?q(e,f,g):q(0,e,f);else if(p==="[object Arguments]")throw Error("Arguments object not iterable (pass through Array.prototype.slice first)");throw Error(e+" is not iterable");}})();a.Cursor=function(){};a.Cursor.prototype.get=function(){throw Error("Not implemented");};a.Cursor.prototype.each=function(){throw Error("Not implemented");};a.AsyncCursor=function(){}.$extend(a.Cursor);a.SyncCursor=function(){}.$extend(a.Cursor);a.SyncCursor.prototype.next=function(){throw Error("Not implemented");
};a.FilterCursor=function(o,q){a.FilterCursor.$super.apply(this,arguments);this.$context=o;this.$keys=(this.$orderedMap=q)&&q.getKeys();this.$filter=null;this.$index=-1}.$extend(a.SyncCursor);a.FilterCursor.prototype.next=function(){if(this.$filter){do if(!G(this))return false;while(!this.$filter.call(this.$context,this.get()));return true}else return G(this)};a.FilterCursor.prototype.get=function(){var o=this.$index,q=this.$keys;return o===-1||o>=q.length?null:this.$orderedMap.get(q[o])};a.FilterCursor.prototype.getKey=
function(){var o=this.$index,q=this.$keys;return o===-1||o>=q.length?null:q[o]};a.FilterCursor.prototype.getIndex=function(){return this.$index};a.FilterCursor.prototype.each=function(o){u(o,Function);for(var q;this.next();)if(q=o.call(this.$context,this.get(),this.getIndex()))return q};a.FilterCursor.prototype.isEmpty=function(){var o=this.$index;this.$index=-1;var q=this.next();this.$index=o;return!q};a.FilterCursor.prototype.toArray=function(){var o=this.$index,q=[];for(this.$index=-1;this.next();)q.push(this.get());
this.$index=o;return q};a.FilterCursor.prototype.toMap=function(){var o=this.toArray(),q={},b,e;for(e=0;e<o.length;++e){b=o[e];q[b.getName()]=b}return q};a.FilterCursor.prototype.getSize=function(){var o=this.$index,q=0;for(this.$index=-1;this.next();)++q;this.$index=o;return q};a.FilterCursor.prototype.filter=function(o){if(this.$filter){var q=this.$filter;this.$filter=function(b){return q.call(this,b)&&o.call(this,b)}}else this.$filter=o;return this};a.FilterCursor.prototype.first=function(){var o=
this.$index,q=null;this.$index=-1;if(this.next())q=this.get();this.$index=o;return q};a.FilterCursor.prototype.last=function(){for(var o=this.$index,q=null,b=this.$keys.length-2;q===null&&b>=-1;){this.$index=b;if(this.next())q=this.get();b-=2}this.$index=o;return q};a.OrderedMap=function(){a.OrderedMap.$super.apply(this,arguments);this.$map={};this.$array=[]}.$extend(U);a.OrderedMap.prototype.put=function(o,q){if(this.$map.hasOwnProperty(o))this.$map[o]=q;else{this.$map[o]=q;this.$array.push(o)}};
a.OrderedMap.prototype.remove=function(o){u(o,String);var q,b;if(this.$map.hasOwnProperty(o)){q=this.$map[o];delete this.$map[o];for(b=0;b<this.$array.length;++b)if(this.$array[b]===o){this.$array.splice(b,1);break}return q}else return null};a.OrderedMap.prototype.contains=function(o){u(o,String);return this.$map.hasOwnProperty(o)};a.OrderedMap.prototype.get=function(o){return this.$map.hasOwnProperty(o)?this.$map[o]:null};a.OrderedMap.prototype.rename=function(o,q){u(o,String);u(q,String);if(!this.contains(o))return false;
if(this.contains(q))return false;var b=this.$map[o];delete this.$map[o];this.$map[q]=b;for(b=0;b<this.$array.length;++b)if(this.$array[b]===o){this.$array[b]=q;break}return true};a.OrderedMap.prototype.getIndex=function(o){u(o,String);if(this.$map.hasOwnProperty(o)){var q;for(q=0;q<this.$array.length;++q)if(this.$array[q]===o)return q}return-1};a.OrderedMap.prototype.getFromIndex=function(o){u(o,Number);o=this.$array[o];if(typeof o==="string")return this.$map[o];return null};a.OrderedMap.prototype.getKeys=
function(){return this.$array.slice(0)};a.OrderedMap.prototype.getSize=function(){return this.$array.length};a.OrderedMap.prototype.sort=function(o){u(o,Function);this.$array.sort(o)};a.OrderedMap.prototype.getCursor=function(o,q){q=q||a.FilterCursor;return new q(o,this)}})();var y=a.strictArg,K=a.strictAllArgs,C=a.def,I=a.objectify;(function(){a.clock=new U;var G=function(){this.$id=-1}.$extend(U);G.prototype.cancel=function(){clearTimeout(this.$id);delete V[this.$id.toString()];this.$id=-1};G.prototype.isExpired=
function(){return this.$id===-1};var u=function(){u.$super.apply(this,arguments)}.$extend(G);u.prototype.cancel=function(){clearInterval(this.$id);delete O[this.$id.toString()];this.$id=-1};a.clock.ticks=function(){return(new Date).valueOf()};a.clock.expiredTicket=new G;a.clock.schedule=function(o,q){K([o,q],[Function,Number]);if(a.isStopped())return this.expiredTicket;var b=new G;b.$id=setTimeout(function(){delete V[b.$id.toString()];b.$id=-1;o.call(b)},q);return V[b.$id.toString()]=b};a.clock.schedulePeriodically=
function(o,q){K([o,q],[Function,Number]);if(a.isStopped())return this.expiredTicket;var b=new u;b.$id=setInterval(function(){o.call(b)},q);return O[b.$id.toString()]=b}})();(function(){var G=false,u=false,o=false,q=null,b=null,e="",f="",g="station:|slot:/",p="",v=false,B=null;a.isStarted=function(){return G};a.isStopped=function(){return u};a.isStopping=function(){return o};a.started=function(r){y(r,Function);if(G)try{r.call(a)}catch(F){a.error(F)}else{q||(q=[]);q.push(r)}};a.preStop=function(r){y(r,
Function);if(u)try{r.call(a)}catch(F){a.error(F)}else{b||(b=[]);b.push(r)}};a.start=function(r){r=I(r,"started");var F=r.started;r.started=function(){G=true;if(q){var k;for(k=0;k<q.length;++k)try{q[k].call(a)}catch(m){a.error(m)}q=null}if(typeof F==="function")try{F()}catch(A){a.error(A)}};a.comm.start(r);a.registry.register(JSON.parse(a.$ctypes));delete a.$ctypes;B=a.registry.loadFromStorage();typeof r.preStart==="function"&&r.preStart()};a.save=function(){T&&a.registry.saveToStorage(T)};a.stop=
function(r){try{if(!u){o=true;a.save();r=I(r,"stopped");typeof r.preStop==="function"&&a.preStop(r.preStop);if(b){var F;for(F=0;F<b.length;++F)try{b[F].call(a)}catch(k){a.error(k)}b=null}for(var m in V)V.hasOwnProperty(m)&&V[m].cancel();for(m in O)O.hasOwnProperty(m)&&O[m].cancel();V={};O={};a.comm.stop(r)}}finally{u=true}};a.getUserName=function(){return e};a.getLanguage=function(){return f};a.getUserHome=function(){return a.Ord.make(g)};a.getTimeFormatPattern=function(){return p};a.isLogClientErrorsInServer=
function(){return v};a.initFromSysProps=function(r){e=r.userName;f=r.lang;g=r.userHome;p=r.timeFormat;v=r.logClientErrors||false;if(r.enableWebStorage){if(B)if(B.lang!==r.lang||B.version!==a.version||B.regLastBuildTime!==r.regLastBuildTime){B=null;a.registry.clearStorage()}B||(B={lang:r.lang,version:a.version,regLastBuildTime:r.regLastBuildTime,types:{},lexicons:{}});T=B;B=null;a.registry.register(T.types);for(var F in T.lexicons)if(T.lexicons.hasOwnProperty(F))R[F]=new Q(F,T.lexicons[F])}else{B=
null;a.registry.clearStorage()}}})();(function(){function G(u,o,q,b,e){K([o,q,b,e],[Array,Boolean,a.comm.Callback,Boolean]);var f=[],g,p;for(p=0;p<o.length;++p)if(u.$types.hasOwnProperty(o[p])){g=u.$types[o[p]];if(q&&(g.isComplex()||g.isFrozenEnum())&&!g.hasContract())f.push(o[p])}else f.push(o[p]);var v=null;b.addOk(function(B,r,F){v=[];F!==undefined&&u.register(F,true);for(r=0;r<o.length;++r)v.push(u.$types[o[r]]);B(v)});f.length>0?a.comm.loadTypes(f,q,b,e):b.ok();return v}a.$=function(u){var o=
a.lt(u,true);if(!o)throw Error("Type '"+u+"' not found");if(arguments.length===1)return o.getInstance();else{var q=Array.prototype.slice.call(arguments);q.shift();return o.getInstance.apply(o,q)}};a.importTypes=function(u){u=I(u,"typeSpecs");var o=new a.comm.Callback(u.ok,u.fail,u.batch);try{return G(a.registry,u.typeSpecs,true,o,u.ok!==undefined)}catch(q){o.fail(q)}return null};a.lt=function(u,o){if(a.registry.$types.hasOwnProperty(u))return a.registry.$types[u];else{o=C(o,false);var q=new a.comm.Callback;
try{var b=G(a.registry,[u],o,q,false);if(b!==null)return b[0]}catch(e){q.fail(e)}return null}};(function(){function u(f){if(!f.isFrozenEnum())throw Error("Type must be a FrozenEnum");if(!f.hasContract()){f.loadContract();if(!f.hasContract())throw Error("Unable to load the FrozenEnum Contract");}}var o={},q={},b={},e=function(f,g,p,v,B,r,F,k,m,A,n,w,z,D,c,i,s,x,E){this.$typeSpec=f;this.$superType=g;this.$isAbstract=p;this.$isInterface=v;this.$interfaces=B;this.$contract=r;this.$isTransient=F;this.$iconStr=
k;this.$isValue=m;this.$isSimple=A;this.$isSingleton=n;this.$isNumber=w;this.$isComplex=z;this.$isComponent=D;this.$isLink=c;this.$isAction=i;this.$isTopic=s;this.$isFrozenEnum=x;this.$isOrdScheme=E}.$extend(U);e.prototype.equals=function(f){if(f===undefined||f===null)return false;if(f.constructor!==e)return false;return f.$typeSpec===this.$typeSpec};e.prototype.getModuleName=function(){return this.$typeSpec.split(":")[0]};e.prototype.getTypeName=function(){return this.$typeSpec.split(":")[1]};e.prototype.getTypeSpec=
function(){return this.$typeSpec};e.prototype.getInstance=function(f){var g=this.getTypeSpec();if(this.$isInterface)throw Error("Cannot call 'getInstance' on an Interface Type: "+g);if(this.$isAbstract)throw Error("Cannot call 'getInstance' on an Abstract Type: "+g);if((this.isSimple()||this.isSingleton())&&b.hasOwnProperty(g))if(arguments.length===0)return b[g].DEFAULT;else{g=b[g].DEFAULT;return g.make.apply(g,arguments)}if(q.hasOwnProperty(g))if(arguments.length===0)return q[g];else{g=q[g];return g.make.apply(g,
arguments)}for(var p=this,v;p!==null;)if(b.hasOwnProperty(p.getTypeSpec())){v=b[p.getTypeSpec()];break}else p=p.$superType;if(p===null)throw Error("Could not find JS Constructor for Type: "+g);if(typeof v!=="function")throw Error("Fatal error, could not create instance of Type: "+g);p=new v(f);if(g!==p.getType().getTypeSpec()){var B=this;p.getType=function(){return B}}if(this.isComplex()||this.isFrozenEnum()){if(this.isComplex())a.bson.decodeComplexContract(this,p);else if(this.isFrozenEnum()){this.hasContract()||
this.loadContract();v=this.getOrdinals();if(v.length>0)p.$ordinal=v[0]}p.contractCommitted(f)}if(this.isSimple()){q[g]=p;if(arguments.length>0)p=p.make.apply(p,arguments)}return p};e.prototype.is=function(f){if(f.constructor===String)f=a.lt(f);if(this.$typeSpec===f.$typeSpec)return true;var g;if(f.$isInterface)for(g=0;g<this.$interfaces.length;++g){if(this.$interfaces[g].is(f))return true}else if(f.$isSimple&&!this.$isSimple)return false;else if(f.$isComponent&&!this.$isComponent)return false;else if(f.$isComplex&&
!this.$isComplex)return false;if(this.$superType)return this.$superType.is(f);return false};e.prototype.isValue=function(){return this.$isValue};e.prototype.isSimple=function(){return this.$isSimple};e.prototype.isSingleton=function(){return this.$isSingleton};e.prototype.isNumber=function(){return this.$isNumber};e.prototype.isComplex=function(){return this.$isComplex};e.prototype.isComponent=function(){return this.$isComponent};e.prototype.isStruct=function(){return this.isComplex()&&!this.isComponent()};
e.prototype.isLink=function(){return this.$isLink};e.prototype.isAction=function(){return this.$isAction};e.prototype.isTopic=function(){return this.$isTopic};e.prototype.isFrozenEnum=function(){return this.$isFrozenEnum};e.prototype.isOrdScheme=function(){return this.$isOrdScheme};e.prototype.getSuperType=function(){return this.$superType};e.prototype.getInterfaces=function(){return this.$interfaces.slice(0)};e.prototype.isAbstract=function(){return this.$isAbstract};e.prototype.isInterface=function(){return this.$isInterface};
e.prototype.isTransient=function(){return this.$isTransient};e.prototype.toString=function(){return this.getTypeSpec()};e.prototype.getContract=function(){return this.$contract};e.prototype.hasContract=function(){return this.$contract!==null};e.prototype.loadContract=function(f){f=I(f);var g=new a.comm.Callback(f.ok,f.fail,f.batch);try{if(!(this.isComplex()||this.isFrozenEnum())||this.isInterface()||this.hasContract())g.ok();else{g.addOk(function(v,B,r){var F;B=[];for(F in r)if(r.hasOwnProperty(F))a.registry.$types.hasOwnProperty(F)||
B.push(F);B.length>0&&G(a.registry,B,false,new a.comm.Callback,false);for(F in r)if(r.hasOwnProperty(F))if(a.registry.$types.hasOwnProperty(F)){a.registry.$types[F].$contract=r[F];if(T&&T.types.hasOwnProperty(F))T.types[F].c=r[F]}v()});a.comm.loadContract(this.getTypeSpec(),g,f.ok!==undefined)}}catch(p){g.fail(p)}};e.prototype.getIcon=function(){if(this.$icon)return this.$icon;return this.$icon=this.$iconStr?a.Icon.DEFAULT.decodeFromString(this.$iconStr):a.Icon.getStdObjectIcon()};e.prototype.getOrdinals=
function(){u(this);var f=[],g;for(g=0;g<this.$contract.length;++g)f.push(this.$contract[g].o);return f};e.prototype.isOrdinal=function(f){u(this);var g=this.$contract,p;if(this.$byOrdinal===undefined){this.$byOrdinal={};for(p=0;p<g.length;++p)this.$byOrdinal[g[p].o]={o:g[p].o,t:g[p].t,dt:g[p].dt}}return this.$byOrdinal.hasOwnProperty(f)};e.prototype.getTag=function(f){u(this);if(this.isOrdinal(f))return this.$byOrdinal[f].t;else throw Error("No tag for ordinal: "+f+" in: "+this.getTypeSpec());};e.prototype.getDisplayTag=
function(f){u(this);if(this.isOrdinal(f))return this.$byOrdinal[f].dt;else throw Error("No display tag for ordinal: "+f+" in: "+this.getTypeSpec());};e.prototype.isTag=function(f){u(this);var g=this.$contract,p;if(this.$byTag===undefined){this.$byTag={};for(p=0;p<g.length;++p)this.$byTag[g[p].t]={o:g[p].o,t:g[p].t,dt:g[p].dt}}return this.$byTag.hasOwnProperty(f)};e.prototype.tagToOrdinal=function(f){u(this);if(this.isTag(f))return this.$byTag[f].o;else throw Error("No ordinal tag for tag: "+f+" in: "+
this.getTypeSpec());};e.prototype.getRange=function(){u(this);if(this.$range===undefined)this.$range=a.EnumRange.make(this);return this.$range};e.prototype.getFrozenEnum=function(f){u(this);var g=0;if(typeof f==="string")g=this.tagToOrdinal(f);else if(typeof f==="number"&&this.isOrdinal(f))g=f;else throw Error("Invalid argument for FrozenEnum creation");if(this.$enums===undefined)this.$enums={};if(this.$enums.hasOwnProperty(g))f=this.$enums[g];else{f=this.getInstance();if(f.getOrdinal()!==g){var p=
new f.constructor;p.getType=f.getType;f=p;f.$ordinal=g}this.$enums[g]=f}return f};e.prototype.hasConstructor=function(){return b.hasOwnProperty(this.$typeSpec)};Function.prototype.registerType=function(f){y(f,String);if(typeof this!=="function")throw Error("Can only loadType on a Function Constructor: "+f);b[f]=this;var g;this.prototype.getType=function(){g||(g=a.lt(f));return g};return this};a.registry=new U;a.registry.$types={"baja:Object":new e("baja:Object",null,true,false,[],null,false,null,
false,false,false,false,false,false,false,false,false,false,false),"baja:Interface":new e("baja:Interface",null,true,true,[],null,false,null,false,false,false,false,false,false,false,false,false,false,false)};a.registry.register=function(f,g){if(f!==undefined){var p=a.lt("baja:Interface"),v=a.lt("baja:Object"),B,r,F={};for(B in f)if(f.hasOwnProperty(B)){r=f[B];if(this.$types.hasOwnProperty(B)){if(r.c){this.$types[B].$contract=r.c;if(T&&T.types.hasOwnProperty(B))T.types[B].c=r.c}}else{this.$types[B]=
new e(B,null,r.a||false,r.i||false,[],C(r.c,null),r.t||false,C(r.ic,null),r.isv||false,r.iss||false,r.isg||false,r.isn||false,r.isx||false,r.isc||false,r.isl||false,r.isa||false,r.ist||false,r.ise||false,r.os||false);F[B]=r;if(g&&T)r.t||(T.types[B]=r)}}var k,m;for(B in F)if(F.hasOwnProperty(B)){r=F[B];m=this.$types[B];if(!(m===p||m===v)){if(r.it&&r.it.length>0)for(k=0;k<r.it.length;++k)m.$interfaces.push(a.lt(r.it[k]));else r.i&&m.$interfaces.push(p);if(!r.i)m.$superType=r.p?a.lt(r.p):v}}for(B in F)if(F.hasOwnProperty(B)){r=
F[B];m=a.lt(B);if(!m.isAbstract()){if(b.hasOwnProperty(B)){p=b[B];if(m.isSimple()){if(p.DEFAULT===undefined)throw Error("Concrete Simple implementations must define a DEFAULT instance argument on the Constructor: "+B);if(typeof p.DEFAULT.make!=="function")throw Error("Concrete Simple implementations must define a make method: "+B);if(typeof p.DEFAULT.decodeFromString!=="function")throw Error("Concrete Simple implementations must define a decodeFromString method: "+B);if(typeof p.DEFAULT.encodeToString!==
"function")throw Error("Concrete Simple implementations must define a encodeToString method: "+B);}if(m.isSingleton())if(p.DEFAULT===undefined)throw Error("Concrete Singletons must define a DEFAULT instance argument on the Constructor: "+B);}if(r.os&&m.isOrdScheme())o[r.os]=m}}}};a.registry.getOrdScheme=function(f){return C(o[f],null)};a.registry.hasType=function(f){return this.$types.hasOwnProperty(f)};a.registry.loadType=a.lt;a.registry.loadTypesWithContract=a.importTypes;a.registry.getConcreteTypes=
function(f){f=I(f);var g;if(f.type)g=f.type.toString();a.strictAllArgs([g,f.ok],[String,Function]);f=new a.comm.Callback(f.ok,f.fail,f.batch);f.addOk(function(p,v,B){v=B.s;a.registry.register(B.t,true);var r=[];a.iterate(v,function(F){r.push(a.lt(F))});p(r)});a.comm.getConcreteTypes(g,f)};a.registry.clearStorage=function(){};a.registry.saveToStorage=function(){};a.registry.loadFromStorage=function(){return null}})()})()})(baja,BaseBajaObj);
(function(a,U){function R(b){function e(){var g=new Q(function(){a.comm.reconnect()},function(p){p.noReconnect||(p.delayReconnect?a.clock.schedule(e,1E3):a.comm.reconnect())});g.addReq("sys","hello",{});g.commit()}if(!a.isStopping()){C=null;try{u(b)}catch(f){}I.cancel();b.noReconnect||e()}}function T(b,e,f){if(!(e>=b.$queue.length)){var g=null,p=b.$queue[e].m,v=b.$queue[e].cb,B,r;try{v.$batchNext=function(){v.$batchNext=a.noop;T(b,++e,f)};if(!p)try{v.ok();return}catch(F){v.fail(F)}if(p.t!=="rt")v.ok();
else{for(B=0;B<f.m.length;++B)if(f.m[B].r===p.r){g=f.m[B];break}if(g!==null)if(g.t==="rp")try{v.ok(g.b)}catch(k){v.fail(k)}else if(g.t==="e"){r=new a.comm.BoxError(g.et,g.b);if(g.cf){r.noReconnect=true;r.sessionLimit=g.et==="BoxSessionLimitError";r.fatalFault=g.et==="BoxFatalFaultError";r.nonOperational=g.et==="BoxNonOperationalError";R(r)}v.fail(r)}else v.fail(Error("Fatal error reading BOX Frame: "+JSON.stringify(f)));else v.fail(Error("BOX Error: response not found for request: "+JSON.stringify(p)))}}catch(m){a.error(m)}}}
function V(b,e,f){if(!(e>=b.$queue.length)){var g=b.$queue[e].cb;try{g.$batchNext=function(){g.$batchNext=a.noop;V(b,++e,f)};g.fail(f)}catch(p){a.error(p)}}}var O=a.strictArg,Q;a.comm=new U;var y=0,K=2500,C=null,I=a.clock.expiredTicket,G={},u=function(b){a.outln("Comms failed: "+b.name);b.noReconnect||a.outln("Attempting reconnect...")};a.comm.setCommFailCallback=function(b){O(b,Function);u=b};a.comm.reconnect=function(){throw Error("baja.comm.reconnect not implemented");};a.comm.ServerError=function(b){this.name=
"ServerError";this.message=b||"Default Message"}.$extend(Error);a.comm.BoxError=function(b,e){this.name=b;this.message=e||"Default Message"}.$extend(a.comm.ServerError);a.comm.BoxFrame=function(b){var e=[],f;for(f=0;f<b.length;++f)b[f].m&&e.push(b[f].m);this.$body={p:"box",v:1,m:e}};a.comm.BoxFrame.prototype.toString=function(){return JSON.stringify(this.$body)};a.comm.BoxFrame.prototype.isEmpty=function(){return this.$body.m.length===0};a.comm.BoxFrame.prototype.send=function(){throw Error("baja.comm.BoxFrame#send not implemented");
};a.comm.Batch=function(){this.$queue=[];this.$committed=false;this.$async=true}.$extend(U);a.comm.Batch.prototype.addReq=function(b,e,f,g){if(this.$committed)throw Error("Cannot add request to a commited Batch!");this.$queue.push({m:{r:y++,t:"rt",c:b,k:e,b:f},cb:g})};a.comm.Batch.prototype.addCallback=function(b,e){if(this.$committed)throw Error("Cannot add callback to a commited Batch!");this.$queue.push({m:null,cb:new Q(b,e)})};var o=function(b){if(!a.isStopped()){if(this.$committed)throw Error("Cannot commit batch that's already committed!");
this.$committed=true;this.$async=b;var e=new a.comm.BoxFrame(this.$queue);e.isEmpty()?T(this,0):e.send(b,this)}};a.comm.Batch.prototype.commitSync=function(){o.call(this,false)};a.comm.Batch.prototype.commit=function(){o.call(this,true)};a.comm.Batch.prototype.getMessages=function(){return this.$queue.slice(0)};a.comm.Batch.prototype.ok=function(b){if(!a.isStopped()){b=JSON.parse(b);b.p!=="box"?this.fail("Invalid BOX Frame. Protocol is not BOX"):T(this,0,b)}};a.comm.Batch.prototype.fail=function(b){a.isStopping()||
V(this,0,b)};a.comm.Batch.prototype.isEmpty=function(){return this.$queue.length===0};a.comm.Batch.prototype.isCommitted=function(){return this.$committed};a.comm.Batch.prototype.isAsync=function(){return this.$async};a.comm.Callback=function(b,e,f){var g=this;a.comm.Callback.$super.apply(g,arguments);b=b||a.ok;e=e||a.fail;g.$batch=f||new a.comm.Batch;g.$batchNext=a.noop;g.ok=function(){try{b.apply(this,arguments)}finally{g.$batchNext()}};g.fail=function(){try{e.apply(this,arguments)}finally{g.$batchNext()}};
g.$orgBatchDef=typeof f==="object"}.$extend(U);a.comm.Callback.prototype.addOk=function(b){var e=this.ok,f=this.fail;this.ok=function(){var g=Array.prototype.slice.call(arguments);g.splice(0,0,e,f);b.apply(this,g)}};a.comm.Callback.prototype.addFail=function(b){var e=this.ok,f=this.fail;this.fail=function(){var g=Array.prototype.slice.call(arguments);g.splice(0,0,e,f);b.apply(this,g)}};a.comm.Callback.prototype.isOrgBatchDef=function(){return this.$orgBatchDef};a.comm.Callback.prototype.addReq=function(b,
e,f){this.$batch.addReq(b,e,f,this)};a.comm.Callback.prototype.autoCommit=function(){this.isOrgBatchDef()||this.commit()};a.comm.Callback.prototype.commit=function(){this.$batch.commit()};a.comm.Callback.prototype.getBatch=function(){return this.$batch};a.comm.Callback.prototype.commitSync=function(){this.$batch.commitSync()};Q=a.comm.Callback;var q=function(b){this.$id=b};q.make=function(b){b.addReq("ssession","make",{})};q.prototype.addReq=function(b,e){return q.addReq(b,e,{id:this.$id})};q.addReq=
function(b,e,f){e.addReq("ssession",b,f);return f};q.addEventHandler=function(b,e){G[b]=e};q.removeEventHandler=function(b){G.hasOwnProperty(b)&&delete G[b]};q.findEventHandler=function(b){return G.hasOwnProperty(b)?G[b]:null};a.comm.makeServerSession=function(b){b.addOk(function(e,f,g){try{C=new q(g);e()}finally{I=a.clock.schedule(a.comm.poll,K)}});b.addFail(function(e,f,g){try{f(g)}finally{R(g)}});q.make(b);b.autoCommit()};a.comm.makeServerHandler=function(b,e,f,g,p,v){if(C)v=C.addReq("makessc",
p);else if(v)v=q.addReq("makessc",p,{});else throw Error("ServerSession not currently available!");q.addEventHandler(b,g);v.scid=b;v.scts=e;v.scarg=f;p.autoCommit()};a.comm.removeServerHandler=function(b,e){if(!C)throw Error("ServerSession not currently available!");q.removeEventHandler(b);C.addReq("removessc",e).scid=b;e.autoCommit()};a.comm.serverHandlerCall=function(b,e,f,g,p){if(C)p=C.addReq("callssc",g);else if(p)p=q.addReq("callssc",g,{});else throw Error("ServerSession not currently available!");
p.scid=b;p.sck=e;p.scarg=f;g.autoCommit()};a.comm.poll=function(b){function e(){if(C){I.cancel();I=a.clock.schedule(a.comm.poll,K)}}I.cancel();if(!a.isStopping()){var f=false;if(!b){b=new Q(a.ok,function(g){a.error(g)});f=true}if(!C)throw Error("No Server Session available");b.addOk(function(g,p,v){if(!a.isStopping()){var B=function(){try{var m;for(m=0;m<v.length;++m){var A=q.findEventHandler(v[m].scid);typeof A==="function"&&A(v[m].evs)}g()}finally{e()}},r=function(m){try{p(m)}finally{e()}},F=a.bson.scanForUnknownTypes(v);
if(F.length>0){var k=new a.comm.Batch;a.importTypes({typeSpecs:F,ok:B,fail:r,batch:k});f?k.commit():k.commitSync()}else B()}});b.addFail(function(g,p,v){f?a.clock.schedule(function(){try{p(v)}finally{R(v)}},1E3):p(v)});C.addReq("pollchgs",b);b.autoCommit()}};a.comm.start=function(b){var e=b.started||a.ok,f=b.typeSpecs||[],g=new a.comm.Batch;u=b.commFail||u;(new Q(function(p){a.initFromSysProps(p)},a.fail,g)).addReq("sys","props",{});f.contains("baja:Station")||f.push("baja:Station");f.contains("baja:Link")||
f.push("baja:Link");f.contains("baja:StatusValue")||f.push("baja:StatusValue");b.navFile&&a.nav.navfile.load({batch:g});a.importTypes({typeSpecs:f,ok:a.ok,fail:a.fail,batch:g});a.comm.makeServerSession(new Q(a.ok,a.fail,g));a.station.init(g);g.addCallback(e);g.commit()};a.comm.stop=function(b){b=b.stopped||a.ok;I.cancel();if(C){b=new Q(b,a.ok);C.addReq("del",b);b.commitSync();C=null}};a.comm.loadTypes=function(b,e,f,g){if(typeof b==="string")b=[b];f.addReq("reg","loadTypes",{t:b,ec:e});f.isOrgBatchDef()||
(g?f.commit():f.commitSync())};a.comm.loadContract=function(b,e,f){e.addReq("reg","loadContract",b);e.isOrgBatchDef()||(f?e.commit():e.commitSync())};a.comm.getConcreteTypes=function(b,e){e.addReq("reg","getConcreteTypes",b);e.autoCommit()};a.comm.resolve=function(b,e,f,g){b={o:b.toString(),bo:e.getNavOrd().toString()};if(g=g.cursor)b.c={of:g.offset,lm:g.limit};f.addReq("ord","resolve",b);f.autoCommit()};a.comm.cursor=function(b,e,f){b.of=f.offset;b.lm=f.limit;e.addReq("ord","cursor",b);e.autoCommit()};
a.comm.lex=function(b,e,f){e.addReq("sys","lex",b);e.isOrgBatchDef()||(f?e.commit():e.commitSync())};a.comm.navFile=function(b){b.addReq("sys","navFile",{});b.autoCommit()};a.comm.error=function(b){var e=new Q(a.ok,a.ok);e.addReq("sys","error",b);e.commit()}})(baja,BaseBajaObj);(function(){baja.$ctypes='{"baja:IBoolean":{"i":true,"it":["baja:IEnum"]},"baja:IEnum":{"i":true,"it":[]},"baja:Interface":{"i":true},"baja:IComparable":{"i":true,"it":[]},"baja:IDate":{"i":true,"it":[]},"baja:IMixIn":{"i":true,"it":["baja:IAgent"]},"baja:IAgent":{"i":true,"it":[]},"baja:INumeric":{"i":true,"it":[]},"baja:IService":{"i":true,"it":[]},"baja:ITime":{"i":true,"it":[]},"baja:IPropertyContainer":{"i":true,"it":[]},"baja:IPropertySpace":{"i":true,"it":[]},"baja:AbsTime":{"isv":true,"iss":true,"it":["baja:IDate","baja:ITime","baja:IComparable","baja:IDataValue"],"p":"baja:Simple"},"baja:IDataValue":{"i":true,"it":["baja:IEncodable"]},"baja:IEncodable":{"i":true,"it":[]},"baja:Simple":{"isv":true,"iss":true,"a":true,"it":["baja:IEncodable"],"p":"baja:Value"},"baja:Value":{"isv":true,"a":true},"baja:Object":{"a":true},"baja:Blob":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:BitString":{"isv":true,"iss":true,"a":true,"p":"baja:Simple"},"baja:Boolean":{"isv":true,"iss":true,"it":["baja:IBoolean","baja:IDataValue"],"p":"baja:Enum"},"baja:Enum":{"isv":true,"iss":true,"a":true,"it":["baja:IEnum","baja:IComparable"],"p":"baja:Simple"},"baja:Complex":{"c":[],"isv":true,"isx":true,"a":true,"p":"baja:Value"},"baja:Component":{"c":[],"isv":true,"isx":true,"isc":true,"it":["baja:ISpaceNode","baja:IProtected","baja:ICategorizable","baja:IPropertyContainer"],"p":"baja:Complex"},"baja:IProtected":{"i":true,"it":["baja:ICategorizable"]},"baja:ICategorizable":{"i":true,"it":[]},"baja:ISpaceNode":{"i":true,"it":["baja:INavNode"]},"baja:INavNode":{"i":true,"it":[]},"baja:ComponentEvent":{"c":[],"isv":true,"isx":true,"p":"baja:Struct"},"baja:Struct":{"c":[],"isv":true,"isx":true,"p":"baja:Complex"},"baja:ComponentEventMask":{"isv":true,"iss":true,"p":"baja:BitString"},"baja:Date":{"isv":true,"iss":true,"it":["baja:IDate","baja:IComparable"],"p":"baja:Simple"},"baja:Double":{"isv":true,"iss":true,"isn":true,"p":"baja:Number"},"baja:Number":{"isv":true,"iss":true,"isn":true,"a":true,"it":["baja:IComparable","baja:INumeric","baja:IDataValue"],"p":"baja:Simple"},"baja:DynamicEnum":{"isv":true,"iss":true,"it":["baja:IDataValue"],"p":"baja:Enum"},"baja:EnumRange":{"isv":true,"iss":true,"it":["baja:IDataValue"],"p":"baja:Simple"},"baja:Facets":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Float":{"isv":true,"iss":true,"isn":true,"p":"baja:Number"},"baja:FrozenEnum":{"isv":true,"iss":true,"ise":true,"a":true,"p":"baja:Enum"},"baja:Icon":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Integer":{"isv":true,"iss":true,"isn":true,"p":"baja:Number"},"baja:Long":{"isv":true,"iss":true,"isn":true,"p":"baja:Number"},"baja:RelTime":{"isv":true,"iss":true,"it":["baja:IDataValue","baja:IComparable"],"p":"baja:Simple"},"baja:Singleton":{"isg":true,"a":true},"baja:String":{"isv":true,"iss":true,"it":["baja:IComparable","baja:IDataValue"],"p":"baja:Simple"},"baja:Time":{"isv":true,"iss":true,"it":["baja:ITime","baja:IComparable"],"p":"baja:Simple"},"baja:Topic":{"c":[],"isv":true,"isx":true,"ist":true,"a":true,"p":"baja:Struct"},"baja:Vector":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:Component"},"baja:CategoryMask":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:OrdToCategoryMap":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:ICollection":{"i":true,"it":[]},"baja:IList":{"i":true,"it":["baja:ICollection"]},"baja:ITable":{"i":true,"it":["baja:IList"]},"baja:IDataRecoveryService":{"i":true,"it":["baja:IService"]},"baja:IDataRecoverySource":{"i":true,"it":[]},"baja:IDataRecoverySourceService":{"i":true,"it":["baja:IService"]},"baja:IDataTable":{"i":true,"it":["baja:ITable"]},"baja:ILicensed":{"i":true,"it":[]},"baja:ISession":{"i":true,"it":["baja:INavNode"]},"baja:Host":{"a":true,"p":"baja:NavContainer"},"baja:NavContainer":{"a":true,"it":["baja:INavNode"]},"baja:IpScheme":{"isg":true,"os":"ip","p":"baja:OrdScheme"},"baja:OrdScheme":{"isg":true,"a":true,"p":"baja:Singleton"},"baja:IpHost":{"p":"baja:Host"},"baja:LocalHost":{"it":["baja:ISession"],"p":"baja:IpHost"},"baja:LocalScheme":{"isg":true,"os":"local","p":"baja:OrdScheme"},"baja:Ord":{"isv":true,"iss":true,"it":["baja:IComparable","baja:IAlias"],"p":"baja:Simple"},"baja:IAlias":{"i":true,"it":[]},"baja:StationSessionScheme":{"isg":true,"a":true,"p":"baja:OrdScheme"},"baja:OrdList":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:ModuleScheme":{"isg":true,"os":"module","p":"baja:OrdScheme"},"baja:Session":{"a":true,"it":["baja:ISession"],"p":"baja:NavContainer"},"baja:ServiceScheme":{"isg":true,"os":"service","p":"baja:OrdScheme"},"baja:SlotScheme":{"isg":true,"os":"slot","p":"baja:OrdScheme"},"baja:ViewScheme":{"isg":true,"os":"view","p":"baja:OrdScheme"},"baja:ProxyComponentSpace":{"a":true,"p":"baja:ComponentSpace"},"baja:ComponentSpace":{"it":["baja:ICategorizable","baja:IProtected","baja:IPropertySpace","baja:IDataRecoverySource"],"p":"baja:Space"},"baja:Space":{"a":true,"it":["baja:IAgent"],"p":"baja:NavContainer"},"baja:IJobService":{"i":true,"it":[]},"baja:NavRoot":{"p":"baja:NavContainer"},"baja:RootScheme":{"isg":true,"os":"root","p":"baja:OrdScheme"},"baja:NavFileSpace":{"p":"baja:Space"},"baja:NavFileNode":{"p":"baja:NavContainer"},"baja:SpaceScheme":{"isg":true,"a":true,"p":"baja:OrdScheme"},"baja:HandleScheme":{"isg":true,"os":"h","p":"baja:OrdScheme"},"baja:Exporter":{"c":[],"isv":true,"isx":true,"isc":true,"a":true,"it":["baja:IAgent"],"p":"baja:Component"},"baja:IStatus":{"i":true,"it":[]},"baja:IStatusValue":{"i":true,"it":["baja:IStatus"]},"baja:Status":{"isv":true,"iss":true,"it":["baja:IStatus"],"p":"baja:BitString"},"baja:ICredentials":{"i":true,"it":[]},"baja:IUserCredentials":{"i":true,"it":["baja:ICredentials"]},"baja:Password":{"isv":true,"iss":true,"it":["baja:IComparable"],"p":"baja:Simple"},"baja:PasswordHistory":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Permissions":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:PermissionsMap":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:TimeZone":{"isv":true,"iss":true,"it":["baja:IDataValue"],"p":"baja:Simple"},"baja:Dimension":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Unit":{"isv":true,"iss":true,"it":["baja:IDataValue"],"p":"baja:Simple"},"baja:BitSet":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:ClassSpec":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:DaysOfWeekBits":{"isv":true,"iss":true,"p":"baja:BitString"},"baja:EnumSet":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:FacetsMap":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Folder":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:Component","ic":"module://icons/x16/folder.png"},"baja:Format":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:NameList":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:NameMap":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:Notification":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:Component"},"baja:ServiceContainer":{"c":[],"isv":true,"isx":true,"isc":true,"it":["baja:IService"],"p":"baja:Component","ic":"module://icons/x16/gears.png"},"baja:TypeSpec":{"isv":true,"iss":true,"it":["baja:IComparable"],"p":"baja:Simple"},"baja:Uuid":{"isv":true,"iss":true,"it":["baja:IComparable"],"p":"baja:Simple"},"baja:Worker":{"c":[],"isv":true,"isx":true,"isc":true,"a":true,"p":"baja:Component"},"baja:WsAnnotation":{"isv":true,"iss":true,"p":"baja:Simple"},"baja:IFormatPropertyHandler":{"i":true,"it":[]},"baja:VirtualComponent":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:Component","ic":"module://icons/x16/object.png\\nmodule://icons/x16/badges/ghost.png"},"baja:VirtualComponentSpace":{"p":"baja:ComponentSpace"},"baja:VirtualGateway":{"c":[],"isv":true,"isx":true,"isc":true,"a":true,"p":"baja:Component"},"baja:VirtualScheme":{"isg":true,"os":"virtual","p":"baja:SlotScheme"},"app:AppFolder":{"c":[],"isv":true,"isx":true,"isc":true,"it":["app:IAppFolder"],"p":"baja:Component","ic":"module://icons/x16/folder.png\\nmodule://icons/x16/badges/puzzle.png"},"app:IAppFolder":{"i":true,"it":["app:IAppComponent"]},"app:IAppComponent":{"i":true,"it":[]},"baja:EmptyTable":{"it":["baja:ITable"]},"baja:GenericTable":{"it":["baja:ISortableTable"]},"baja:ISortableTable":{"i":true,"it":["baja:ITable"]},"baja:DataRecoveryComponentRecorder":{"it":["baja:IAgent"]},"baja:DataRecoveryComponentEvent":{"it":["baja:IEncodable"]},"baja:DataRow":{},"baja:DataTable":{"it":["baja:IDataTable","baja:ISortableTable"]},"baja:ToDataTable":{"it":["baja:IDataTable"]},"baja:IPlatform":{"i":true,"it":[]},"baja:NullPlatform":{"it":["baja:IPlatform"]},"baja:ModuleNavNode":{"p":"baja:NavContainer"},"baja:ModuleTypesContainer":{"p":"baja:NavContainer"},"baja:TypeNavNode":{"it":["baja:INavNode"]},"baja:ServiceEvent":{"c":[],"isv":true,"isx":true,"p":"baja:Struct"},"baja:StationScheme":{"isg":true,"os":"station","p":"baja:SpaceScheme"},"baja:TempUnrestrictedFolder":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:UnrestrictedFolder","ic":"module://icons/x16/folder.png"},"baja:UnrestrictedFolder":{"c":[],"isv":true,"isx":true,"isc":true,"p":"baja:Folder","ic":"module://icons/x16/folder.png"},"baja:IGatewaySpace":{"i":true,"it":[]},"baja:Gateway":{"c":[],"isv":true,"isx":true,"isc":true,"a":true,"p":"baja:Component"},"bajaScript:IBajaScriptWebApp":{"i":true,"it":["app:IWebApp"]},"app:IWebApp":{"i":true,"it":[]},"box:BoxChannel":{"c":[],"isv":true,"isx":true,"isc":true,"a":true,"p":"baja:Component"},"box:RegistryChannel":{"c":[],"isv":true,"isx":true,"isc":true,"p":"box:BoxChannel","ic":"module://icons/x16/window.png"},"box:ServerSessionChannel":{"c":[],"isv":true,"isx":true,"isc":true,"p":"box:BoxChannel","ic":"module://icons/x16/window.png"},"box:OrdChannel":{"c":[],"isv":true,"isx":true,"isc":true,"p":"box:BoxChannel","ic":"module://icons/x16/window.png"},"box:SysChannel":{"c":[],"isv":true,"isx":true,"isc":true,"p":"box:BoxChannel","ic":"module://icons/x16/window.png"},"box:IServerSideCallHandler":{"i":true,"it":["baja:IAgent"]},"box:BoxCollection":{"isv":true,"iss":true,"it":["baja:ICollection"],"p":"baja:Simple"},"box:BoxTable":{"isv":true,"iss":true,"it":["baja:ITable"],"p":"baja:Simple"},"fox:FoxScheme":{"isg":true,"os":"fox","p":"baja:StationSessionScheme"},"net:HttpScheme":{"isg":true,"os":"http","p":"baja:OrdScheme"},"web:IMobilePxView":{"i":true,"it":[]},"app:IMobileWebApp":{"i":true,"it":["app:IWebApp"]},"web:IMobileWebView":{"i":true,"it":[]},"web:IMobileWebOperationalView":{"i":true,"it":["web:IMobileWebView"]},"driver:DriverContainer":{"c":[],"isv":true,"isx":true,"isc":true,"it":["baja:IService"],"p":"baja:Component","ic":"module://icons/x16/deviceNetwork.png"}}'})();
var JSON;JSON||(JSON={});
(function(){function a(C){return C<10?"0"+C:C}function U(C){V.lastIndex=0;return V.test(C)?'"'+C.replace(V,function(I){var G=y[I];return typeof G==="string"?G:"\\u"+("0000"+I.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+C+'"'}function R(C,I){var G,u,o,q,b=O,e,f=I[C];if(f&&typeof f==="object"&&typeof f.toJSON==="function")f=f.toJSON(C);if(typeof K==="function")f=K.call(I,C,f);switch(typeof f){case "string":return U(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);case "object":if(!f)return"null";
O+=Q;e=[];if(Object.prototype.toString.apply(f)==="[object Array]"){q=f.length;for(G=0;G<q;G+=1)e[G]=R(G,f)||"null";o=e.length===0?"[]":O?"[\n"+O+e.join(",\n"+O)+"\n"+b+"]":"["+e.join(",")+"]";O=b;return o}if(K&&typeof K==="object"){q=K.length;for(G=0;G<q;G+=1)if(typeof K[G]==="string"){u=K[G];if(o=R(u,f))e.push(U(u)+(O?": ":":")+o)}}else for(u in f)if(Object.prototype.hasOwnProperty.call(f,u))if(o=R(u,f))e.push(U(u)+(O?": ":":")+o);o=e.length===0?"{}":O?"{\n"+O+e.join(",\n"+O)+"\n"+b+"}":"{"+e.join(",")+
"}";O=b;return o}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var T=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
V=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,O,Q,y={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},K;if(typeof JSON.stringify!=="function")JSON.stringify=function(C,I,G){var u;Q=O="";if(typeof G==="number")for(u=0;u<G;u+=1)Q+=" ";else if(typeof G==="string")Q=G;if((K=I)&&typeof I!=="function"&&(typeof I!=="object"||typeof I.length!=="number"))throw Error("JSON.stringify");return R("",
{"":C})};if(typeof JSON.parse!=="function")JSON.parse=function(C,I){function G(o,q){var b,e,f=o[q];if(f&&typeof f==="object")for(b in f)if(Object.prototype.hasOwnProperty.call(f,b)){e=G(f,b);if(e!==undefined)f[b]=e;else delete f[b]}return I.call(o,q,f)}var u;C=String(C);T.lastIndex=0;if(T.test(C))C=C.replace(T,function(o){return"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(C.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){u=eval("("+C+")");return typeof I==="function"?G({"":u},""):u}throw new SyntaxError("JSON.parse");}})();
(function(a){function U(c,i){var s={},x=[],E=[];a.iterate(c.getKeys(),function(L){s[L]=c.get(L)});a.iterate(i.getKeys(),function(L){s[L]=i.get(L)});a.iterate(s,function(L,S){x.push(S);E.push(L)});return a.Facets.make(x,E)}function R(c){var i=[],s=[];a.iterate(c,function(x,E){i.push(E);s.push(x)});return a.Facets.make(i,s)}function T(c){return"\\"+c}function V(c){return c.replace(/\=|\\|\{|\}|\=|\;/g,T)}var O=a.strictArg,Q=a.strictAllArgs,y=a.def,K=a.objectify,C=a.hasType;a.Object=function(){a.Object.$super.apply(this,
arguments)}.$extend(BaseBajaObj);var I=function(c){return this.equals(c)};a.Object.prototype.equivalent=I;var G=function(){return this.getType().getIcon()};a.Object.prototype.getIcon=G;a.Singleton=function(){a.Singleton.$super.apply(this,arguments)}.$extend(a.Object).registerType("baja:Singleton");a.Value=function(){a.Value.$super.apply(this,arguments)}.$extend(a.Object);a.Value.prototype.newCopy=function(){return this};var u=function(c){return function(i){var s=c.call(this,i);s.$cEncStr=i;return s}},
o=function(c){return function(){if(this.$cEncStr===undefined)this.$cEncStr=c.call(this);return this.$cEncStr}},q=function(c){c.decodeFromString=c.decodeFromString;c.encodeToString=c.encodeToString;return c};a.Simple=function(){a.Simple.$super.apply(this,arguments)}.$extend(a.Value);a.Simple.prototype.equals=function(c){return C(c)&&c.getType().equals(this.getType())&&c.encodeToString()===this.encodeToString()};a.DefaultSimple=function(c){a.DefaultSimple.$super.apply(this,arguments);this.$val=O(c||
"",String)}.$extend(a.Simple);a.DefaultSimple.DEFAULT=new a.DefaultSimple;a.DefaultSimple.prototype.make=function(c){return this.decodeFromString(c)};a.DefaultSimple.prototype.decodeFromString=function(c){c=new a.DefaultSimple(c);c.getType=this.getType;return c};a.DefaultSimple.prototype.encodeToString=function(){return this.$val};a.DefaultSimple.registerType("baja:Simple");a.DefaultSimple.prototype.valueOf=function(){return this.$val};a.DefaultSimple.prototype.toString=function(){return this.$val};
var b=function(){return this.valueOf()},e=function(c){return C(c)&&c.getType().equals(this.getType())&&c.valueOf()===this.valueOf()};String.DEFAULT="";String.make=function(c){if(c===undefined)return String.DEFAULT;if(typeof c!=="string")throw Error("Must supply a String when making BString instances: "+c);return c};String.prototype.make=function(c){return String.make(c)};String.prototype.decodeFromString=function(c){return c};String.prototype.encodeToString=function(){return String(this)};String.registerType("baja:String");
String.prototype.capitalizeFirstLetter=function(){return this.length>0?this.charAt(0).toUpperCase()+this.substring(1,this.length):this};String.prototype.patternReplace=function(c){return this.replace(/\{[a-zA-Z0-9]*\}/g,function(i){i=i.substring(1,i.length-1);return typeof c[i]==="string"?c[i]:i})};String.prototype.getDataTypeSymbol=function(){return"s"};String.prototype.equals=e;String.prototype.equivalent=I;String.prototype.newCopy=b;String.prototype.getIcon=G;Boolean.DEFAULT=false;Boolean.make=
function(c){if(c===undefined)return Boolean.DEFAULT;if(typeof c!=="boolean")throw Error("Must supply a Boolean when making BBoolean instances: "+c);return c};Boolean.prototype.make=function(c){return Boolean.make(c)};Boolean.prototype.decodeFromString=function(c){return c==="true"};Boolean.prototype.encodeToString=function(){return this.toString()};Boolean.prototype.getDataTypeSymbol=function(){return"b"};Boolean.registerType("baja:Boolean");Boolean.prototype.equals=e;Boolean.prototype.equivalent=
I;Boolean.prototype.newCopy=b;Boolean.prototype.isActive=function(){return this.valueOf()};Boolean.prototype.getOrdinal=function(){return this.valueOf()?1:0};Boolean.prototype.getTag=function(){return this.valueOf()?"true":"false"};var f=function(c){var i;if(c)i=this.valueOf()?c instanceof a.Facets?c.get("trueText"):c.trueText:c instanceof a.Facets?c.get("falseText"):c.falseText;return i?a.Format.format(i):a.lex("baja").get(this.getTag())};Boolean.prototype.getDisplayTag=f;var g=Boolean.prototype.toString;
Boolean.prototype.toString=function(){return arguments.length===1?f.apply(this,arguments):g.apply(this,arguments)};Boolean.prototype.getRange=function(){return a.EnumRange.BOOLEAN_RANGE};Boolean.prototype.getIcon=G;Boolean.prototype.getBoolean=function(){return this.valueOf()};Boolean.prototype.getEnum=Boolean.prototype.getBoolean;Boolean.getBooleanFromIBoolean=function(c){var i=c,s=c.getType(),x=false,E;if(s.isComplex())if((E=c.get("out"))&&E.getType().is("baja:StatusBoolean")){i=E.getValue().valueOf();
x=true}if(!x)if(s.is("baja:StatusBoolean"))i=c.getValue().valueOf();else if(s.is("baja:Boolean"))i=c.valueOf();else if(typeof c.getBoolean==="function")i=c.getBoolean();return!!i};Number.DEFAULT=0;a.Double=Number;Number.make=function(c){return Number(c)};Number.prototype.make=function(c){return Number.make(c)};Number.prototype.decodeFromString=function(c){if(c==="0")return 0;else if(c==="+inf")return Number.POSITIVE_INFINITY;else if(c==="-inf")return Number.NEGATIVE_INFINITY;else if(c==="nan")return Number.NaN;
return Number(c)};Number.prototype.encodeToString=function(){if(this.valueOf()===Number.POSITIVE_INFINITY)return"+inf";else if(this.valueOf()===Number.NEGATIVE_INFINITY)return"-inf";else if(isNaN(this.valueOf()))return"nan";return this.toString()};Number.prototype.getDataTypeSymbol=function(){return"d"};Number.registerType("baja:Double");Number.prototype.equals=e;Number.prototype.equivalent=I;Number.prototype.newCopy=b;Number.prototype.getIcon=G;Number.prototype.getNumber=function(){return this.valueOf()};
Number.getNumberFromINumeric=function(c){var i=c,s=c.getType(),x=false,E;if(s.isComplex())if((E=c.get("out"))&&E.getType().is("baja:StatusNumeric")){i=E.getValue().valueOf();x=true}if(!x)if(s.is("baja:StatusNumeric"))i=c.getValue().valueOf();else if(s.is("baja:Number"))i=c.valueOf();else if(typeof c.getNumber==="function")i=c.getNumber();return typeof i==="number"?i:0};var p=Number.prototype.toString;I=function(c){if(c){var i=null;if(c instanceof a.Facets)i=c.get("precision");else if(typeof c.precision===
"number")i=c.precision;if(i!==null)return this.valueOf().toFixed(Number(i.valueOf()))}return p.apply(this.valueOf(),arguments)};Number.prototype.toString=I;a.Float=function(c){a.Float.$super.apply(this,arguments);this.$val=O(c,Number)}.$extend(a.Simple);a.Float.make=function(c){if(c===0)return a.Float.DEFAULT;else if(isNaN(c))return a.Float.NAN;else if(c===a.Float.POSITIVE_INFINITY.valueOf())return a.Float.POSITIVE_INFINITY;else if(c===a.Float.NEGATIVE_INFINITY.valueOf())return a.Float.NEGATIVE_INFINITY;
else if(c>=a.Float.MAX_VALUE.valueOf())return a.Float.MAX_VALUE;else if(c>0&&c<=a.Float.MIN_VALUE.valueOf())return a.Float.MIN_VALUE;return new a.Float(c)};a.Float.prototype.make=function(c){return a.Float.make(c)};a.Float.prototype.decodeFromString=function(c){if(c==="0")return a.Float.DEFAULT;else if(c==="+inf")return a.Float.POSITIVE_INFINITY;else if(c==="-inf")return a.Float.NEGATIVE_INFINITY;else if(c==="nan")return a.Float.NAN;return a.Float.make(parseFloat(c))};a.Float.prototype.encodeToString=
function(){if(this.$val===Number.POSITIVE_INFINITY)return"+inf";else if(this.$val===Number.NEGATIVE_INFINITY)return"-inf";else if(isNaN(this.$val))return"nan";if(this.$val>=a.Float.MAX_VALUE.valueOf())return a.Float.MAX_VALUE.valueOf().toString();else if(this.$val>0&&this.$val<=a.Float.MIN_VALUE.valueOf())return a.Float.MIN_VALUE.valueOf().toString();return this.$val.toString()};a.Float.DEFAULT=q(new a.Float(0));a.Float.MAX_VALUE=q(new a.Float(3.4028235E38));a.Float.MIN_VALUE=q(new a.Float(1.4E-45));
a.Float.POSITIVE_INFINITY=q(new a.Float(Number.POSITIVE_INFINITY));a.Float.NEGATIVE_INFINITY=q(new a.Float(Number.NEGATIVE_INFINITY));a.Float.NAN=q(new a.Float(Number.NaN));a.Float.prototype.decodeFromString=u(a.Float.prototype.decodeFromString);a.Float.prototype.encodeToString=o(a.Float.prototype.encodeToString);a.Float.registerType("baja:Float");a.Float.prototype.equals=e;a.Float.prototype.valueOf=function(){return this.$val};a.Float.prototype.getDataTypeSymbol=function(){return"f"};a.Float.prototype.toString=
I;a.Integer=function(c){a.Integer.$super.apply(this,arguments);this.$val=O(c,Number)}.$extend(a.Simple);a.Integer.make=function(c){if(c===0||isNaN(c))return a.Integer.DEFAULT;else if(c>=a.Integer.MAX_VALUE.valueOf()||c===Number.MAX_VALUE)return a.Integer.MAX_VALUE;else if(c<=a.Integer.MIN_VALUE.valueOf()||c===Number.MIN_VALUE)return a.Integer.MIN_VALUE;c=Math.floor(c);if(c===0)return a.Integer.DEFAULT;return new a.Integer(c)};a.Integer.prototype.make=function(c){return a.Integer.make(c)};a.Integer.prototype.decodeFromString=
function(c){if(c==="0")return a.Integer.DEFAULT;else if(c==="max")return a.Integer.MAX_VALUE;else if(c==="min")return a.Integer.MIN_VALUE;return a.Integer.make(Number(c))};a.Integer.prototype.encodeToString=function(){if(isNaN(this.$val))return"0";else if(this.$val>=a.Integer.MAX_VALUE.valueOf())return"max";else if(this.$val<=a.Integer.MIN_VALUE.valueOf())return"min";return Math.floor(this.$val).toFixed(0)};a.Integer.DEFAULT=q(new a.Integer(0));a.Integer.MAX_VALUE=q(new a.Integer(2147483647));a.Integer.MIN_VALUE=
q(new a.Integer(-2147483648));a.Integer.prototype.encodeToString=o(a.Integer.prototype.encodeToString);a.Integer.prototype.decodeFromString=u(a.Integer.prototype.decodeFromString);a.Integer.registerType("baja:Integer");a.Integer.prototype.equals=e;a.Integer.prototype.valueOf=function(){return this.$val};a.Integer.prototype.toString=function(){return String(this.valueOf())};a.Integer.prototype.getDataTypeSymbol=function(){return"i"};a.Long=function(c){a.Long.$super.apply(this,arguments);this.$val=
O(c,Number)}.$extend(a.Simple);a.Long.make=function(c){if(c===0||isNaN(c))return a.Long.DEFAULT;else if(c>=a.Long.MAX_VALUE.valueOf()||c===Number.MAX_VALUE)return a.Long.MAX_VALUE;else if(c<=a.Long.MIN_VALUE.valueOf()||c===Number.MIN_VALUE)return a.Long.MIN_VALUE;c=Math.floor(c);if(c===0)return a.Long.DEFAULT;return new a.Long(c)};a.Long.prototype.make=function(c){return a.Long.make(c)};a.Long.prototype.decodeFromString=function(c){if(c==="0")return a.Long.DEFAULT;if(c==="max")return a.Long.MAX_VALUE;
else if(c==="min")return a.Long.MIN_VALUE;return a.Long.make(Number(c))};a.Long.prototype.encodeToString=function(){if(isNaN(this.$val))return"0";else if(this.$val>=a.Long.MAX_VALUE.valueOf())return"max";else if(this.$val<=a.Long.MIN_VALUE.valueOf())return"min";return Math.floor(this.$val).toFixed(0)};a.Long.DEFAULT=q(new a.Long(0));a.Long.MAX_VALUE=q(new a.Long(9223372036854775E3));a.Long.MIN_VALUE=q(new a.Long(-9223372036854775E3));a.Long.prototype.decodeFromString=u(a.Long.prototype.decodeFromString);
a.Long.prototype.encodeToString=o(a.Long.prototype.encodeToString);a.Long.registerType("baja:Long");a.Long.prototype.equals=e;a.Long.prototype.valueOf=function(){return this.$val};a.Long.prototype.getDataTypeSymbol=function(){return"l"};a.Long.prototype.toString=function(){return String(this.valueOf())};a.Facets=function(c,i){a.Facets.$super.apply(this,arguments);this.$map=new a.OrderedMap;O(c,Array,"Keys array required");O(i,Array,"Values array required");if(c.length!==i.length)throw Error("baja.Facets Constructor must have an equal number of keys and values");
if(c.length!==0){var s=a.lt("baja:IDataValue"),x;for(x=0;x<c.length;++x){if(typeof c[x]!=="string")throw Error("Facets keys must be a String");a.SlotPath.verifyValidName(c[x]);if(!i[x].getType)throw Error("Facet value has no Baja Type associated with it");if(!i[x].getType().is(s))throw Error("Can only add baja:IDataValue Types to BFacets: "+i[x].getType().getTypeSpec());this.$map.put(c[x],i[x])}}}.$extend(a.Simple);var v=a.Facets.DEFAULT=new a.Facets([],[]);a.Facets.NULL=v;a.Facets.make=function(c,
i){if(arguments.length===0)return v;if(!c)throw Error("Keys required");if(c.constructor===Object)c=R(c);if(i&&i.constructor===Object)i=R(i);if(c instanceof a.Facets){if(i&&i instanceof a.Facets)return U(c,i);return c}else{if(c.length===0)return v;return new a.Facets(c,i)}};a.Facets.prototype.make=function(){return a.Facets.make.apply(a.Facets,arguments)};a.Facets.prototype.decodeFromString=function(c){function i(Z,ca){Z.getDataTypeSymbol=function(){return ca};if(ca==="u")Z.getType=function(){return a.lt("baja:Unit")};
else if(ca==="z")Z.getType=function(){return a.lt("baja:TimeZone")}}function s(Z,ca){var ha=Z.indexOf(ca),oa=[];if(ha===-1)oa.push(Z);else{oa.push(Z.substring(0,ha));ha<Z.length-1&&oa.push(Z.substring(ha+1,Z.length))}return oa}if(c.length===0)return v;c=c.split("|");var x,E=[],L=[],S,Y;for(Y=0;Y<c.length;++Y){x=s(c[Y],"=");a.SlotPath.verifyValidName(x[0]);E.push(x[0]);x=s(x[1],":");x.length===1&&x.push("");if(x[0]==="s")S=a.SlotPath.unescape(x[1]);else if(x[0]==="b")S=Boolean.DEFAULT.decodeFromString(x[1]);
else if(x[0]==="i")S=a.Integer.DEFAULT.decodeFromString(x[1]);else if(x[0]==="l")S=a.Long.DEFAULT.decodeFromString(x[1]);else if(x[0]==="f")S=a.Float.DEFAULT.decodeFromString(x[1]);else if(x[0]==="d")S=Number.DEFAULT.decodeFromString(x[1]);else if(x[0]==="a")S=a.AbsTime.DEFAULT.decodeFromString(x[1]);else if(x[0]==="E")S=a.EnumRange.DEFAULT.decodeFromString(x[1]);else if(x[0]==="e")S=a.DynamicEnum.DEFAULT.decodeFromString(x[1]);else if(x[0]==="r")S=a.RelTime.DEFAULT.decodeFromString(x[1]);else{S=
new a.DefaultSimple(x[1]);i(S,x[0])}L.push(S)}return a.Facets.make(E,L)};a.Facets.prototype.decodeFromString=u(a.Facets.prototype.decodeFromString);a.Facets.prototype.encodeToString=function(){var c="",i=this.$map.getKeys(),s,x;for(x=0;x<i.length;++x){if(x>0)c+="|";s=this.$map.get(i[x]);if(s.getDataTypeSymbol===undefined)throw Error("Cannot encode data type as 'getDataTypeSymbol' is not defined: "+s.getType());if(s.getDataTypeSymbol()==="s")s=a.SlotPath.escape(s);c+=i[x]+"="+s.getDataTypeSymbol()+
":"+s.encodeToString()}return c};a.Facets.prototype.encodeToString=o(a.Facets.prototype.encodeToString);a.Facets.registerType("baja:Facets");a.Facets.prototype.get=function(c,i){O(c,String);i=y(i,null);var s=this.$map.get(c);return s===null?i:s};a.Facets.prototype.getKeys=function(){return this.$map.getKeys()};a.Facets.prototype.toString=function(){var c="",i=this.$map.getKeys(),s;for(s=0;s<i.length;++s){if(s>0)c+=",";c+=i[s]+"="+this.$map.get(i[s]).toString()}return c};a.Facets.prototype.valueOf=
a.Facets.prototype.toString;a.Facets.getFacetsFromObject=function(c){var i=v;if(c.getType().is("baja:Facets"))i=c;else if(c.getType().isComplex())if(c.has("facets"))i=c.getFacets();else if(c.getParent())i=c.getParent().getFacets(c.getPropertyInParent());return i};a.EnumRange=function(c,i,s,x,E){a.EnumRange.$super.apply(this,arguments);this.$frozen=c;this.$dynamic=O(i,Array);this.$byOrdinal=O(s,Object);this.$byTag=O(x,Object);this.$options=O(E,a.Facets)}.$extend(a.Simple);a.EnumRange.make=function(c){c=
K(c,"frozen");var i=y(c.frozen,null),s=c.ordinals,x=c.tags,E=c.count;c=c.options;if(typeof i==="string")i=a.lt(i);if(s===undefined)s=[];if(x===undefined)x=[];if(E===undefined&&s instanceof Array)E=s.length;if(c===undefined)c=v;Q([s,x,E,c],[Array,Array,Number,a.Facets]);if(s.length!==x.length)throw Error("Ordinals and tags arrays must match in length");if(E===0&&c===v)return i===null?a.EnumRange.DEFAULT:new a.EnumRange(i,[],{},{},c);var L={},S={},Y=[],Z,ca,ha;for(ha=0;ha<E;++ha){Z=s[ha];ca=x[ha];a.SlotPath!==
undefined&&a.SlotPath.verifyValidName(ca);if(!(i!==null&&i.isOrdinal(Z))){if(L.hasOwnProperty(Z))throw Error("Duplicate ordinal: "+ca+"="+Z);if(S.hasOwnProperty(ca)||i&&i.isTag(ca))throw Error("Duplicate tag: "+ca+"="+Z);L[Z]=ca;S[ca]=Z;Y.push(Z)}}return new a.EnumRange(i,Y,L,S,c)};a.EnumRange.prototype.make=function(){return a.EnumRange.make.apply(a.EnumRange,arguments)};a.EnumRange.prototype.decodeFromString=function(c){if(c==="{}")return a.EnumRange.DEFAULT;var i=v,s=c.indexOf("?");if(s>0){i=v.decodeFromString(c.substring(s+
1));c=c.substring(0,s)}var x=s=null,E=c.indexOf("+");if(E<0)if(c.indexOf("{")===0)x=c;else s=c;else if(c.indexOf("{")===0){x=c.substring(0,E);s=c.substring(E+1)}else{s=c.substring(0,E);x=c.substring(E+1)}c=[s,x];s=c[0];var L=c[1];c=null;if(s!==null){c=a.lt(s);if(c===null)throw Error("Invalid frozen EnumRange spec: "+s);}if(L===null)return this.make({frozen:c,options:i});if(L.charAt(0)!=="{")throw Error("Missing {");if(L.charAt(L.length-1)!=="}")throw Error("Missing }");L=L.substring(1,L.length-1);
s=[];x=[];E=0;var S=L.split(/[=,]/),Y;for(Y=0;Y<S.length;++Y){x[E]=S[Y];L=parseInt(S[++Y],10);if(isNaN(L))throw Error("Invalid ordinal: "+S[Y]);s[E]=L;E++}return this.make({frozen:c,ordinals:s,tags:x,count:E,options:i})};a.EnumRange.prototype.encodeToString=function(){if(this===a.EnumRange.DEFAULT)return"{}";var c="",i,s,x;if(this.$frozen!==null)c+=this.$frozen.getTypeSpec();if(this.$dynamic.length>0||this.$frozen===null){if(c.length>0)c+="+";c+="{";for(x=0;x<this.$dynamic.length;++x){i=this.$dynamic[x];
s=this.$byOrdinal[i];if(x>0)c+=",";c+=s+"="+i}c+="}"}if(this.$options!==v)c+="?"+this.$options.encodeToString();return c};a.EnumRange.DEFAULT=q(new a.EnumRange(null,[],{},{},v));a.EnumRange.prototype.decodeFromString=u(a.EnumRange.prototype.decodeFromString);a.EnumRange.prototype.encodeToString=o(a.EnumRange.prototype.encodeToString);a.EnumRange.registerType("baja:EnumRange");a.EnumRange.prototype.getDataTypeSymbol=function(){return"E"};a.EnumRange.prototype.getOrdinals=function(){var c,i;c=this.$frozen!==
null?this.$frozen.getOrdinals():[];for(i=0;i<this.$dynamic.length;++i)c.push(this.$dynamic[i]);return c};a.EnumRange.prototype.isOrdinal=function(c){O(c,Number);if(this.$frozen!==null&&this.$frozen.isOrdinal(c))return true;return this.$byOrdinal.hasOwnProperty(c)};a.EnumRange.prototype.getTag=function(c){O(c,Number);if(this.$byOrdinal.hasOwnProperty(c))return this.$byOrdinal[c];if(this.$frozen!==null&&this.$frozen.isOrdinal(c))return this.$frozen.getTag(c);return String(c)};a.EnumRange.prototype.isTag=
function(c){O(c,String);if(this.$frozen!==null&&this.$frozen.isTag(c))return true;return this.$byTag.hasOwnProperty(c)};a.EnumRange.prototype.tagToOrdinal=function(c){O(c,String);if(this.$frozen!==null&&this.$frozen.isTag(c))return this.$frozen.tagToOrdinal(c);if(this.$byTag.hasOwnProperty(c))return this.$byTag[c];else throw Error("Invalid tag: "+c);};a.EnumRange.prototype.get=function(c){if(typeof c==="string"){if(this===a.EnumRange.BOOLEAN_RANGE)return c==="false"?false:true;if(this.$frozen!==null&&
this.$frozen.isTag(c))return this.$frozen.getFrozenEnum(c);if(this.$byTag.hasOwnProperty(c))return a.DynamicEnum.make({ordinal:this.$byTag[c],range:this})}else if(typeof c==="number"){if(this===a.EnumRange.BOOLEAN_RANGE)return c===0?false:true;if(this.$frozen!==null&&this.$frozen.isOrdinal(c))return this.$frozen.getFrozenEnum(c);if(this.isOrdinal(c))return a.DynamicEnum.make({ordinal:c,range:this})}throw Error("Unable to access enum");};a.EnumRange.prototype.isFrozenOrdinal=function(c){O(c,Number);
return this.$frozen!==null&&this.$frozen.isOrdinal(c)};a.EnumRange.prototype.isDynamicOrdinal=function(c){O(c,Number);return this.$byOrdinal.hasOwnProperty(c)};a.EnumRange.prototype.getFrozenType=function(){return this.$frozen};a.EnumRange.prototype.getOptions=function(){return this.$options};a.EnumRange.BOOLEAN_RANGE=a.EnumRange.make({ordinals:[0,1],tags:["false","true"]});a.EnumSet=function(c,i){a.EnumSet.$super.apply(this,arguments);this.$ordinals=O(c);this.$range=O(i,Object)}.$extend(a.Simple);
a.EnumSet.make=function(c){c=K(c,"ordinals");var i=c.ordinals;c=c.range;if(i===undefined)i=[];if(c===undefined)c=a.EnumRange.DEFAULT;O(i,Array);O(c,a.EnumRange);if(i.length===0&&c===a.EnumRange.DEFAULT)return a.EnumSet.NULL;return new a.EnumSet(i,c)};a.EnumSet.prototype.make=function(){return a.EnumSet.make.apply(a.EnumSet,arguments)};a.EnumSet.prototype.decodeFromString=u(function(c){var i=[],s,x=c.indexOf("@"),E,L;if(x>=0){s=a.EnumRange.DEFAULT.decodeFromString(c.substring(x+1));c=c.substring(0,
x)}if(c.length){x=c.split(",");E=x.length;for(L=0;L<E;L++){c=parseInt(x[L],10);if(isNaN(c))throw Error("Invalid ordinal: "+x[L]);i.push(c)}}return this.make({ordinals:i,range:s})});a.EnumSet.prototype.encodeToString=o(function(){var c=this.$range,i=this.$ordinals.join(",");if(c&&c!==a.EnumRange.DEFAULT)i+="@"+c.encodeToString();return i});a.EnumSet.prototype.getDataTypeSymbol=function(){return"E"};a.EnumSet.prototype.getOrdinals=function(){return this.$ordinals};a.EnumSet.prototype.getRange=function(){return this.$range};
a.EnumSet.DEFAULT=new a.EnumSet([],a.EnumRange.DEFAULT);a.EnumSet.NULL=a.EnumSet.DEFAULT;a.EnumSet.registerType("baja:EnumSet");a.Enum=function(){a.Enum.$super.apply(this,arguments)}.$extend(a.Simple);a.Enum.prototype.getEnum=function(){return this};a.Enum.getEnumFromIEnum=function(c){var i=c,s=c.getType(),x=false,E;if(s.isComplex())if((E=c.get("out"))&&E.getType().is("baja:StatusValue")){i=E.getValue();x=true}if(!x)if(s.is("baja:StatusValue"))i=c.getValue();else if(typeof c.getEnum==="function")i=
c.getEnum();return i instanceof a.Enum?i:a.DynamicEnum.DEFAULT};a.DynamicEnum=function(c,i){a.DynamicEnum.$super.apply(this,arguments);this.$ordinal=O(c,Number);this.$range=O(i||a.EnumRange.DEFAULT,a.EnumRange)}.$extend(a.Enum);a.DynamicEnum.make=function(c){c=K(c,"ordinal");var i=y(c.ordinal,0),s=y(c.range,a.EnumRange.DEFAULT);if(c.en!==undefined){c=c.en;if(!C(c))throw Error("Invalid Enum Argument");if(c.getType().is("baja:DynamicEnum"))return c;if(typeof c==="string")c=a.$(c);if(c.getType().isFrozenEnum()||
c.getType().is("baja:Boolean")){i=c.getOrdinal();s=c.getRange()}else throw Error("Argument must be an Enum");}if(i===0&&s===a.EnumRange.DEFAULT)return a.DynamicEnum.DEFAULT;return new a.DynamicEnum(i,s)};a.DynamicEnum.prototype.make=function(){return a.DynamicEnum.make.apply(a.DynamicEnum,arguments)};a.DynamicEnum.prototype.decodeFromString=function(c){var i=c,s=null,x=c.indexOf("@");if(x>0){i=c.substring(0,x);s=c.substring(x+1)}c=parseInt(i,10);i=a.EnumRange.DEFAULT;if(s!==null)i=i.decodeFromString(s);
return this.make({ordinal:c,range:i})};a.DynamicEnum.prototype.decodeFromString=u(a.DynamicEnum.prototype.decodeFromString);a.DynamicEnum.prototype.encodeToString=function(){var c="";c+=this.$ordinal;if(this.$range!==a.EnumRange.DEFAULT)c+="@"+this.$range.encodeToString();return c};a.DynamicEnum.prototype.encodeToString=o(a.DynamicEnum.prototype.encodeToString);a.DynamicEnum.DEFAULT=new a.DynamicEnum(0,a.EnumRange.DEFAULT);a.DynamicEnum.registerType("baja:DynamicEnum");a.DynamicEnum.prototype.getDataTypeSymbol=
function(){return"e"};a.DynamicEnum.prototype.isActive=function(){return this.$ordinal!==0};a.DynamicEnum.prototype.getOrdinal=function(){return this.$ordinal};a.DynamicEnum.prototype.getRange=function(){return this.$range};a.DynamicEnum.prototype.getTag=function(){return this.$range.getTag(this.$ordinal)};a.DynamicEnum.prototype.toString=function(){return this.getTag()};a.DynamicEnum.prototype.is=function(c){var i=typeof c;return i==="number"?c===this.$ordinal:i==="string"?c===this.getTag():this.equals(c)};
var B=function(){B.$super.apply(this,arguments);this.$ordinal=0}.$extend(a.Enum);B.prototype.contractCommitted=function(){};B.prototype.make=function(c){return this.get(c)};B.prototype.decodeFromString=function(c){return this.get(c)};B.prototype.encodeToString=function(){return this.getTag()};B.DEFAULT=new B;B.registerType("baja:FrozenEnum");B.prototype.isActive=function(){return this.$ordinal!==0};B.prototype.getOrdinal=function(){return this.$ordinal};B.prototype.getRange=function(){return this.getType().getRange()};
B.prototype.getTag=function(){return this.getType().getTag(this.$ordinal)};B.prototype.getDisplayTag=function(){return this.getType().getDisplayTag(this.$ordinal)};B.prototype.toString=function(){return this.getDisplayTag()};B.prototype.get=function(c){return this.getRange().get(c)};B.prototype.is=function(c){var i=typeof c;return i==="string"||i==="number"?this.equals(this.getRange().get(c)):this.equals(c)};B.prototype.asDynamic=function(){return a.DynamicEnum.make({en:this})};a.Status=function(c,
i){a.Status.$super.apply(this,arguments);this.$bits=c;this.$facets=i}.$extend(a.Simple);a.Status.make=function(c){c=K(c,"bits");var i=c.orig,s=c.bits,x=c.state;c=c.facets;var E=a.Status.$nullLookup;if(C(s)&&s.getType().equals(a.Status.DEFAULT.getType()))s=s.getBits();O(s,Number);if(i!==undefined){Q([i,x],[a.Status,Boolean]);s=x?i.$bits|s:i.$bits&~s;if(s===0&&i.$facets===v)return a.Status.ok;if(i.$bits===s)return i;c=i.$facets}c=y(c,v);O(c,a.Facets);if(c===v){if(s===0)return a.Status.DEFAULT;if(s<=
256){E.hasOwnProperty(s)||(E[s]=new a.Status(s,c));return E[s]}}return new a.Status(s,c)};a.Status.prototype.make=function(){return a.Status.make.apply(a.Status,arguments)};a.Status.prototype.decodeFromString=function(c){var i=c.indexOf(";");if(i<0)c=a.Status.make(parseInt(c,16));else{var s=parseInt(c.substring(0,i),16);c=a.Status.make({bits:s,facets:v.decodeFromString(c.substring(i+1))})}return c};a.Status.prototype.decodeFromString=u(a.Status.prototype.decodeFromString);a.Status.prototype.encodeToString=
function(){var c=this.$bits.toString(16);if(this.$facets!==v)c+=";"+this.$facets.encodeToString();return c};a.Status.prototype.encodeToString=o(a.Status.prototype.encodeToString);a.Status.prototype.equals=function(c){return C(c)&&c.getType().equals(this.getType())?this.$facets===v?c.$bits===this.$bits:c.$bits===this.$bits&&this.$facets.equals(c.$facets):false};a.Status.DEFAULT=new a.Status(0,v);a.Status.registerType("baja:Status");q=a.Status.$nullLookup={};a.Status.DISABLED=1;a.Status.FAULT=2;a.Status.DOWN=
4;a.Status.ALARM=8;a.Status.STALE=16;a.Status.OVERRIDDEN=32;a.Status.NULL=64;a.Status.UNACKED_ALARM=128;a.Status.ACTIVE_LEVEL="activeLevel";a.Status.ok=a.Status.DEFAULT;q[a.Status.DISABLED]=a.Status.disabled=new a.Status(a.Status.DISABLED,v);q[a.Status.FAULT]=a.Status.fault=new a.Status(a.Status.FAULT,v);q[a.Status.DOWN]=a.Status.down=new a.Status(a.Status.DOWN,v);q[a.Status.ALARM]=a.Status.alarm=new a.Status(a.Status.ALARM,v);q[a.Status.STALE]=a.Status.stale=new a.Status(a.Status.STALE,v);q[a.Status.OVERRIDDEN]=
a.Status.overridden=new a.Status(a.Status.OVERRIDDEN,v);q[a.Status.NULL]=a.Status.nullStatus=new a.Status(a.Status.NULL,v);q[a.Status.UNACKED_ALARM]=a.Status.unackedAlarm=new a.Status(a.Status.UNACKED_ALARM,v);a.Status.prototype.getFacets=function(){return this.$facets};a.Status.prototype.get=function(c,i){return this.$facets.get(c,i)};a.Status.prototype.getBits=function(){return this.$bits};a.Status.prototype.isValid=function(){return(this.$bits&a.Status.DISABLED)===0&&(this.$bits&a.Status.FAULT)===
0&&(this.$bits&a.Status.DOWN)===0&&(this.$bits&a.Status.STALE)===0&&(this.$bits&a.Status.NULL)===0};a.Status.prototype.isOk=function(){return this.$bits===0};a.Status.prototype.isDisabled=function(){return(this.$bits&a.Status.DISABLED)!==0};a.Status.prototype.isFault=function(){return(this.$bits&a.Status.FAULT)!==0};a.Status.prototype.isDown=function(){return(this.$bits&a.Status.DOWN)!==0};a.Status.prototype.isAlarm=function(){return(this.$bits&a.Status.ALARM)!==0};a.Status.prototype.isStale=function(){return(this.$bits&
a.Status.STALE)!==0};a.Status.prototype.isOverridden=function(){return(this.$bits&a.Status.OVERRIDDEN)!==0};a.Status.prototype.isNull=function(){return(this.$bits&a.Status.NULL)!==0};a.Status.prototype.isUnackedAlarm=function(){return(this.$bits&a.Status.UNACKED_ALARM)!==0};a.Status.prototype.getStatus=function(){return this};a.Status.getStatusFromIStatus=function(c){var i=c,s=c.getType(),x,E=false;if(s.isComplex())if((x=c.get("out"))&&x.getType().is("baja:StatusValue")){i=x.getStatus();E=true}if(!E&&
(s.is("baja:StatusValue")||typeof c.getStatus==="function"))i=c.getStatus();return i instanceof a.Status?i:a.Status.DEFAULT};(function(){function c(t,P){switch(t){case "Y":return P<=2?oa:sa;case "M":switch(P){case 1:return ta;case 2:return ua;case 3:return qa;default:return d}case "D":return P===1?j:h;case "h":return P===1?l:H;case "H":return P===1?N:J;case "m":return X;case "s":return da;case "a":return W;case "z":return ba;case "Z":return ia;case "W":return P===1?aa:ka;case "w":return ja;default:return t.charCodeAt(0)}}
function i(t,P){if(P<10)t+="0";t+=P;return t}function s(t){var P;if(ca.hasOwnProperty(t.textPattern))P=ca[t.textPattern];else{P=ca;var M=t.textPattern,$=t.textPattern,ga=$.length,ea=[],fa=$.charAt(0),la=1,va,wa;for(va=1;va<ga;++va){wa=$.charAt(va);if(fa===wa)la++;else{ea.push(c(fa,la));fa=wa;la=1}}ea.push(c(fa,la));P=P[M]=ea}M="";fa=ea=-1;for(ga=$=0;ga<P.length;++ga){la=P[ga];if(la>=ha.length)if(ea===-1)ea=la;else{if(fa===-1)fa=la}else{if((ha[la]&t.show)!==0){$++;if($>1&&ea!==-1){M+=String.fromCharCode(ea);
if(fa!==-1)M+=String.fromCharCode(fa)}$++;switch(la){case oa:M=i(M,t.year%100);break;case sa:M+=t.year;break;case ta:M+=t.month.getOrdinal()+1;break;case ua:M=i(M,t.month.getOrdinal()+1);break;case qa:M+=a.lex("baja").get(t.month.getTag()+".short");break;case d:M.append(t.month.getDisplayTag());break;case j:M+=t.day;break;case h:M=i(M,t.day);break;case l:M+=t.hour===0?"12":t.hour>12?t.hour-12:t.hour;break;case H:if(t.hour===0)M+="12";else M=i(M,t.hour>12?t.hour-12:t.hour);break;case N:M+=t.hour;break;
case J:M=i(M,t.hour);break;case X:M=i(M,t.min);break;case W:M+=t.hour<12?"AM":"PM";break;case da:M=i(M,t.sec);if((t.show&Z)===0)break;M+=".";if(t.ms<10)M+="0";if(t.ms<100)M+="0";M+=t.ms;break;case ba:M+="*** Zone tag not supported ***";break;case ia:ea=t.absTime.getOffset();if(ea===0)M+="Z";else{fa=Math.abs(ea/36E5);la=Math.abs(ea%36E5/6E4);M+=ea<0?"-":"+";if(fa<10)M+="0";M+=fa;M+=":";if(la<10)M+="0";M+=la}break;case aa:M+=a.lex("baja").get(t.absTime.getDate().getWeekday().getTag()+".short");break;
case ka:M+=t.absTime.getDate().getWeekday().getDisplayTag();break;case ja:M+="*** Week year not supported ***"}}ea=fa=-1}}return M}function x(t,P){var M=t.toString(10),$=P-M.length,ga;for(ga=0;ga<$;++ga)M="0"+M;return M}function E(t){return Math[t<0?"ceil":"floor"](t)}a.TimeFormat={};var L=a.TimeFormat.SHOW_DATE=1,S=a.TimeFormat.SHOW_TIME=2,Y=a.TimeFormat.SHOW_SECONDS=4,Z=a.TimeFormat.SHOW_MILLIS=8,ca={},ha=[0,L,L,L,L,L,L,L,S,S,S,S,S,S,Y|Z,16,L,L,L,16,L],oa=1,sa=2,ta=3,ua=4,qa=5,d=18,j=6,h=7,l=8,
H=9,N=10,J=11,X=12,W=13,da=14,ba=15,aa=16,ka=17,ia=19,ja=20,ma=1E3,na=ma*60,pa=na*60,ra=pa*24;a.Time=function(t,P,M,$){a.Time.$super.apply(this,arguments);this.$hour=t;this.$min=P;this.$sec=M;this.$ms=$}.$extend(a.Simple);a.Time.make=function(t){function P(fa){a.strictArg(fa,Number);fa%=ra;M=Math.floor(fa/pa);fa%=pa;$=Math.floor(fa/na);fa%=na;ga=Math.floor(fa/ma);ea=Math.floor(fa%ma)}var M,$,ga,ea;t=K(t,"milliseconds");if(typeof t.milliseconds==="number")P(t.milliseconds);else if(C(t.relTime)&&t.relTime.getType().is("baja:RelTime"))P(t.relTime.getMillis());
else{M=y(t.hour,0);$=y(t.min,0);ga=y(t.sec,0);ea=y(t.ms,0)}Q([M,$,ga,ea],[Number,Number,Number,Number]);if(M<0||M>23||$<0||$>59||ga<0||ga>59||ea<0||ea>999)throw Error("Invalid time: "+M+":"+$+":"+ga+"."+ea);return M===0&&$===0&&ga===0&&ea===0?a.Time.DEFAULT:new a.Time(M,$,ga,ea)};a.Time.prototype.make=function(){return a.Time.make.apply(a.Time,arguments)};a.Time.prototype.decodeFromString=function(t){var P=/^([0-1][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])\.([0-9]{3})$/.exec(t);if(P===null)throw Error("Failed to decode time: "+
t);return a.Time.make({hour:parseInt(P[1],10),min:parseInt(P[2],10),sec:parseInt(P[3],10),ms:parseInt(P[4],10)})};a.Time.prototype.decodeFromString=u(a.Time.prototype.decodeFromString);a.Time.prototype.encodeToString=function(){return x(this.$hour,2)+":"+x(this.$min,2)+":"+x(this.$sec,2)+"."+x(this.$ms,3)};a.Time.prototype.encodeToString=o(a.Time.prototype.encodeToString);a.Time.prototype.equals=function(t){return C(t)&&t.getType().equals(this.getType())?this.getTimeOfDayMillis()===t.getTimeOfDayMillis():
false};a.Time.DEFAULT=new a.Time(0,0,0,0);a.Time.MIDNIGHT=a.Time.DEFAULT;a.Time.registerType("baja:Time");a.Time.prototype.getHour=function(){return this.$hour};a.Time.prototype.getMinute=function(){return this.$min};a.Time.prototype.getSecond=function(){return this.$sec};a.Time.prototype.getMillisecond=function(){return this.$ms};a.Time.prototype.getTimeOfDayMillis=function(){if(this.$timeOfDayMs===undefined){var t=this.$hour*pa;t+=this.$min*na;t+=this.$sec*ma;t+=this.$ms;this.$timeOfDayMs=t}return this.$timeOfDayMs};
a.Time.prototype.add=function(t){O(t);if(typeof t.getMillis==="function")t=t.getMillis();else if(typeof t.getTimeOfDayMillis==="function")t=t.getTimeOfDayMillis();O(t,Number);return a.Time.make(ra+this.getTimeOfDayMillis()+t)};a.Time.prototype.isBefore=function(t){O(t,a.Time);return this.getTimeOfDayMillis()<t.getTimeOfDayMillis()};a.Time.prototype.isAfter=function(t){O(t,a.Time);return this.getTimeOfDayMillis()>t.getTimeOfDayMillis()};a.Time.prototype.toString=function(t){var P=t&&t.textPattern||
a.getTimeFormatPattern();t=(t&&t.show||0)|S;t&=~L;return s({show:t,textPattern:P,hour:this.$hour,min:this.$min,sec:this.$sec,ms:this.$ms})};a.Date=function(t,P,M){a.Date.$super.apply(this,arguments);this.$year=t;this.$month=P;this.$day=M}.$extend(a.Simple);a.Date.make=function(t){t=K(t);var P,M;if(t.jsDate&&t.jsDate instanceof Date){P=t.jsDate.getFullYear();M=t.jsDate.getMonth();t=t.jsDate.getDate()}else{P=t.year;M=t.month;t=t.day;if(C(M)&&M.getType().is("baja:Month"))M=M.getOrdinal()}Q([P,M,t],[Number,
Number,Number]);if(P<0||M<0||M>11||t<1||t>31)throw Error("Invalid date range");var $=a.Date.DEFAULT;if(P===$.$year&&M===$.$month&&t===$.$day)return $;return new a.Date(P,M,t)};a.Date.prototype.make=function(){return a.Date.make.apply(a.Date,arguments)};a.Date.prototype.decodeFromString=function(t){var P=/^([0-9]{4,})\-([0-9]{2})\-([0-9]{2})$/.exec(t);if(P===null)throw Error("Could not decode baja.Date: "+t);return a.Date.make({year:parseInt(P[1],10),month:parseInt(P[2],10)-1,day:parseInt(P[3],10)})};
a.Date.prototype.decodeFromString=u(a.Date.prototype.decodeFromString);a.Date.prototype.encodeToString=function(){return x(this.$year,4)+"-"+x(this.$month+1,2)+"-"+x(this.$day,2)};a.Date.prototype.encodeToString=o(a.Date.prototype.encodeToString);var xa=function(t){O(t,a.Date);if(this.$year!==t.$year)return this.$year-t.$year;if(this.$month!==t.$month)return this.$month-t.$month;if(this.$day!==t.$day)return this.$day-t.$day;return 0};a.Date.prototype.equals=function(t){return C(t)&&t.getType().equals(this.getType())?
xa.call(this,t)===0:false};a.Date.DEFAULT=new a.Date(1970,0,1);a.Date.registerType("baja:Date");a.Date.today=function(){return a.Date.make({jsDate:new Date})};a.Date.prototype.getYear=function(){return this.$year};a.Date.prototype.getMonth=function(){return a.$("baja:Month").get(this.$month)};a.Date.prototype.getDay=function(){return this.$day};a.Date.prototype.getJsDate=function(){return new Date(this.$year,this.$month,this.$day,0,0,0,0)};var ya=function(){if(this.$jsDate===undefined)this.$jsDate=
this.getJsDate();return this.$jsDate};a.Date.prototype.getWeekday=function(){return a.$("baja:Weekday").get(ya.call(this).getDay())};a.Date.prototype.isBefore=function(t){return xa.call(this,t)<0};a.Date.prototype.isAfter=function(t){return xa.call(this,t)>0};a.Date.prototype.toString=function(t){var P=t&&t.textPattern||a.getTimeFormatPattern();t=(t&&t.show||0)|L;t&=~S;t&=~Y;t&=~Z;return s({show:t,textPattern:P,year:this.getYear(),month:this.getMonth(),day:this.getDay()})};a.AbsTime=function(t,P,
M){a.AbsTime.$super.apply(this,arguments);this.$date=t;this.$time=P;this.$offset=M}.$extend(a.Simple);a.AbsTime.make=function(t){t=K(t);var P=y(t.date,a.Date.DEFAULT),M=y(t.time,a.Time.DEFAULT),$=y(t.offset,0);if(t=t.jsDate){if(!(t instanceof Date))throw Error("jsDate must be a JavaScript Date");P=a.Date.make({year:t.getFullYear(),month:t.getMonth(),day:t.getDate()});M=a.Time.make({hour:t.getHours(),min:t.getMinutes(),sec:t.getSeconds(),ms:t.getMilliseconds()});$=t.getTimezoneOffset()*-6E4}Q([P,M,
$],[a.Date,a.Time,Number]);if(P===a.Date.DEFAULT&&M===a.Time.DEFAULT&&$===0)return a.AbsTime.DEFAULT;return new a.AbsTime(P,M,$)};a.AbsTime.prototype.make=function(){return a.AbsTime.make.apply(a.AbsTime,arguments)};a.AbsTime.prototype.decodeFromString=function(t){var P=/^([0-9]{4,})\-([0-9]{2})\-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})\.([0-9]+)(?:(Z)|(?:(\-|\+)([0-9]{2}):([0-9]{2})))$/.exec(t);if(P===null)throw Error("Could not decode AbsTime: "+t);t=a.Date.make({year:parseInt(P[1],10),month:parseInt(P[2],
10)-1,day:parseInt(P[3],10)});var M=a.Time.make({hour:parseInt(P[4],10),min:parseInt(P[5],10),sec:parseInt(P[6],10),ms:parseInt(P[7],10)}),$=0;if(P[8]!=="Z"){$=parseInt(P[10],10)*36E5+parseInt(P[11],10)*6E4;if(P[9]==="-")$*=-1}return a.AbsTime.make({date:t,time:M,offset:$})};a.AbsTime.prototype.decodeFromString=u(a.AbsTime.prototype.decodeFromString);a.AbsTime.prototype.encodeToString=function(){var t=this.$date.encodeToString()+"T"+this.$time.encodeToString();if(this.$offset===0)t+="Z";else{var P=
Math.floor(Math.abs(this.$offset/36E5)),M=Math.floor(Math.abs(this.$offset%36E5/6E4));t+=this.$offset<0?"-":"+";t+=x(P,2)+":";t+=x(M,2)}return t};a.AbsTime.prototype.encodeToString=o(a.AbsTime.prototype.encodeToString);a.AbsTime.prototype.equals=function(t){if(C(t,"baja:AbsTime"))return t.getMillis()===this.getMillis();return false};a.AbsTime.DEFAULT=new a.AbsTime(a.Date.DEFAULT,a.Time.DEFAULT,0);a.AbsTime.registerType("baja:AbsTime");a.AbsTime.prototype.getDataTypeSymbol=function(){return"a"};a.AbsTime.prototype.getTime=
function(){return this.$time};a.AbsTime.prototype.getDate=function(){return this.$date};a.AbsTime.prototype.getOffset=function(){return this.$offset};a.AbsTime.now=function(){return a.AbsTime.make({jsDate:new Date})};a.AbsTime.prototype.getJsDate=function(){var t=this.$jsDate;if(!t)this.$jsDate=t=new Date(this.getMillis());return t};a.AbsTime.prototype.getMillis=function(){var t=this.$millis;if(t===undefined){var P=this.$date,M=this.$time;t=P.getYear();var $=P.getMonth().getOrdinal();P=P.getDay();
var ga=M.getHour(),ea=M.getMinute(),fa=M.getSecond();M=M.getMillisecond();t=this.$millis=Date.UTC(t,$,P,ga,ea,fa,M)-this.$offset}return t};a.AbsTime.prototype.toString=function(t){var P=t&&t.textPattern||a.getTimeFormatPattern(),M=this.$time,$=this.$date;return s({show:t&&t.show||L|S|Y|Z,textPattern:P,year:$.getYear(),month:$.getMonth(),day:$.getDay(),hour:M.getHour(),min:M.getMinute(),sec:M.getSecond(),ms:M.getMillisecond()})};a.RelTime=function(t){a.RelTime.$super.apply(this,arguments);this.$ms=
parseInt(t,10)}.$extend(a.Simple);a.RelTime.make=function(t){var P=0;if(typeof t==="number")P=t;else{t=K(t,"ms");P=y(t.ms,0);O(P,Number);if(typeof t.days==="number")P+=ra*t.days;if(typeof t.hours==="number")P+=pa*t.hours;if(typeof t.minutes==="number")P+=na*t.minutes;if(typeof t.seconds==="number")P+=ma*t.seconds}if(P===0)return a.RelTime.DEFAULT;return new a.RelTime(P)};a.RelTime.prototype.make=function(){return a.RelTime.make.apply(a.RelTime,arguments)};a.RelTime.prototype.decodeFromString=function(t){var P=
Number(t);if(isNaN(P))throw Error("Unable to create RelTime: "+t);return a.RelTime.make(P)};a.RelTime.prototype.decodeFromString=u(a.RelTime.prototype.decodeFromString);a.RelTime.prototype.encodeToString=function(){return this.$ms.toString()};a.RelTime.prototype.encodeToString=o(a.RelTime.prototype.encodeToString);a.RelTime.DEFAULT=new a.RelTime(0);a.RelTime.registerType("baja:RelTime");a.RelTime.MILLIS_IN_SECOND=ma;a.RelTime.MILLIS_IN_MINUTE=na;a.RelTime.MILLIS_IN_HOUR=pa;a.RelTime.MILLIS_IN_DAY=
ra;a.RelTime.SECOND=a.RelTime.make(ma);a.RelTime.MINUTE=a.RelTime.make(na);a.RelTime.HOUR=a.RelTime.make(pa);a.RelTime.DAY=a.RelTime.make(ra);a.RelTime.prototype.equals=e;a.RelTime.prototype.getDataTypeSymbol=function(){return"r"};a.RelTime.prototype.valueOf=function(){return this.$ms};a.RelTime.prototype.toString=function(){return this.$ms.toString()};a.RelTime.prototype.getMillis=function(){return this.$ms};a.RelTime.prototype.getMillisPart=function(){return this.$ms%1E3};a.RelTime.prototype.getSeconds=
function(){return E(this.$ms/ma)};a.RelTime.prototype.getSecondsPart=function(){return this.getSeconds()%60};a.RelTime.prototype.getMinutes=function(){return E(this.$ms/na)};a.RelTime.prototype.getMinutesPart=function(){return this.getMinutes()%60};a.RelTime.prototype.getHours=function(){return E(this.$ms/pa)};a.RelTime.prototype.getHoursPart=function(){return this.getHours()%24};a.RelTime.prototype.getDays=function(){return E(this.$ms/ra)};a.RelTime.prototype.getDaysPart=function(){return this.getDays()}})();
var r={};a.Icon=function(c){a.Icon.$super.apply(this,arguments);this.$ords=O(c,Array)}.$extend(a.Simple);a.Icon.DEFAULT=new a.Icon([]);a.Icon.make=function(c){if(arguments.length===0)return a.Icon.DEFAULT;if(typeof c==="string")c=[c];if(c&&c.constructor===Array){var i=c.join("\n");if(r.hasOwnProperty(i))return r[i];if(c.length===0)return a.Icon.DEFAULT;if(c.length===1&&c[0].toString()==="")return a.Icon.DEFAULT;var s=[],x;for(x=0;x<c.length;++x)s.push(a.Ord.make(c[x].toString()));s=new a.Icon(s);
r[i]=s;s.$cEncStr=i;return s}else throw Error("Invalid argument for baja.Icon.make");};a.Icon.prototype.make=function(){return a.Icon.make.apply(a.Icon,arguments)};a.Icon.prototype.decodeFromString=function(c){if(r.hasOwnProperty(c))return r[c];return a.Icon.make(c.split("\n"))};a.Icon.prototype.encodeToString=function(){if(!this.$cEncStr)this.$cEncStr=this.$ords.join("\n");return this.$cEncStr};a.Icon.registerType("baja:Icon");a.Icon.prototype.toString=function(){return this.encodeToString()};a.Icon.prototype.valueOf=
function(){return this.toString()};a.Icon.prototype.getImageOrds=function(){return Array.prototype.slice.call(this.$ords)};a.Icon.prototype.getImageUris=function(){var c=/^module\:\/\//,i;if(!this.$uris){this.$uris=[];for(i=0;i<this.$ords.length;++i)this.$uris.push(this.$ords[i].toString().replace(c,"/module/"))}return Array.prototype.slice.call(this.$uris)};var F;a.Icon.getStdObjectIcon=function(){F||(F=a.Icon.make(["module://icons/x16/object.png"]));return F};a.Format=function(c){a.Format.$super.apply(this,
arguments);this.$pattern=O(c,String)}.$extend(a.Simple);a.Format.DEFAULT=new a.Format("");a.Format.make=function(c){c=c||"";if(c==="")return a.Format.DEFAULT;a.strictArg(c,String);return new a.Format(c)};a.Format.prototype.make=function(){return a.Format.make.apply(a.Format,arguments)};a.Format.prototype.decodeFromString=function(c){return a.Format.make(c)};a.Format.prototype.encodeToString=function(){return this.$pattern};a.Format.registerType("baja:Format");a.Format.prototype.toString=function(){return this.$pattern};
a.Format.prototype.valueOf=a.Format.prototype.toString;(function(){var c=[],i=/^lexicon\(([a-zA-Z0-9]+)\:([a-zA-Z0-9.\-_]+)\)$/;c.push({isMatch:function(s){return s===""},replace:function(){return"%"}});c.push({isMatch:function(s){return s==="."},replace:function(s,x){var E,L,S=null,Y;if(x.target)if(x.target.container)if(x.target.propertyPath&&x.target.propertyPath.length>0){E=L=x.target.container;for(Y=0;Y<x.target.propertyPath.length;++Y){S=x.target.propertyPath[Y];L=E;E=E.get(S)}return x.display?
L.getDisplay(S):L.get(S)}else return x.display?x.target.container.getDisplay(x.target.slot):x.target.container.get(x.target.slot);else{E=x.target.getObject();return x.display&&C(E)&&E.getType().isComplex()?E.getDisplay():E}else{E=x.object;return x.display&&C(E)&&E.getType().isComplex()?E.getDisplay():E}}});c.push({isMatch:function(s){return s.match(i)},replace:function(s){s=i.exec(s);var x=null;i.lastIndex=0;try{x=a.lex(s[1]).get(s[2])}catch(E){}return x}});c.push({isMatch:function(){return true},
replace:function(s,x){var E,L,S=null,Y,Z=s.split(/\./g);E=L=x.object;for(Y=0;Y<Z.length;++Y){if(E===null||E===undefined)return"error: "+s;if(C(E,"baja:Complex")&&E.has(Z[Y])){S=E.getSlot(Z[Y]);L=E;E=E.get(S)}else{L=S=null;E=typeof E["get"+Z[Y].capitalizeFirstLetter()]==="function"?E["get"+Z[Y].capitalizeFirstLetter()]():typeof E[Z[Y]]==="function"?E[Z[Y]]():typeof E.get==="function"?a.def(E.get(Z[Y]),null):null}}if(S&&L)return E=x.display?L.getDisplay(S):L.get(S);else if(C(E,"baja:Complex"))if(L=
E.getParent())return E=x.display?L.getDisplay(E.getPropertyInParent()):L.get(E.getPropertyInParent());if(E!==null)return E.toString();return E}});a.Format.format=function(s){s=K(s,"pattern");var x=s.pattern;s.display=y(s.display,true);return x.replace(/%[^%]*%/g,function(E){E=E.substring(1,E.length-1);var L;for(L=0;L<c.length;++L)if(c[L].isMatch(E)){L=c[L].replace(E,s);return L===null?"error: "+E:L}return"error: "+E})}})();a.Format.prototype.format=function(c){c=K(c);c.pattern=this.$pattern;return a.Format.format(c)};
a.Permissions=function(c){a.Permissions.$super.apply(this,arguments);this.$mask=c}.$extend(a.Simple);var k=a.Permissions.OPERATOR_READ=1,m=a.Permissions.OPERATOR_WRITE=2,A=a.Permissions.OPERATOR_INVOKE=4,n=a.Permissions.ADMIN_READ=16,w=a.Permissions.ADMIN_WRITE=32,z=a.Permissions.ADMIN_INVOKE=64;q=k|m|A|n|w|z;var D={};D[0]=a.Permissions.none=a.Permissions.DEFAULT=new a.Permissions(0);D[q]=a.Permissions.all=new a.Permissions(q);a.Permissions.prototype.make=function(c){var i=0,s;if(typeof c==="string")for(s=
0;s<c.length;++s)switch(c.charAt(s)){case "i":i|=A;break;case "r":i|=k;break;case "w":i|=m;break;case "I":i|=z;break;case "R":i|=n;break;case "W":i|=w}else i=c;return D[i]?D[i]:D[i]=new a.Permissions(i)};a.Permissions.make=function(){return a.Permissions.DEFAULT.make.apply(a.Permissions.DEFAULT,arguments)};a.Permissions.prototype.decodeFromString=u(function(c){return this.make(c)});a.Permissions.prototype.encodeToString=o(function(){var c="";if(this.hasOperatorInvoke())c+="i";if(this.hasOperatorRead())c+=
"r";if(this.hasOperatorWrite())c+="w";if(this.hasAdminInvoke())c+="I";if(this.hasAdminRead())c+="R";if(this.hasAdminWrite())c+="W";return c});a.Permissions.prototype.toString=function(){return this.encodeToString()};a.Permissions.registerType("baja:Permissions");a.Permissions.prototype.hasOperatorRead=function(){return(this.$mask&k)!==0};a.Permissions.prototype.hasOperatorWrite=function(){return(this.$mask&m)!==0};a.Permissions.prototype.hasOperatorInvoke=function(){return(this.$mask&A)!==0};a.Permissions.prototype.hasAdminRead=
function(){return(this.$mask&n)!==0};a.Permissions.prototype.hasAdminWrite=function(){return(this.$mask&w)!==0};a.Permissions.prototype.hasAdminInvoke=function(){return(this.$mask&z)!==0};a.Permissions.prototype.has=function(c){if(c&&c instanceof a.Permissions)c=c.getMask();return(this.$mask&c)===c};a.Permissions.prototype.getMask=function(){return this.$mask};a.NameMap=function(c,i){a.NameMap.$super.apply(this,arguments);if(i)this.$map=c;else{O(c,Object);this.$map={};var s,x;for(s in c)if(c.hasOwnProperty(s)){x=
c[s];this.$map[s]=x instanceof a.Format?x:a.Format.make(x)}}}.$extend(a.Simple);a.NameMap.DEFAULT=new a.NameMap({});a.NameMap.prototype.make=function(c,i){if(!c)return a.NameMap.DEFAULT;return new a.NameMap(c,i)};a.NameMap.make=function(){return a.NameMap.DEFAULT.make.apply(a.NameMap.DEFAULT,arguments)};a.NameMap.prototype.decodeFromString=u(function(c){if(c==="{}")return a.NameMap.DEFAULT;var i=/^\{(.*)\}$/.exec(c),s=0,x="",E=";",L,S;if(!i)throw Error("Invalid NameMap");if(!i[1])return a.NameMap.DEFAULT;
c={};S=i[1];for(s=0;s<S.length;++s){i=S.charAt(s);if(i==="\\")x+=S.charAt(++s);else if(i!=="="&&i!==";")x+=i;else{if(i===E)throw Error("Invalid NameMap Encoding");E=i;if(L){c[L]=a.Format.make(x);L=undefined}else L=x;x=""}}return this.make(c,true)});a.NameMap.prototype.encodeToString=o(function(){var c="{",i,s=this.$map;for(i in s)if(s.hasOwnProperty(i)){c+=V(i);c+="=";c+=V(s[i].encodeToString());c+=";"}c+="}";return c});a.NameMap.prototype.toString=function(){return this.encodeToString()};a.NameMap.registerType("baja:NameMap");
a.NameMap.prototype.get=function(c){return this.$map[c]||null};a.NameMap.prototype.list=function(){var c=this.$map,i,s=[];for(i in c)c.hasOwnProperty(i)&&s.push(i);return s}})(baja);
(function(a){function U(C){for(var I in C)if(C.hasOwnProperty(I))return false;return true}var R=a.strictArg,T=0;a.event=new BaseBajaObj;var V=function(C,I){if(C&&typeof C==="object")for(var G in C)C.hasOwnProperty(G)&&typeof C[G]==="function"&&this.attach(G,C[G]);else{R(C,String);R(I,Function);if(!I.$bsguid)I.$bsguid=++T;if(this.$handlers===undefined)this.$handlers={};G=C.split(" ");var u;for(u=0;u<G.length;++u){this.$handlers[G[u]]||(this.$handlers[G[u]]={});this.$handlers[G[u]][I.$bsguid]=I}}},
O=function(C,I){if(arguments.length===0)this.$handlers=undefined;if(this.$handlers)if(C&&typeof C==="object")C.hasOwnProperty(void 0)&&typeof C[void 0]==="function"&&this.detach(void 0,C[void 0]);else{R(C,String);I&&R(I,Function);var G=C.split(" "),u;for(u=0;u<G.length;++u)if(I){if(I.$bsguid&&this.$handlers[G[u]]&&this.$handlers[G[u]][I.$bsguid]){delete this.$handlers[G[u]][I.$bsguid];U(this.$handlers[G[u]])&&delete this.$handlers[G[u]]}}else delete this.$handlers[G[u]];if(U(this.$handlers))this.$handlers=
undefined}},Q=function(C,I,G){if(this.$handlers){var u,o=this.$handlers,q;if(o.hasOwnProperty(C)){q=Array.prototype.slice.call(arguments);q.splice(0,3);for(u in o[C])if(o[C].hasOwnProperty(u))try{o[C][u].apply(G,q)}catch(b){I(b)}}}},y=function(C){if(!this.$handlers)return[];C=C.split(" ");var I,G,u=[],o=this.$handlers;for(I=0;I<C.length;++I)if(o.hasOwnProperty(C[I]))for(G in o[C[I]])o[C[I]].hasOwnProperty(G)&&u.push(o[C[I]][G]);return u},K=function(C){if(!this.$handlers)return false;if(C===undefined)return true;
C=C.split(" ");var I;for(I=0;I<C.length;++I)if(!this.$handlers.hasOwnProperty(C[I]))return false;return true};a.event.mixin=function(C){C.attach=V;C.detach=O;C.getHandlers=y;C.hasHandlers=K;C.fireHandlers=Q}})(baja);
(function(a){function U(y){if(y===null)return null;var K=a.$("baja:NavFileNode",{navName:y.n,displayName:y.d,description:y.e,ord:y.o,icon:y.i});V[y.o]=K;if(y.k){var C;for(C=0;C<y.k.length;++C)K.$addChildNode(U(y.k[C]))}return K}var R=a.objectify,T,V={};a.NavContainer=function(y){a.NavContainer.$super.apply(this,arguments);if(y){this.$navName=y.navName;this.$navDisplayName=y.displayName||y.navName;this.$navOrdStr=y.ord;this.$navIconStr=y.icon}}.$extend(a.Object).registerType("baja:NavContainer");a.NavContainer.prototype.getNavName=
function(){return this.$navName};a.NavContainer.prototype.getNavDisplayName=function(){return this.$navDisplayName};a.NavContainer.prototype.getNavDescription=function(){return this.$navDisplayName};a.NavContainer.prototype.getNavOrd=function(){if(!this.$navOrd)this.$navOrd=a.Ord.make(this.$navOrdStr);return this.$navOrd};a.NavContainer.prototype.getNavParent=function(){return this.$navParent||null};a.NavContainer.prototype.getNavChildren=function(y){y=R(y,"ok");y.ok(this.$navKids||[])};a.NavContainer.prototype.getNavIcon=
function(){if(!this.$navIcon)this.$navIcon=a.Icon.make(this.$navIconStr);return this.$navIcon};a.NavContainer.prototype.$addChildNode=function(y){if(!this.$navKids)this.$navKids=[];y.$navParent=this;this.$navKids.push(y);return y};var O=function(){O.$super.apply(this,arguments)}.$extend(a.NavContainer).registerType("baja:NavRoot"),Q=function(){Q.$super.call(this,{navName:"navfile",ord:"dummy:",icon:"module://icons/x16/object.png"})}.$extend(a.NavContainer).registerType("baja:NavFileSpace");Q.prototype.load=
function(y){y=R(y,"ok");y=new a.comm.Callback(y.ok,y.fail,y.batch);if(T!==undefined)y.ok(T);else{y.addOk(function(K,C,I){T=U(I);K(T)});a.comm.navFile(y)}};Q.prototype.getRootNode=function(){if(T===undefined){var y=new a.comm.Batch;this.load({batch:y});y.commitSync()}return T||null};Q.prototype.lookup=function(y){if(!this.getRootNode())return null;return V[y.toString()]||null};Q.prototype.getNavChildren=function(y){y=R(y,"ok");var K=this.getRootNode();K?K.getNavChildren(y):y.ok([])};Q.prototype.getNavDisplayName=
function(){var y=this.getRootNode();return y?y.getNavDisplayName():this.$navDisplayName};Q.prototype.getNavOrd=function(){var y=this.getRootNode();return y?y.getNavOrd():Q.$super.prototype.getNavOrd.call(this)};a.nav=new O({navName:"root",ord:"root:",icon:"module://icons/x16/planet.png"});a.nav.navfile=a.nav.$addChildNode(new Q);a.event.mixin(a.nav)})(baja);
(function(a,U){function R(d){return d.isFrozen()}function T(d){return!d.isFrozen()}function V(d){return d.isProperty()}function O(d){return d.isAction()}function Q(d){return d.isTopic()}function y(d){return d.isProperty()&&d.getType().isValue()}function K(d){return d.isProperty()&&d.getType().isSimple()}function C(d){return d.isProperty()&&d.getType().isNumber()}function I(d){return d.isProperty()&&d.getType().isComplex()}function G(d){return d.isProperty()&&d.getType().isComponent()}function u(d){return d.isProperty()&&
d.getType().isStruct()}function o(d,j){var h,l,H=d.getType().isComponent();for(h in j)if(j.hasOwnProperty(h)){l=j[h];if(d.has(h))if(l&&l.constructor===Object){var N=d.get(h);o(N,l)}else d.set({slot:h,value:l});else if(H){if(l&&l.constructor===Object){N=l;l=new a.Component;o(l,N)}d.add({slot:h,value:l})}}}function q(d,j){d.getSlots().properties().each(function(h){var l=j.getSlot(h.getName());h.$setDisplay(l.$getDisplay());h.$setDisplayName(l.$getDisplayName());h.getType().isStruct()?q(h.$getValue(),
l.$getValue()):h.$setValue(l.$getValue())})}function b(d,j,h,l,H,N,J){var X=a.error;if(h===D)j.fireHandlers("changed",X,d,l,J);else if(h===c)j.fireHandlers("added",X,d,l,J);else if(h===i)j.fireHandlers("removed",X,d,l,H,J);else if(h===s)j.fireHandlers("renamed",X,d,l,N,J);else if(h===x)j.fireHandlers("reordered",X,d,J);else if(h===E)j.fireHandlers("topicFired",X,d,l,H,J);else if(h===L)j.fireHandlers("flagsChanged",X,d,l,J);else if(h===S)j.fireHandlers("facetsChanged",X,d,l,J);else if(h===ca)j.fireHandlers("subscribed",
X,d,J);else if(h===ha)j.fireHandlers("unsubscribed",X,d,J);else if(h===Y)j.fireHandlers("addKnob",X,d,l,H,J);else h===Z&&j.fireHandlers("removeKnob",X,d,l,H,J)}function e(d,j,h,l,H){var N=a.error;if(h===s)j.fireHandlers("componentRenamed",N,d,l,H);else if(h===L)j.fireHandlers("componentFlagsChanged",N,d,H);else h===S&&j.fireHandlers("componentFacetsChanged",N,d,H)}function f(d,j,h,l,H,N){if(d.isSubscribed()||j===ha){d.hasHandlers()&&b(d,d,j,h,l,H,N);if(d.$subs.length>0){var J;for(J=0;J<d.$subs.length;++J)d.$subs[J].hasHandlers()&&
b(d,d.$subs[J],j,h,l,H,N)}}J=null;if(j===s){if(h&&h.isProperty())J=d.get(h)}else if(j===L||j===S)if(h&&h.isProperty())J=d.get(h);if(J!==null&&J.getType().isComponent()&&J.isSubscribed()){e(J,J,j,H,N);if(J.$subs.length>0){var X;for(X=0;X<J.$subs.length;++X)e(J,J.$subs[X],j,H,N)}}j===x&&d.getSlots(function(W){return W.isProperty()&&W.getType().isComponent()&&this.get(W).isSubscribed()}).each(function(W){W=this.get(W);W.fireHandlers("componentReordered",a.error,W,N);if(W.$subs.length>0){var da;for(da=
0;da<W.$subs.length;++da)W.$subs[da].fireHandlers("componentReordered",a.error,W,N)}});if(a.nav.hasHandlers()&&d.isMounted()&&(j===c&&h.getType().isComponent()||j===i&&l.getType().isComponent()||j===s&&h.getType().isComponent()||j===x))b(d,a.nav,j,h,l,H,N)}function g(d,j){j.addOk(function(h,l,H){h.call(d,H)})}function p(d,j){j.addFail(function(h,l,H){l.call(d,H)})}function v(d,j){if(d.isSubscribed()){d.fireHandlers("unmount",a.error,d,j);if(d.$subs.length>0){var h;for(h=0;h<d.$subs.length;++h)d.$subs[h].fireHandlers("unmount",
a.error,d,j)}}d.getSlots(function(l){return l.isProperty()&&l.getType().isComponent()}).each(function(l){v(this.get(l),j)})}var B=[],r=a.strictArg,F=a.def,k=a.objectify,m=a.comm.Callback;a.Flags=function(d,j,h){this.$mask=d;this.$symbol=j;this.$name=h;a.Flags.bySymbol[j]=this}.$extend(U);a.Flags.bySymbol={};a.Flags.prototype.getMask=function(){return this.$mask};a.Flags.prototype.getSymbol=function(){return this.$symbol};a.Flags.prototype.toString=function(){return this.$name};a.Flags.prototype.equals=
function(d){return d instanceof a.Flags&&d.getMask()===this.getMask()};a.Flags.READONLY=1;a.Flags.TRANSIENT=2;a.Flags.HIDDEN=4;a.Flags.SUMMARY=8;a.Flags.ASYNC=16;a.Flags.NO_RUN=32;a.Flags.DEFAULT_ON_CLONE=64;a.Flags.CONFIRM_REQUIRED=128;a.Flags.OPERATOR=256;a.Flags.EXECUTE_ON_CHANGE=512;a.Flags.FAN_IN=1024;a.Flags.NO_AUDIT=2048;a.Flags.COMPOSITE=4096;a.Flags.REMOVE_ON_CLONE=8192;a.Flags.METADATA=16384;a.Flags.LINK_TARGET=32768;a.Flags.NON_CRITICAL=65536;a.Flags.USER_DEFINED_1=268435456;a.Flags.USER_DEFINED_2=
536870912;a.Flags.USER_DEFINED_3=1073741824;a.Flags.USER_DEFINED_4=2147483648;a.Flags.flags=[new a.Flags(a.Flags.READONLY,"r","readonly"),new a.Flags(a.Flags.TRANSIENT,"t","transient"),new a.Flags(a.Flags.HIDDEN,"h","hidden"),new a.Flags(a.Flags.SUMMARY,"s","summary"),new a.Flags(a.Flags.ASYNC,"a","async"),new a.Flags(a.Flags.NO_RUN,"n","noRun"),new a.Flags(a.Flags.DEFAULT_ON_CLONE,"d","defaultOnClone"),new a.Flags(a.Flags.CONFIRM_REQUIRED,"c","confirmRequired"),new a.Flags(a.Flags.OPERATOR,"o","operator"),
new a.Flags(a.Flags.EXECUTE_ON_CHANGE,"x","executeOnChange"),new a.Flags(a.Flags.FAN_IN,"f","fanIn"),new a.Flags(a.Flags.NO_AUDIT,"A","noAudit"),new a.Flags(a.Flags.COMPOSITE,"p","composite"),new a.Flags(a.Flags.REMOVE_ON_CLONE,"R","removeOnClone"),new a.Flags(a.Flags.METADATA,"m","metadata"),new a.Flags(a.Flags.NON_CRITICAL,"N","nonCritical"),new a.Flags(a.Flags.LINK_TARGET,"L","linkTarget"),new a.Flags(a.Flags.USER_DEFINED_1,"1","userDefined1"),new a.Flags(a.Flags.USER_DEFINED_2,"2","userDefined2"),
new a.Flags(a.Flags.USER_DEFINED_3,"3","userDefined3"),new a.Flags(a.Flags.USER_DEFINED_4,"4","userDefined4")];a.Flags.encodeToString=function(d){if(d===0)return"";r(d,Number);var j="",h;for(h=0;h<a.Flags.flags.length;++h)if((a.Flags.flags[h].getMask()&d)!==0)j+=a.Flags.flags[h].getSymbol();return j};a.Flags.decodeFromString=function(d){if(d==="0")return 0;r(d,String);var j=0;d=d.split("");var h,l;for(l=0;l<d.length;++l)if(h=a.Flags.bySymbol[d[l]])j|=h.getMask();return j};a.Slot=function(d,j){this.$slotName=
d||"";this.$displayName=j||""}.$extend(U);a.Slot.prototype.getName=function(){return this.$slotName};a.Slot.prototype.toString=function(){return this.getName()};a.Slot.prototype.$getDisplayName=function(){return this.$displayName};a.Slot.prototype.$setDisplayName=function(d){this.$displayName=d};a.Slot.prototype.isFrozen=function(){return false};a.Slot.prototype.isProperty=function(){return false};a.Slot.prototype.isTopic=function(){return false};a.Slot.prototype.isAction=function(){return false};
a.Property=function(){a.Property.$super.apply(this,arguments)}.$extend(a.Slot);a.Property.prototype.isProperty=function(){return true};var A=function(d,j,h,l,H,N){A.$super.apply(this,[d,j]);this.$display=h||"";this.$flags=l||0;this.$facets=H||a.Facets.DEFAULT;this.$val=F(N,null)}.$extend(a.Property);A.prototype.$getValue=function(){return this.$val};A.prototype.$setValue=function(d){this.$val=d};A.prototype.getFlags=function(){return this.$flags};A.prototype.$setFlags=function(d){this.$flags=d};A.prototype.getFacets=
function(){return this.$facets};A.prototype.$setFacets=function(d){this.$facets=d};A.prototype.getDefaultFlags=function(){return this.getFlags()};A.prototype.getDefaultValue=function(){return this.$val};A.prototype.getType=function(){return this.$val.getType()};A.prototype.$getDisplay=function(){return this.$display};A.prototype.$setDisplay=function(d){this.$display=d};a.Action=function(d,j){a.Action.$super.call(this,d,j)}.$extend(a.Slot);a.Action.prototype.isAction=function(){return true};a.Topic=
function(d,j){a.Topic.$super.call(this,d,j)}.$extend(a.Slot);a.Topic.prototype.isTopic=function(){return true};var n=function(){n.$super.apply(this,arguments)}.$extend(A);n.prototype.isAction=function(){return true};n.prototype.getParamType=function(){return this.$val.getParamType()};n.prototype.getParamDefault=function(){return this.$val.getParamDefault()};n.prototype.getReturnType=function(){return this.$val.getReturnType()};var w=function(){w.$super.apply(this,arguments)}.$extend(A);w.prototype.isTopic=
function(){return true};w.prototype.getEventType=function(){return this.$val.getEventType()};var z=function(){z.$super.apply(this,arguments)}.$extend(a.FilterCursor);z.prototype.getValue=function(){var d=this.get();return d!==null&&d.isProperty()?this.$context.get(d):null};z.prototype.getDisplay=function(){var d=this.get();return d!==null&&d.isProperty()?this.$context.getDisplay(d):null};z.prototype.firstValue=function(){var d=this.first();return d!==null&&d.isProperty()?this.$context.get(d):null};
z.prototype.firstDisplay=function(){var d=this.first();return d!==null&&d.isProperty()?this.$context.getDisplay(d):null};z.prototype.lastValue=function(){var d=this.last();return d!==null&&d.isProperty()?this.$context.get(d):null};z.prototype.lastDisplay=function(){var d=this.last();return d!==null&&d.isProperty()?this.$context.getDisplay(d):null};z.prototype.eachValue=function(d){return this.each(function(j,h){if(j.isProperty())return d.call(this,this.get(j),h);return false})};z.prototype.eachDisplay=
function(d){return this.each(function(j,h){if(j.isProperty())return d.call(this,this.getDisplay(j),h);return false})};z.prototype.toValueArray=function(){var d=this.toArray(),j=[],h;for(h=0;h<d.length;++h)d[h].isProperty()&&j.push(this.$context.get(d[h]));return j};z.prototype.toDisplayArray=function(){var d=this.toArray(),j=[],h;for(h=0;h<d.length;++h)d[h].isProperty()&&j.push(this.$context.getDisplay(d[h]));return j};z.prototype.toValueMap=function(){var d=this.toArray(),j={},h,l;for(l=0;l<d.length;++l){h=
d[l];if(h.isProperty())j[h.getName()]=this.$context.get(h)}return j};z.prototype.toDisplayMap=function(){var d=this.toArray(),j={},h,l;for(l=0;l<d.length;++l){h=d[l];if(h.isProperty())j[h.getName()]=this.$context.getDisplay(h)}return j};z.prototype.frozen=function(){this.filter(R);return this};z.prototype.dynamic=function(){this.filter(T);return this};z.prototype.properties=function(){this.filter(V);return this};z.prototype.actions=function(){this.filter(O);return this};z.prototype.topics=function(){this.filter(Q);
return this};z.prototype.is=function(d){d=Array.prototype.slice.call(arguments);this.filter(function(j){if(j.isProperty()){j=j.getType();var h;for(h=0;h<d.length;++h)if(j.is(d[h]))return true}return false});return this};z.prototype.isValue=function(){this.filter(y);return this};z.prototype.isSimple=function(){this.filter(K);return this};z.prototype.isNumber=function(){this.filter(C);return this};z.prototype.isComplex=function(){this.filter(I);return this};z.prototype.isComponent=function(){this.filter(G);
return this};z.prototype.isStruct=function(){this.filter(u);return this};z.prototype.equalType=function(d){d=Array.prototype.slice.call(arguments);var j;for(j=0;j<d.length;++j)d[j]=typeof d[j]==="string"?a.lt(d[j]):d[j];this.filter(function(h){if(h.isProperty()){h=h.getType();var l;for(l=0;l<d.length;++l)if(h.equals(d[l]))return true}return false});return this};z.prototype.equalValue=function(d){d=Array.prototype.slice.call(arguments);this.filter(function(j){if(j.isProperty()){j=this.get(j);var h;
for(h=0;h<d.length;++h)if(j.equals(d[h]))return true}return false});return this};z.prototype.equivalent=function(d){d=Array.prototype.slice.call(arguments);this.filter(function(j){if(j.isProperty()){j=this.get(j);var h;for(h=0;h<d.length;++h)if(j.equivalent(d[h]))return true}return false});return this};z.prototype.slotName=function(d){typeof d==="string"?this.filter(function(j){return j.getName().equals(d.toString())}):this.filter(function(j){return d.test(j.getName())});return this};z.prototype.flags=
function(d){this.filter(function(j){return this.getFlags(j)&d});return this};var D=0,c=1,i=2,s=3,x=4,E=8,L=9,S=10,Y=12,Z=13,ca=14,ha=15;a.Complex=function(){a.Complex.$super.apply(this,arguments);this.$map=new a.OrderedMap;this.$propInParent=this.$parent=null}.$extend(a.Value);a.Complex.prototype.contractCommitted=function(d){d&&d.constructor===Object&&o(this,d)};a.Complex.prototype.getName=function(){return this.$propInParent===null?null:this.$propInParent.getName()};a.Complex.prototype.getDisplayName=
function(d){var j;if(d===undefined)return this.getPropertyInParent()===null?null:this.getParent().getDisplayName(this.getPropertyInParent());d=this.getSlot(d);if(d===null)return null;if((j=this.get("displayNames"))&&j.getType().getTypeSpec().equals("baja:NameMap"))if(j=j.get(d.getName()))return j.format();j=d.$getDisplayName();if(typeof j!=="string")j="";if(j==="")j=a.SlotPath.unescape(d.getName());return j};a.Complex.prototype.getDisplay=function(d){if(d===undefined)return this.getPropertyInParent()===
null?null:this.getPropertyInParent().$getDisplay();d=this.getSlot(d);return d===null?null:d.$getDisplay()};a.Complex.prototype.toString=function(){var d=this.getDisplay();return typeof d==="string"?d:this.getType().toString()};a.Complex.prototype.getParent=function(){return this.$parent};a.Complex.prototype.getPropertyInParent=function(){return this.$propInParent};a.Complex.prototype.getSlot=function(d){if(typeof d==="string")return this.$map.get(d);else{r(d,a.Slot);return this.$map.get(d.getName())}};
a.Complex.prototype.getSlots=function(d){var j=this.$map.getCursor(this,z);d&&j.filter(d);return j};a.Complex.prototype.getFlags=function(d){if(arguments.length===0)if(this.$parent!==null&&this.$propInParent!==null)return this.$parent.getFlags(this.$propInParent);else throw Error("Complex has no parent");d=this.getSlot(d);if(d===null)throw Error("Slot doesn't exist: "+d);return d.getFlags()};a.Complex.prototype.get=function(d){d=this.getSlot(d);if(d===null)return null;return d.$getValue()};a.Complex.prototype.has=
function(d){return this.getSlot(d)!==null};a.Complex.prototype.getValueOf=function(d){d=this.get(d);return d!==null&&typeof d.valueOf==="function"?d.valueOf():d};a.Complex.prototype.set=function(d){d=k(d);for(var j=new m(d.ok,d.fail,d.batch),h=d.slot,l=d.value,H=F(d.cx,null),N=H&&H.serverDecode,J=H&&H.commit,X=H&&H.syncStructVals,W=this;W!==null&&!W.getType().isComponent();)W=W.getParent();j.addOk(function(aa,ka,ia){W!==null?aa.call(W,ia):aa(ia)});j.addFail(function(aa,ka,ia){W!==null?ka.call(W,ia):
ka(ia)});try{h=this.getSlot(h);if(!N){r(h,a.Property);r(l);if(h===null)throw Error("Could not find Property: "+d.slot);if(!a.hasType(l))throw Error("Can only set BValue Types as Component Properties");if(l.getType().isAbstract())throw Error("Cannot set value in Complex to Abstract Type: "+l.getType());if(l.getType().isNumber()&&h.getType().isNumber()&&!l.getType().equals(h.getType()))l=h.getType().getInstance().constructor.make(l.valueOf());if(!l.getType().isValue())throw Error("Cannot set non Value Types as Properties in a Complex");
if(l===this)throw Error("Illegal argument: this === value");}if(H){typeof H.displayName==="string"&&h.$setDisplayName(H.displayName);typeof H.display==="string"&&h.$setDisplay(H.display)}if(l.equals(h.$getValue()))j.ok();else if(!(!J&&this.$fw("modifyTrap",[h],l,j,H))){var da=l.getType().isComplex();if(da){if(l.getParent())throw Error("Complex already parented: "+l.getType());l.$parent=null;l.$propInParent=null}if(X&&l.getType().isStruct()&&l.getType().equals(h.getType()))q(h.$getValue(),l);else{h.$setValue(l);
if(da){l.$parent=this;l.$propInParent=h;l.getType().isComponent()&&this.isMounted()&&this.$space.$fw("mount",l)}}this.$fw("modified",h,H);j.ok()}}catch(ba){j.fail(ba)}};a.Complex.prototype.loadSlots=function(d){d&&d.ok&&typeof d.ok==="function"&&d.ok.call(this)};a.Complex.prototype.getFacets=function(d){if(arguments.length===0)return this.$parent!==null&&this.$propInParent!==null?this.$parent.getFacets(this.$propInParent):null;d=this.getSlot(d);return d===null?null:d.getFacets()};a.Complex.prototype.equivalent=
function(d){if(!a.hasType(d))return false;if(!d.getType().equals(this.getType()))return false;if(this.$map.getSize()!==d.$map.getSize())return false;for(var j=d.getSlots().properties(),h,l;j.next();){h=j.get();if(!this.getFlags(h.getName()).equals(d.getFlags(h)))return false;l=d.get(h);if(l===null)return false;if(!l.equivalent(this.get(h.getName())))return false;if(this.$map.getIndex(h.getName())!==j.getIndex())return false}return true};var oa={type:"copying"};a.Complex.prototype.newCopy=function(d){for(var j=
this.getType().getInstance(),h=this.getSlots().properties(),l,H;h.next();){l=h.get();if(!(!d&&(a.Flags.DEFAULT_ON_CLONE&l.getFlags())===a.Flags.DEFAULT_ON_CLONE)){H=this.get(l).newCopy(d);if(l.isFrozen())j.set({slot:l.getName(),value:H,cx:oa});else{if(!d&&(a.Flags.REMOVE_ON_CLONE&l.getFlags())===a.Flags.REMOVE_ON_CLONE)continue;l=j.add({slot:l.getName(),value:H,flags:l.getFlags(),facets:l.getFacets(),cx:oa})}j.getSlot(l.getName()).$setFlags(l.getFlags())}}return j};a.Complex.prototype.$fw=function(d,
j,h,l,H){if(d==="modified")this.$parent!==null&&this.$parent.$fw(d,this.$propInParent,h,l,H);else if(d==="modifyTrap")if(this.$parent!==null){j.push(this.$propInParent);return this.$parent.$fw(d,j,h,l,H)}else return false};a.Struct=function(){a.Struct.$super.apply(this,arguments)}.$extend(a.Complex).registerType("baja:Struct");a.ActionProperty=function(){a.ActionProperty.$super.apply(this,arguments);this.$returnType=this.$paramDef=this.$paramType=null}.$extend(a.Struct).registerType("baja:Action");
a.ActionProperty.prototype.getParamType=function(){return this.$paramType};a.ActionProperty.prototype.getParamDefault=function(){return this.$paramDef};a.ActionProperty.prototype.getReturnType=function(){return this.$returnType};a.ActionProperty.prototype.invoke=function(){return null};a.TopicProperty=function(){a.TopicProperty.$super.apply(this,arguments);this.$eventType=null}.$extend(a.Struct).registerType("baja:Topic");a.TopicProperty.prototype.getEventType=function(){return this.$eventType};a.TopicProperty.prototype.fire=
function(){};a.Component=function(){a.Component.$super.apply(this,arguments);this.$handle=this.$space=null;this.$bPropsLoaded=false;this.$subs=[];this.$lease=false;this.$leaseTicket=a.clock.expiredTicket;this.$permissions=this.$permissionsStr=this.$knobs=null}.$extend(a.Complex).registerType("baja:Component");a.Component.prototype.setFlags=function(d){d=k(d);var j=d.slot,h=d.flags,l=d.cx,H=l&&l.serverDecode,N=l&&l.commit,J=new m(d.ok,d.fail,d.batch);g(this,J);p(this,J);try{j=this.getSlot(j);if(!H){r(j,
a.Slot);r(h,Number);if(j===null)throw Error("Could not find Slot: "+d.slot);typeof this.checkSetFlags==="function"&&this.checkSetFlags(j,h,l)}if(!N&&this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().setFlags(this,j,h,J);else{j.$setFlags(h);if(l){typeof l.displayName==="string"&&j.$setDisplayName(l.displayName);typeof l.display==="string"&&j.$setDisplay(l.display)}f(this,L,j,null,null,l);J.ok()}}catch(X){J.fail(X)}};a.Component.prototype.setFacets=function(d){d=k(d);var j=new m(d.ok,
d.fail,d.batch);g(this,j);p(this,j);var h=d.slot,l=d.facets,H=d.cx,N=H&&H.serverDecode,J=H&&H.commit;try{h=this.getSlot(h);if(l===null)l=a.Facets.DEFAULT;if(!N){r(h,a.Slot);r(l,a.Facets);if(h===null)throw Error("Could not find Slot: "+d.slot);if(h.isFrozen())throw Error("Cannot set facets of frozen Slot: "+h.getName());typeof this.checkSetFacets==="function"&&this.checkSetFacets(h,l,H)}if(!J&&this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().setFacets(this,h,l,j);else{h.$setFacets(l);
if(H){typeof H.displayName==="string"&&h.$setDisplayName(H.displayName);typeof H.display==="string"&&h.$setDisplay(H.display)}f(this,S,h,l,null,H);j.ok()}}catch(X){j.fail(X)}};a.Component.prototype.add=function(d){d=k(d,"value");var j=new m(d.ok,d.fail,d.batch);g(this,j);p(this,j);var h=d.slot,l=d.value,H=d.flags,N=d.facets;d=d.cx;var J,X;try{h=F(h,null);H=F(H,0);N=F(N,a.Facets.DEFAULT);J=(d=F(d,null))&&d.serverDecode;X=d&&d.commit;if(!J){r(h,String);r(l);r(H,Number);r(N,a.Facets);r(d);if(!a.hasType(l))throw Error("Can only add BValue Types as Component Properties");
if(l.getType().isAbstract())throw Error("Cannot add Abstract Type to Component: "+l.getType());if(!l.getType().isValue())throw Error("Cannot add non Value Types as Properties to a Component");if(l===this)throw Error("Illegal argument value === this");typeof this.checkAdd==="function"&&this.checkAdd(h,l,H,N,d);if(l.getType().isComponent()){if(typeof l.isParentLegal==="function")if(!this.getType().is("baja:UnrestrictedFolder"))if(!l.isParentLegal(this))throw Error("Illegal parent: "+this.getType()+
" for child "+l.getType());if(typeof this.isChildLegal==="function")if(!this.isChildLegal(l))throw Error("Illegal child: "+l.getType()+" for parent "+this.getType());}}if(!X&&this.isMounted()&&this.$space.hasCallbacks()){this.$space.getCallbacks().add(this,h,l,H,N,j);return null}if(!J){if(h===null)h=this.getUniqueName(l.getType().getTypeName());else if(h.substring(h.length-1,h.length)==="?")h=this.getUniqueName(h.substring(0,h.length-1));a.SlotPath.verifyValidName(h)}if(this.$map.get(h)!==null)throw Error("Duplicate Slot: "+
h);J=h;X="";if(d){if(typeof d.displayName==="string")J=d.displayName;if(typeof d.display==="string")X=d.display}var W;W=l.getType().isAction()?new n(h,J,X,H,N,l):l.getType().isTopic()?new w(h,J,X,H,N,l):new A(h,J,X,H,N,l);this.$map.put(h,W);if(l.getType().isComplex()){if(l.getParent()!==null)throw Error("Complex already parented: "+l.getType());l.$parent=this;l.$propInParent=W;l.getType().isComponent()&&this.isMounted()&&this.$space.$fw("mount",l)}f(this,c,W,null,null,d);j.ok(W);return W}catch(da){j.fail(da)}return null};
a.Component.prototype.getUniqueName=function(d){a.SlotPath.verifyValidName(d);for(var j=d,h=1;this.getSlot(j)!==null;){j=d+h;h++}return j};a.Component.prototype.remove=function(d){d=k(d,"slot");var j=d.slot,h=d.cx,l=h&&h.serverDecode,H=h&&h.commit;d=new m(d.ok,d.fail,d.batch);g(this,d);p(this,d);try{r(j);var N=null;if(a.hasType(j)&&j.getType().isComplex()){N=j;j=j.getPropertyInParent()}else j=this.getSlot(j);if(!l){if(j===null)throw Error("Invalid slot for Component remove");if(!j.isProperty()||j.isFrozen())throw Error("Cannot remove Slot that isn't a dynamic Property: "+
j.getName());typeof this.checkRemove==="function"&&this.checkRemove(j,h)}if(!H&&this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().remove(this,j,d);else{if(N===null)N=this.get(j);if(N.getType().isComplex()){if(N.getType().isComponent()){v(N,h);this.isMounted()&&this.$space.$fw("unmount",N)}N.$parent=null;N.$propInParent=null}this.$map.remove(j.getName());f(this,i,j,N,null,h);d.ok()}}catch(J){d.fail(J)}};a.Component.prototype.rename=function(d){d=k(d);var j=d.slot,h=d.newName,
l=d.cx,H=l&&l.serverDecode,N=l&&l.commit;d=new m(d.ok,d.fail,d.batch);g(this,d);p(this,d);try{var J=this.getSlot(j);if(J===null)throw Error("Cannot rename. Slot doesn't exist: "+j+" -> "+h);if(!H){r(J,a.Slot);r(h,String);a.SlotPath.verifyValidName(h);if(J.isFrozen())throw Error("Cannot rename frozen Slot: "+j+" -> "+h);if(this.getSlot(h)!==null)throw Error("Cannot rename. Slot name already used: "+j+" -> "+h);typeof this.checkRename==="function"&&this.checkRename(J,h,l)}var X=J.getName();if(!N&&this.isMounted()&&
this.$space.hasCallbacks())this.$space.getCallbacks().rename(this,X,h,d);else{if(!this.$map.rename(X,h))throw Error("Cannot rename: "+X+" -> "+h);J.$slotName=h;if(l){typeof l.displayName==="string"&&J.$setDisplayName(l.displayName);typeof l.display==="string"&&J.$setDisplay(l.display)}f(this,s,J,null,X,l);d.ok()}}catch(W){d.fail(W)}};a.Component.prototype.reorder=function(d){d=k(d,"dynamicProperties");var j=d.dynamicProperties,h=d.cx,l=h&&h.serverDecode,H=h&&h.commit;d=new m(d.ok,d.fail,d.batch);
var N;g(this,d);p(this,d);if(H&&this.isMounted()&&!(this.isSubscribed()&&this.$bPropsLoaded))d.ok();else try{l||r(j,Array);var J;for(N=0;N<j.length;++N){J=j[N];j[N]=this.getSlot(j[N]);if(!j[N])throw Error("Could not find dynamic Property to reorder: "+J+" in "+this.toPathString());if(j[N].isFrozen())throw Error("Cannot reorder frozen Properties");}var X=this.getSlots().dynamic().properties();for(N=0;X.next();)++N;if(N===0)throw Error("Cannot reorder. No dynamic Props!");if(N!==j.length)throw Error("Cannot reorder. Actual count: "+
N+" != "+j.length);!l&&typeof this.checkReorder==="function"&&this.checkReorder(j,h);if(!H&&this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().reorder(this,j,d);else{var W=this.$map.getKeys(),da=function(ia){var ja;for(ja=0;ja<W.length;++ja)if(ia===W[ja])return ja;throw Error("Could not find Property in reorder: "+ia);},ba=function(ia){var ja;for(ja=0;ja<j.length;++ja)if(ia===j[ja].getName())return ja;throw Error("Could not find dynamic Property in reorder: "+ia);},aa=this;this.$map.sort(function(ia,
ja){var ma=aa.$map.get(ia),na=aa.$map.get(ja);return ma.isFrozen()&&na.isFrozen()?da(ia)<da(ja)?-1:1:ma.isFrozen()?-1:na.isFrozen()?1:ba(ia)<ba(ja)?-1:1});f(this,x,null,null,null,h);d.ok()}}catch(ka){d.fail(ka)}};a.Component.prototype.invoke=function(d){function j(){try{if(ba.isMounted()&&ba.$space.hasCallbacks())ba.$space.getCallbacks().invokeAction(ba,h,l,J);else{if(h.isProperty())N=F(ba.get(h).invoke(ba,l,H),null);else{var aa="do"+h.getName().capitalizeFirstLetter();if(typeof ba[aa]==="function")N=
F(ba[aa](l,H),null);else throw Error("Could not find do method for Action: "+h.getName());}J.ok(N)}}catch(ka){J.fail(ka)}}d=k(d,"slot");var h=d.slot,l=F(d.value,null),H=d.cx,N=null,J=new m(d.ok,d.fail,d.batch),X=0,W;g(this,J);p(this,J);try{h=this.getSlot(h);if(h===null)throw Error("Action does not exist: "+d.slot);X=this.getFlags(h);if(W=h.getParamType())if(a.hasType(l))if(l.getType().isNumber()&&W.isNumber()&&!l.getType().equals(W))l=W.getInstance().constructor.make(l.valueOf());else{if(!l.getType().is(W))throw Error("Invalid Action Argument: "+
l);}else throw Error("Invalid Action Argument: "+l);}catch(da){J.fail(da);return}var ba=this;(X&a.Flags.ASYNC)!==a.Flags.ASYNC?j():a.runAsync(j);return N};a.Component.prototype.fire=function(d){d=k(d,"slot");var j=d.slot,h=d.value,l=d.cx,H=l&&l.serverDecode,N=l&&l.commit;d=new m(d.ok,d.fail,d.batch);g(this,d);p(this,d);try{j=this.getSlot(j);if(!j.isTopic())throw Error("Slot is not a Topic: "+j.getName());h=F(h,null);if(!H)if(h!==null){if(!a.hasType(h))throw Error("Topic event is not a BValue");if(h.getType().isAbstract())throw Error("Topic event is has abstract Type: "+
h.getType());if(!h.getType().isValue())throw Error("Topic event is not a BValue: "+h.getType());}if(!N&&this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().fire(this,j,h,d);else{j.isProperty()&&this.get(j).fire(this,h,l);f(this,E,j,h,null,l)}}catch(J){d.fail(J)}};a.Component.prototype.$fw=function(d,j,h,l,H){if(d==="modified")f(this,D,j,null,null,h);else if(d==="fwSubscribed")f(this,ca,null,null,null,h);else if(d==="fwUnsubscribed")f(this,ha,null,null,null,h);else{if(d==="modifyTrap")if(this.isMounted()&&
this.$space.hasCallbacks()&&!(H&&H.commit)){this.$space.getCallbacks().set(this,j,h,l);return true}else return false;else if(d==="installKnob"){this.$knobs=this.$knobs||{};this.$knobCount=this.$knobCount||0;this.$knobs[j.getId()]=j;++this.$knobCount;f(this,Y,this.getSlot(j.getSourceSlotName()),j,null,h);return}else if(d==="uninstallKnob"){if(this.$knobs&&this.$knobs.hasOwnProperty(j)){var N=this.$knobs[j];delete this.$knobs[j];--this.$knobCount;f(this,Z,this.getSlot(h),N,null,l)}return}else if(d===
"setPermissions"){this.$permissionsStr=j;this.$permissions=null}return a.Component.$super.prototype.$fw.apply(this,arguments)}};a.Component.prototype.isMounted=function(){return this.$space!==null};a.Component.prototype.getComponentSpace=function(){return this.$space};a.Component.prototype.getHandle=function(){return this.$handle};a.Component.prototype.getOrdInSession=function(){return this.getHandle()===null?null:a.Ord.make("station:|h:"+this.getHandle())};var sa=function(){if(this.$lease){var d=
this.isSubscribed();this.$lease=false;this.$leaseTicket.cancel();!this.isSubscribed()&&d&&this.isMounted()&&this.$space.hasCallbacks()&&this.$space.getCallbacks().unsubscribe(["h:"+this.$handle],new m)}};a.Component.lease=function(d){function j(ba,aa){ba.$leaseTicket.cancel();ba.$leaseTicket=a.clock.schedule(function(){sa.call(ba)},aa)}d=k(d,"comps");var h=new m(d.ok,d.fail,d.batch);try{var l=d.comps;if(!l)throw Error("Must specify Components for lease");g(l,h);p(l,h);var H=F(d.time,1E4);if(a.hasType(H)&&
H.getType().is("baja:RelTime"))H=H.getMillis();r(H,Number);if(H<1)throw Error("Invalid lease time (time must be > 0 ms): "+H);l instanceof Array||(l=[l]);if(l.length===0)h.ok();else{var N=null,J;for(J=0;J<l.length;++J){r(l[J],a.Component);if(!l[J].isMounted())throw Error("Cannot subscribe unmounted Component!");N||(N=l[J].getComponentSpace());if(N!==l[J].getComponentSpace())throw Error("All Components must belong to the same Component Space!");}h.addOk(function(ba){var aa;for(aa=0;aa<l.length;++aa)j(l[aa],
H);ba()});J=[];var X=[],W;for(W=0;W<l.length;++W){if(!l[W].isSubscribed()){J.push("h:"+l[W].getHandle());X.push(l[W])}l[W].$lease=true}if(J.length===0||!N.hasCallbacks())h.ok();else{h.addOk(function(ba){var aa;for(aa=0;aa<X.length;++aa)try{X[aa].$fw("fwSubscribed")}catch(ka){a.error(ka)}ba()});N.getCallbacks().subscribe(J,h,d.importAsync)}}}catch(da){h.fail(da)}};a.Component.prototype.lease=function(d){d=k(d,"time");d.comps=this;a.Component.lease(d)};a.Component.prototype.isSubscribed=function(){return this.$lease||
this.$subs.length>0};a.Component.prototype.loadSlots=function(d){d=k(d);var j=d.cb;j||(j=new m(d.ok,d.fail,d.batch));g(this,j);p(this,j);try{!this.$bPropsLoaded&&this.isMounted()&&this.$space.hasCallbacks()?this.$space.getCallbacks().loadSlots("h:"+this.getHandle(),0,j):j.ok()}catch(h){j.fail(h)}};a.Component.prototype.serverSideCall=function(d){d=k(d);var j=d.typeSpec,h=d.methodName,l=F(d.value,null);d=new m(d.ok,d.fail,d.batch);g(this,d);p(this,d);try{r(j,String);r(h,String);r(l);if(this.isMounted()&&
this.$space.hasCallbacks())this.$space.getCallbacks().serverSideCall(this,j,h,l,d);else throw Error("Unable to make serverSideCall on non-proxy Component Space");}catch(H){d.fail(H)}};a.Component.prototype.getSlotPath=function(){function d(l){j.push(l.getName());l=l.getParent();l!==null&&d(l)}if(!this.isMounted())return null;var j=[];d(this);var h=j.reverse().join("/");if(h.length===0)h="/";return new a.SlotPath(h)};a.Component.prototype.toPathString=function(){if(!this.isMounted())return null;return this.getSlotPath().getBody()};
a.Component.prototype.getNavOrd=function(){if(!this.isMounted())return null;var d=this.$space.getAbsoluteOrd();if(d===null)return null;return a.Ord.make(d.toString()+"|"+this.getSlotPath().toString())};a.Component.prototype.getNavName=function(){var d=this.getName();if(d!==null)return d;return(d=this.getComponentSpace())&&d.getRootComponent()!==null?d.getNavName():null};a.Component.prototype.getNavDisplayName=function(){return this.getDisplayName()};a.Component.prototype.getNavParent=function(){return this.getParent()||
this.getComponentSpace()};a.Component.prototype.getNavChildren=function(d){d=k(d,"ok");if(this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().getNavChildren(this.getHandle(),new m(d.ok,d.fail,d.batch));else{var j=[];this.getSlots().properties().isComponent().each(function(h){(this.getFlags(h)&a.Flags.HIDDEN)===0&&j.push(this.get(h))});d.ok(j)}};a.Component.prototype.getNavIcon=function(){return this.getIcon()};a.Component.prototype.getNavDescription=function(){return this.getType().toString()};
a.event.mixin(a.Component.prototype);a.Component.prototype.getActionParameterDefault=function(d){d=k(d,"slot");var j=new m(d.ok,d.fail,d.batch);g(this,j);p(this,j);var h=this.getSlot(d.slot);try{if(h===null)throw Error("Unable to find Action: "+d.slot);if(!h.isAction())throw Error("Slot is not an Action: "+d.slot);if(this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().getActionParameterDefault(this,h,j);else{var l=h.getParamDefault();j.ok(l);return l}}catch(H){j.fail(H)}};a.Component.prototype.getKnobCount=
function(){return this.$knobCount||0};a.Component.prototype.getKnobs=function(d){if(!this.$knobCount)return B;if(arguments.length>0){d=this.getSlot(d);if(!d)throw Error("Invalid Slot: "+d);}var j,h,l=[];for(j in this.$knobs)if(this.$knobs.hasOwnProperty(j)){h=this.$knobs[j];if(d)h.getSourceSlotName()===d.getName()&&l.push(h);else l.push(h)}return l};a.Component.prototype.getLinks=function(d){var j=[];if(arguments.length===0)this.getSlots(function(h){return h.isProperty()&&h.getType().isLink()}).each(function(h){j.push(this.get(h))});
else{d=this.getSlot(d);if(d===null)throw Error("Invalid Slot: "+d);this.getSlots(function(h){return h.isProperty()&&h.getType().isLink()&&this.get(h).getTargetSlotName()===d.getName()}).each(function(h){j.push(this.get(h))})}return j};a.Component.prototype.makeLink=function(d){d=k(d);var j=new m(d.ok,d.fail,d.batch);g(this,j);p(this,j);try{r(d.source,a.Component);var h=d.source,l=h.getSlot(d.sourceSlot),H=this.getSlot(d.targetSlot);if(!H)throw Error("Invalid Source Slot");if(!l)throw Error("Invalid Target Slot");
if(this.isMounted()&&this.$space.hasCallbacks())this.$space.getCallbacks().makeLink(h,l,this,H,j);else{var N=a.$("baja:Link");j.ok(N);return N}}catch(J){j.fail(J)}};a.Component.prototype.getPermissions=function(){var d=this.$permissions;if(!d)d=typeof this.$permissionsStr==="string"?this.$permissions=a.Permissions.make(this.$permissionsStr):a.Permissions.all;return d};a.ComponentSpace=function(d,j,h){a.ComponentSpace.$super.call(this,{navName:d});this.$map={};this.$callbacks=this.$root=null;this.$host=
F(h,null);this.$ordInSession=F(j,"")}.$extend(a.NavContainer).registerType("baja:ComponentSpace");a.ComponentSpace.prototype.init=function(){};var ta=function(d){var j=d.getHandle();if(j!==null){if(this.$map.hasOwnProperty(j))throw Error("Fatal error: handle already used in Component Space: "+j);d.$space=this;this.$map[j]=d;for(j=d.getSlots().properties();j.next();)j.get().getType().isComponent()&&ta.call(this,d.get(j.get()))}},ua=function(d){var j=d.getHandle();if(j!==null){if(!this.$map.hasOwnProperty(j))throw Error("Fatal error: handle not mapped into Space: "+
j);var h=d.isSubscribed();d.$space=null;delete this.$map[j];j=d.$subs.slice();var l;for(l=0;l<j.length;++l)j[l].unsubscribe({comps:d});sa.call(d);if(h&&typeof d.unsubscribed==="function")try{d.unsubscribed()}catch(H){a.error(H)}for(h=d.getSlots().properties();h.next();)h.get().getType().isComponent()&&ua.call(this,d.get(h.get()))}};a.ComponentSpace.prototype.$fw=function(d,j){if(d==="mount")ta.call(this,j);else d==="unmount"&&ua.call(this,j)};a.ComponentSpace.prototype.getRootComponent=function(){return this.$root};
a.ComponentSpace.prototype.getOrdInSession=function(){return a.Ord.make(this.$ordInSession)};a.ComponentSpace.prototype.getAbsoluteOrd=function(){if(this.$host===null)return a.Ord.DEFAULT;return a.Ord.make(this.$host.getAbsoluteOrd().toString()+"|"+this.$ordInSession)};a.ComponentSpace.prototype.findByHandle=function(d){r(d,String);return F(this.$map[d],null)};a.ComponentSpace.prototype.resolveByHandle=function(d){d=k(d);var j=d.handle;d=new m(d.ok,d.fail);try{var h=this.findByHandle(j);if(h!==null)d.ok(h);
else throw Error("Could not find Component from Handle");}catch(l){d.fail(l)}};a.ComponentSpace.prototype.hasCallbacks=function(){return this.$callbacks!==null};a.ComponentSpace.prototype.getCallbacks=function(){return this.$callbacks};a.ComponentSpace.prototype.sync=function(d){d=k(d,"ok");(new m(d.ok,d.fail)).ok()};a.ComponentSpace.prototype.getNavOrd=function(){return this.$root===null?null:this.$root.getNavOrd()};a.ComponentSpace.prototype.getNavChildren=function(d){d=k(d,"ok");this.$root?this.$root.getNavChildren(d):
d.ok([])};a.ComponentSpace.prototype.getNavIcon=function(){return this.$root?this.$root.getNavIcon():a.ComponentSpace.$super.prototype.getNavIcon.call(this)};a.Host=function(){a.Host.$super.apply(this,arguments)}.$extend(a.NavContainer).registerType("baja:Host");a.Host.prototype.getNavOrd=function(){return this.getAbsoluteOrd()};a.Host.prototype.getAbsoluteOrd=function(){return null};a.LocalHost=function(){a.LocalHost.$super.call(this,{navName:"localhost",icon:"module://icons/x16/localhost.png"})}.$extend(a.Host).registerType("baja:LocalHost");
a.LocalHost.prototype.getAbsoluteOrd=function(){return a.Ord.make("local:")};a.Subscriber=function(){this.$comps=[]}.$extend(U);a.event.mixin(a.Subscriber.prototype);a.Subscriber.prototype.getComponents=function(){return this.$comps.slice()};a.Subscriber.prototype.subscribe=function(d){d=k(d,"comps");var j=d.comps,h=new m(d.ok,d.fail,d.batch);g(j,h);p(j,h);try{j instanceof Array||(j=[j]);var l,H;for(H=0;H<j.length;++H){l=j[H];r(l,a.Component);if(!l.isMounted())throw Error("Cannot subscribe unmounted Component!");
}var N=null,J=[],X=[],W;for(H=0;H<j.length;++H){l=j[H];N||(N=l.getComponentSpace());W=l.isSubscribed();this.$comps.contains(l)||this.$comps.push(l);l.$subs.contains(this)||l.$subs.push(this);if(l.isSubscribed()&&!W){J.push("h:"+l.getHandle());X.push(l)}}if(J.length>0&&N.hasCallbacks()&&F(d.netCall,true)){h.addOk(function(ba){var aa;for(aa=0;aa<X.length;++aa)try{X[aa].$fw("fwSubscribed")}catch(ka){a.error(ka)}ba()});N.getCallbacks().subscribe(J,h,d.importAsync)}else h.ok()}catch(da){h.fail(da)}};a.Subscriber.prototype.$ordSubscribe=
function(d){var j=d.ords,h=d.space;d=new m(d.ok,d.fail,d.batch);var l=this;try{d.addOk(function(N,J,X){var W,da;for(J=0;J<X.length;++J){if(W=h.findByHandle(X[J])){da=W.isSubscribed();l.$comps.contains(W)||l.$comps.push(W);W.$subs.contains(l)||W.$subs.push(l);if(W.isSubscribed()&&!da)try{W.$fw("fwSubscribed")}catch(ba){a.error(ba)}}else a.error("Could not Batch Resolve Subscribe: "+X[J]);N()}});h.getCallbacks().subscribe(j,d,false)}catch(H){d.fail(H)}};a.Subscriber.prototype.unsubscribe=function(d){d=
k(d,"comps");var j=d.comps;d=new m(d.ok,d.fail,d.batch);g(this,d);p(this,d);try{j instanceof Array||(j=[j]);var h,l,H,N;for(l=0;l<j.length;++l){h=j[l];r(h,a.Component)}var J=null,X=[],W;for(l=0;l<j.length;++l){h=j[l];J||(J=h.getComponentSpace());W=h.isSubscribed();for(H=0;H<this.$comps.length;++H)if(this.$comps[H]===h){this.$comps.splice(H,1);break}for(N=0;N<h.$subs.length;++N)if(h.$subs[N]===this){h.$subs.splice(N,1);break}!h.isSubscribed()&&W&&h.isMounted()&&X.push("h:"+h.getHandle())}X.length>
0&&J.hasCallbacks()?J.getCallbacks().unsubscribe(X,d):d.ok()}catch(da){d.fail(da)}};a.Subscriber.prototype.unsubscribeAll=function(d){d=k(d);d.comps=this.$comps.slice();this.unsubscribe(d)};a.Subscriber.prototype.isSubscribed=function(d){r(d,a.Component);return this.$comps.contains(d)};var qa=function(){qa.$super.apply(this,arguments)}.$extend(a.Component).registerType("control:ControlPoint");qa.prototype.getFacets=function(d){if(d)if(d=this.getSlot(d))if(d.getName().match(/^(out|in[0-9][1-6]?|fallback|override|emergencyOverride|set)/))return this.get("facets");
return qa.$super.prototype.getFacets.apply(this,arguments)}})(baja,BaseBajaObj);
(function(a){function U(b){var e=null;if(typeof b.apt==="string")e=a.lt(b.apt);return e}function R(b){var e=null;if(typeof b.apd==="object")e=G(b.apd,I);return e}function T(b){var e=null;if(typeof b.art==="string")e=a.lt(b.art);return e}function V(b){var e=null;if(typeof b.tet==="string")e=a.lt(b.tet);return e}function O(b,e,f){var g=b.$autoGen=b.$autoGen||{},p=f.getName();if(b=g.hasOwnProperty(p)?g[p]:null)for(var v in b){if(b.hasOwnProperty(v))e[v]=b[v]}else{g[p]=b={};g=f.getName().capitalizeFirstLetter();
v=0;if(f.isProperty()){var B="get"+g,r=B,F=B+"Display",k=F,m="set"+g,A=m;v=0;if(g!=="Icon")for(;e[r]!==undefined||e[k]!==undefined||e[A]!==undefined;){r=B+ ++v;k=F+v;A=m+v}e[r]=b[r]=function(){var n=this.get(p);return n.getType().isNumber()?n.valueOf():n};e[k]=b[k]=function(){return this.getDisplay(p)};e[A]=b[A]=function(n){n=C(n,"value");n.slot=p;this.set(n)}}B=p;if(f.isAction()){for(v=0;e[B]!==undefined;)B=p+ ++v;e[B]=b[B]=function(n){n=C(n,"value");n.slot=p;return this.invoke(n)}}if(f.isTopic()){g=
f="fire"+g;for(v=0;e[g]!==undefined;)g=f+ ++v;e[g]=b[g]=function(n){n=C(n,"value");n.slot=p;this.fire(n)}}}}function Q(b,e){if(b){var f,g;if((b.nm==="p"||b.nm==="a"||b.nm==="t")&&b.t)if(a.registry.hasType(b.t)){f=a.lt(b.t);if((f.isComplex()||f.isFrozenEnum())&&!f.hasContract())e[b.t]=b.t}else e[b.t]=b.t;if(b instanceof Array)for(f=0;f<b.length;++f)Q(b[f],e);else if(b instanceof Object)for(g in b)b.hasOwnProperty(g)&&Q(b[g],e)}}function y(b,e){var f;if(e.getType().isSimple())b.v=e.encodeToString();
else for(f=e.getSlots();f.next();){var g=b,p=e,v=f.get();if(v!==null){var B=null,r=false;if(v.isProperty()){B=p.get(v);if(v.isFrozen())if(B.equivalent(v.getDefaultValue()))r=true}else r=true;var F=p.getFlags(v);if(!(F===v.getDefaultFlags()&&r)){var k={};if(v.isProperty())k.nm="p";else if(v.isAction())k.nm="a";else if(v.isTopic())k.nm="t";k.n=v.getName();if((!v.isFrozen()&&F!==0||F!==v.getDefaultFlags())&&p.getType().isComponent())k.flags=F;p=v.getFacets();if(!v.isFrozen()&&p.getKeys().length>0)k.x=
p.encodeToString();if(B!==null&&B.getType().isComponent())if(B.isMounted())k.h=B.getHandle();if(!r&&v.isProperty()){k.t=B.getType().getTypeSpec();y(k,B)}if(!g.s)g.s=[];g.s.push(k)}}}}var K=a.def,C=a.objectify,I=a.$serverDecodeContext={serverDecode:true},G;a.bson=new BaseBajaObj;var u=function(b,e){u.$super.call(this,b.n,b.dn);this.$bson=b;this.$complex=e}.$extend(a.Property);u.prototype.isFrozen=function(){return true};u.prototype.$getValue=function(){if(this.$val===undefined){var b=this.$val=G(this.$bson.v,
I);if(b.getType().isComplex()&&this.$complex){b.$parent=this.$complex;b.$propInParent=this}}return this.$val};u.prototype.$isValueDecoded=function(){return this.$val!==undefined};u.prototype.$setValue=function(b){this.$val=b};u.prototype.getFlags=function(){if(this.$flags===undefined)this.$flags=this.$bson.f===undefined?0:a.Flags.decodeFromString(this.$bson.f);return this.$flags};u.prototype.$setFlags=function(b){this.$flags=b};u.prototype.getFacets=function(){if(this.$facets===undefined)this.$facets=
this.$bson.x===undefined?a.Facets.DEFAULT:a.Facets.DEFAULT.decodeFromString(this.$bson.x);return this.$facets};u.prototype.$setFacets=function(b){this.$facets=b};u.prototype.getDefaultFlags=function(){if(this.$defFlags===undefined)this.$defFlags=this.$bson.f===undefined?0:a.Flags.decodeFromString(this.$bson.f);return this.$defFlags};u.prototype.getDefaultValue=function(){if(this.$defVal===undefined)this.$defVal=G(this.$bson.v,I);return this.$defVal};u.prototype.getType=function(){if(this.$val===undefined){if(this.$initType===
undefined)this.$initType=a.lt(this.$bson.v.t);return this.$initType}else return this.$getValue().getType()};u.prototype.$getDisplay=function(){if(this.$display===undefined)this.$display=this.$bson.v.d||"";return this.$display};u.prototype.$setDisplay=function(b){this.$display=b};var o=function(b){o.$super.call(this,b.n,b.dn);this.$bson=b}.$extend(a.Action);o.prototype.isFrozen=u.prototype.isFrozen;o.prototype.getFlags=u.prototype.getFlags;o.prototype.$setFlags=u.prototype.$setFlags;o.prototype.getFacets=
u.prototype.getFacets;o.prototype.$setFacets=u.prototype.$setFacets;o.prototype.getDefaultFlags=u.prototype.getDefaultFlags;o.prototype.getParamType=function(){if(this.$paramType===undefined)this.$paramType=U(this.$bson);return this.$paramType};o.prototype.getParamDefault=function(){if(this.$paramDef===undefined)this.$paramDef=R(this.$bson);return this.$paramDef};o.prototype.getReturnType=function(){if(this.$returnType===undefined)this.$returnType=T(this.$bson);return this.$returnType};var q=function(b){q.$super.call(this,
b.n,b.dn);this.$bson=b}.$extend(a.Topic);q.prototype.isFrozen=u.prototype.isFrozen;q.prototype.getFlags=u.prototype.getFlags;q.prototype.$setFlags=u.prototype.$setFlags;q.prototype.getFacets=u.prototype.getFacets;q.prototype.$setFacets=u.prototype.$setFacets;q.prototype.getDefaultFlags=u.prototype.getDefaultFlags;q.prototype.getEventType=function(){if(this.$eventType===undefined)this.$eventType=V(this.$bson);return this.$eventType};a.bson.decodeComplexContract=function(b,e){for(var f=[],g=b,p,v;g&&
g.isComplex();){f.push(g);g=g.getSuperType()}for(g=f.length-1;g>=0;--g){f[g].hasContract()||f[g].loadContract();if(v=f[g].getContract())for(p=0;p<v.length;++p){var B=b,r=e,F=v[p],k;k=F;var m=void 0;m=k.st;if(m==="p")m=new u(k,r);else if(m==="a")m=new o(k);else if(m==="t")m=new q(k);else throw Error("Invalid BSON: Cannot decode: "+JSON.stringify(k));k=m;F=F.n;r.$map.contains(F)||O(B,r,k);r.$map.put(F,k)}}};a.bson.scanForUnknownTypes=function(b){var e={},f=[],g;Q(b,e);for(g in e)e.hasOwnProperty(g)&&
f.push(g);return f};a.bson.decodeKnob=function(b){var e=a.Ord.make(b.to);return{getId:function(){return b.id},getSourceSlotName:function(){return b.ss},getTargetOrd:function(){return e},getTargetSlotName:function(){return b.ts}}};a.bson.decodeValue=function(b,e,f){e=e||{};if(!(b.nm==="p"||b.nm==="a"||b.nm==="t"))return null;var g=null,p=K(b.nm,"p"),v=K(b.stub,false),B,r;if(f)g=f.getSlot(b.n);if(g!==null){if(b.f!==undefined){B=a.Flags.decodeFromString(b.f);B!==g.getFlags()&&f.setFlags({slot:g,flags:B,
cx:e})}b.dn!==undefined&&g.$setDisplayName(b.dn);if(!g.isProperty())return null}else if(p!=="p")throw Error("Error decoding Slot from BSON: Missing frozen Slot: "+p);p=b.t===undefined?g.$getValue():a.$(b.t);if(p.getType().isSimple()&&b.v!==undefined)p=p.decodeFromString(b.v);if(p.getType().isAction()){p.$paramType=U(b);p.$paramDef=R(b);p.$returnType=T(b)}else if(p.getType().isTopic())p.$eventType=V(b);if(p.getType().isComponent()){if(b.h!==undefined)p.$handle=b.h;if(b.nk)for(r=0;r<b.nk.length;++r)p.$fw("installKnob",
a.bson.decodeKnob(b.nk[r]),e);b.l&&typeof b.l.p==="string"&&p.$fw("setPermissions",b.l.p);if(!v)p.$bPropsLoaded=true}var F;if(f)try{e.displayName=K(b.dn,"");e.display=K(b.d,"");if(g!==null)f.set({slot:g,value:p,cx:e});else if(f.getType().isComponent()){F=a.Facets.DEFAULT.decodeFromString(K(b.x,""));B=a.Flags.decodeFromString(K(b.f,"0"));f.add({slot:b.n,value:p,flags:B,facets:F,cx:e})}}finally{e.displayName=undefined;e.display=undefined}if(b.s)for(f=0;f<b.s.length;++f)G(b.s[f],e,p);return p};G=a.bson.decodeValue;
a.bson.encodeValue=function(b){var e={nm:"p"};if(b.getType().isComponent())if(b.isMounted())e.h=b.getHandle();e.t=b.getType().getTypeSpec();y(e,b);return e}})(baja);
(function(a){function U(k,m){if(k.getType().getTypeSpec()!==m.getType().getTypeSpec())throw Error("LoadOp Types differ: "+k.getType()+" - "+m.getType());if(m.getHandle()!==k.getHandle())throw Error("LoadOp Handle Error: "+k.getHandle()+" - "+m.getHandle());if(k.getPropertyInParent()!==null){m.getPropertyInParent().$setDisplayName(k.getPropertyInParent().$getDisplayName());m.getPropertyInParent().$setDisplay(k.getPropertyInParent().$getDisplay())}m.$fw("setPermissions",k.$permissionsStr);if(k.$bPropsLoaded){m.$bPropsLoaded=
true;var A={},n=m.$map.$map,w;for(w in n)if(n.hasOwnProperty(w)&&n[w].isProperty())A[w]=n[w];var z=k.$map.$map,D,c,i,s,x;n=false;var E;for(w in z)if(z.hasOwnProperty(w)){c=z[w];D=c.getName();i=m.getSlot(D);s=k.getFlags(c);if(!c.isFrozen()){E=E||[];E.push(D)}if(i===null){x={commit:true,serverDecode:true,displayName:c.$getDisplayName(),display:c.$getDisplay()};i=k.get(D);if(i.$parent)i.$parent=null;m.add({slot:D,value:i,flags:s,facets:k.getFacets(c),cx:x})}else{c.isFrozen()||(n=true);delete A[D];s!==
i.getFlags()&&m.setFlags({slot:i,flags:s,cx:F});R(k,c,m,i)}}for(var L in A)A.hasOwnProperty(L)&&m.remove({slot:A[L],cx:F});A=k.$knobs;L=m.$knobs;var S,Y;if(A){S=[];for(w in A)if(A.hasOwnProperty(w))if(L)L.hasOwnProperty(w)||S.push(A[w]);else S.push(A[w])}if(L){Y=[];for(w in L)if(L.hasOwnProperty(w))if(A)A.hasOwnProperty(w)||Y.push(L[w]);else Y.push(L[w])}if(S)for(w=0;w<S.length;++w)m.$fw("installKnob",S[w],F);if(Y)for(S=0;S<Y.length;++S)m.$fw("uninstallKnob",Y[S].getId(),Y[S].getSourceSlotName(),
F);n&&E&&m.reorder({dynamicProperties:E,cx:F})}}function R(k,m,A,n){n.$setDisplayName(m.$getDisplayName());if(m.isProperty())m.isFrozen()&&!m.$isValueDecoded()&&!n.$isValueDecoded()&&m.getType().getTypeSpec()===n.getType().getTypeSpec()||T(k.get(m),A,n,m.$getDisplay())}function T(k,m,A,n){var w=m.get(A),z=k.getType().isComponent();A.$setDisplay(n);if(k.getType().getTypeSpec()!==w.getType().getTypeSpec()||k.getType().isSimple()||w.getType().isComponent()&&w.getHandle()===null){if(k.$parent)k.$parent=
null;m.set({slot:A,value:k,cx:F})}else if(z)U(k,w);else{m=k.$map.$map;for(var D in m)if(m.hasOwnProperty(D)){A=m[D];R(k,A,w,w.getSlot(A.getName()))}}}var V=a.strictArg,O=a.def,Q=a.$serverDecodeContext,y=a.bson.decodeValue,K=a.comm.Callback,C={},I=function(){this.$arg=null}.$extend(BaseBajaObj);I.id="";I.prototype.getId=function(){return this.constructor.id};I.prototype.syncTo=function(k,m){var A={nm:"sync",ver:1,ops:[this.$arg]},n=false,w;m.addOk(function(D){n||D(w)});var z=new K(a.ok,m.fail,m.getBatch());
z.addOk(function(D,c,i){w=i;D(i)});z.addFail(function(D,c,i){n=true;c(i)});a.comm.serverHandlerCall(k.getAbsoluteOrd().toString(),"syncTo",A,z);k.getCallbacks().poll(m)};var G=function(k,m,A,n,w){G.$super.apply(this,arguments);var z={nm:this.getId(),h:k.getHandle(),b:a.bson.encodeValue(A)};if(m!==null)z.n=m;if(n!==0)z.f=a.Flags.encodeToString(n);if(w!==null&&w!==a.Facets.DEFAULT)z.facets=w.encodeToString();this.$arg=z}.$extend(I);G.id="a";C[G.id]=G;G.decodeAndCommit=function(k,m){if(k!==null&&k.get(m.n)===
null){var A=O(m.n,null),n=m.dn,w=m.b.d,z=a.Flags.decodeFromString(O(m.f,"")),D=a.Facets.DEFAULT.decodeFromString(O(m.facets,""));k.add({slot:A,value:y(m.b,Q),flags:z,facets:D,cx:{commit:true,displayName:n,display:w,serverDecode:true}})}};var u=function(k,m,A){u.$super.apply(this,arguments);this.$arg={nm:this.getId(),h:k.getHandle(),n:m.reverse().join("/"),b:a.bson.encodeValue(A)}}.$extend(I);u.id="s";C[u.id]=u;u.decodeAndCommit=function(k,m){if(k!==null){var A=m.n.split("/"),n=m.dn,w=m.b.d,z=k,D=
null,c;for(c=0;c<A.length;++c){if(D!==null)z=z.get(D);D=A[c]}z.set({slot:D,value:y(m.b,Q),cx:{commit:true,serverDecode:true,syncStructVals:true,displayName:n,display:w}})}};var o=function(k,m){o.$super.apply(this,arguments);this.$arg={nm:this.getId(),h:k.getHandle(),n:m.getName()}}.$extend(I);o.id="v";C[o.id]=o;o.decodeAndCommit=function(k,m){if(k!==null){var A=k.getSlot(m.n);A!==null&&k.remove({slot:A,cx:{commit:true,serverDecode:true}})}};var q=function(k,m,A){q.$super.apply(this,arguments);var n=
{nm:this.getId(),h:k.getHandle(),n:m.getName()};if(A!==null)n.b=a.bson.encodeValue(A);this.$arg=n}.$extend(I);q.id="t";C[q.id]=q;q.decodeAndCommit=function(k,m){if(k!==null){var A=k.getSlot(m.n),n="",w=null;if(m.b!==undefined){w=y(m.b,Q);n=m.b.d}A!==null&&k.fire({slot:A,value:w,cx:{commit:true,display:n,serverDecode:true}})}};var b=function(){b.$super.apply(this,arguments)}.$extend(I);b.id="l";C[b.id]=b;b.decodeAndCommit=function(k,m){k!==null&&U(y(m.b,Q),k)};var e=function(k,m,A){e.$super.apply(this,
arguments);this.$arg={nm:this.getId(),h:k.getHandle(),o:m,n:A}}.$extend(I);e.id="r";C[e.id]=e;e.decodeAndCommit=function(k,m){if(k!==null){var A=m.n,n=m.dn,w=m.d,z=k.getSlot(m.o);z!==null&&k.rename({slot:z,newName:A,cx:{commit:true,displayName:n,display:w,serverDecode:true}})}};var f=function(k,m){f.$super.apply(this,arguments);this.$arg={nm:this.getId(),h:k.getHandle(),o:m.join(";")}}.$extend(I);f.id="o";C[f.id]=f;f.decodeAndCommit=function(k,m){k!==null&&k.reorder({dynamicProperties:m.o.split(";"),
cx:{commit:true,serverDecode:true}})};var g=function(k,m,A){g.$super.apply(this,arguments);this.$arg={nm:this.getId(),h:k.getHandle(),n:m.getName(),f:a.Flags.encodeToString(A)}}.$extend(I);g.id="f";C[g.id]=g;g.decodeAndCommit=function(k,m){if(k!==null){var A=m.n,n=a.Flags.decodeFromString(m.f);k.setFlags({slot:A,flags:n,cx:{commit:true,displayName:m.dn,display:m.d,serverDecode:true}})}};var p=function(k,m,A){p.$super.apply(this,arguments);this.$arg={nm:this.getId(),h:k.getHandle(),n:m.getName(),x:A.encodeToString()}}.$extend(I);
p.id="x";C[p.id]=p;p.decodeAndCommit=function(k,m){if(k!==null){var A=m.n,n=a.Facets.DEFAULT.decodeFromString(O(m.x,""));k.setFacets({slot:A,facets:n,cx:{commit:true,displayName:m.dn,display:m.d,serverDecode:true}})}};var v=function(){v.$super.apply(this,arguments);throw Error("Unsupported");}.$extend(I);v.id="k";C[v.id]=v;v.decodeAndCommit=function(k,m){k!==null&&k.$fw("installKnob",a.bson.decodeKnob(m.nk),{commit:true,serverDecode:true})};var B=function(){B.$super.apply(this,arguments);throw Error("Unsupported");
}.$extend(I);B.id="j";C[B.id]=B;B.decodeAndCommit=function(k,m){k!==null&&k.$fw("uninstallKnob",m.id,m.ss,{commit:true,serverDecode:true})};var r=function(k){this.$space=k};r.prototype.loadSlots=function(k,m,A){var n=this.$space;k={o:k,d:m};var w=false;A.addOk(function(z){w||z()});m=new K(a.ok,A.fail,A.getBatch());m.addFail(function(z,D,c){w=true;D(c)});a.comm.serverHandlerCall(n.getAbsoluteOrd().toString(),"loadSlots",k,m);this.poll(A)};r.prototype.loadSlotPath=function(k,m,A,n){var w=this.$space;
n=a.def(n,true);A.addOk(function(z,D,c){var i=function(){w.$fw("commitSlotInfo",c);z()},s=function(L){D(L)};if(c){var x=a.bson.scanForUnknownTypes(c),E=new a.comm.Batch;if(x.length>0){a.importTypes({typeSpecs:x,ok:i,fail:s,batch:E});n?E.commit():E.commitSync()}else i()}else i()});k={spi:k,bo:m.getNavOrd().toString()};a.comm.serverHandlerCall(w.getAbsoluteOrd().toString(),"loadSlotPath",k,A)};r.prototype.subscribe=function(k,m,A){V(k,Array);A=O(A,false);if(k.length===0)throw Error("Cannot Subscribe: nothing to subscribe too");
var n=this.$space;m.addOk(function(w,z,D){var c=function(){n.$fw("commitSyncOps",D.e.ops);w(D.h)},i=a.bson.scanForUnknownTypes(D);if(i.length>0){var s=new a.comm.Batch;a.importTypes({typeSpecs:i,ok:c,fail:z,batch:s});A?s.commit():s.commitSync()}else c()});a.comm.serverHandlerCall(n.getAbsoluteOrd().toString(),"sub",k,m)};r.prototype.unsubscribe=function(k,m){V(k,Array);if(k.length===0)throw Error("Cannot Unsubscribe: nothing to unsubscribe too");var A=function(w){try{w.$fw("fwUnsubscribed")}catch(z){a.error(z)}},
n=this.$space;m.addOk(function(w){var z;for(z=0;z<k.length;++z)a.Ord.make(k[z]).get({ok:A,base:n});w()});a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"unsub",k,m)};r.prototype.invokeAction=function(k,m,A,n){n.addOk(function(w,z,D){z=null;if(D!==null)z=y(D,Q);w(z)});k={h:k.getHandle(),a:m.getName()};if(A!==null)k.b=a.bson.encodeValue(A);a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"invokeAction",k,n)};r.prototype.getActionParameterDefault=function(k,m,A){A.addOk(function(n,
w,z){n(z===null?null:y(z,Q))});a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"getActionParameterDefault",{h:k.getHandle(),a:m.getName()},A)};r.prototype.serverSideCall=function(k,m,A,n,w){w.addOk(function(z,D,c){if(c!==null){var i=function(){z(y(c,Q))},s=a.bson.scanForUnknownTypes(c);if(s.length>0){var x=new a.comm.Batch;a.importTypes({typeSpecs:s,ok:i,fail:D,batch:x});w.getBatch().isAsync()?x.commit():x.commitSync()}else i()}else z(null)});k={h:k.getHandle(),ts:m,m:A};if(n!==null)k.b=
a.bson.encodeValue(n);a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"serverSideCall",k,w)};r.prototype.poll=function(k){a.comm.poll(k)};r.prototype.handleToPath=function(k,m){m.addOk(function(A,n,w){A(new a.SlotPath(w))});a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"handleToPath",k,m)};r.prototype.getService=function(k,m){V(k,String);var A=this;m.addOk(function(n,w,z){a.Ord.make(z.toString()).get({base:A.$space,ok:n,fail:w})});this.serviceToPath(k,m)};r.prototype.serviceToPath=
function(k,m){m.addOk(function(A,n,w){A(new a.SlotPath(w))});a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"serviceToPath",k,m)};r.prototype.makeLink=function(k,m,A,n,w){w.addOk(function(z,D,c){z(y(c,Q))});k={s:k.getHandle(),ss:m.getName(),t:A.getHandle(),ts:n.getName()};a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"makeLink",k,w)};r.prototype.getNavChildren=function(k,m){m.addOk(function(A,n,w){(new a.BatchResolve(w)).resolve({ok:function(){A(this.getTargetObjects())},
fail:n})});a.comm.serverHandlerCall(this.$space.getAbsoluteOrd().toString(),"navChildren",k,m)};r.prototype.add=function(k,m,A,n,w,z){z.addOk(function(D,c,i){c=m;if(i&&i instanceof Array&&i.length>0&&i[0].nn)c=i[0].nn;D(k.getSlot(c))});(new G(k,m,A,n,w)).syncTo(k.getComponentSpace(),z)};r.prototype.set=function(k,m,A,n){(new u(k,m,A)).syncTo(k.getComponentSpace(),n)};r.prototype.remove=function(k,m,A){(new o(k,m)).syncTo(k.getComponentSpace(),A)};r.prototype.rename=function(k,m,A,n){(new e(k,m,A)).syncTo(k.getComponentSpace(),
n)};r.prototype.reorder=function(k,m,A){(new f(k,m)).syncTo(k.getComponentSpace(),A)};r.prototype.setFlags=function(k,m,A,n){(new g(k,m,A)).syncTo(k.getComponentSpace(),n)};r.prototype.setFacets=function(k,m,A,n){(new p(k,m,A)).syncTo(k.getComponentSpace(),n)};r.prototype.fire=function(k,m,A,n){(new q(k,m,A)).syncTo(k.getComponentSpace(),n)};a.BoxComponentSpace=function(){a.BoxComponentSpace.$super.apply(this,arguments);this.$callbacks=new r(this)}.$extend(a.ComponentSpace);a.BoxComponentSpace.prototype.init=
function(k){function m(z){A.$fw("commitSyncOps",z.ops)}var A=this;try{a.comm.makeServerHandler(this.getAbsoluteOrd().toString(),"box:ComponentSpaceSessionHandler",this.getAbsoluteOrd().toString(),m,new K(a.ok,a.fail,k),true);var n=new K(function(z){A.$root=a.$(z.t);A.$root.$handle=z.h;A.$fw("mount",A.$root)},a.fail,k);a.comm.serverHandlerCall(this.getAbsoluteOrd().toString(),"loadRoot",null,n,true)}catch(w){a.fail(w)}};a.BoxComponentSpace.prototype.sync=function(k){k=a.objectify(k,"ok");k=new K(k.ok,
k.fail,k.batch);try{this.$callbacks.poll(k)}catch(m){k.fail(m)}};a.BoxComponentSpace.prototype.resolveByHandle=function(k){k=a.objectify(k);var m=k.handle;k=new K(k.ok,k.fail,k.batch);var A=this;try{var n=this.findByHandle(m);if(n!==null)k.ok(n);else{k.addOk(function(z,D,c){a.Ord.make(c.toString()).get({base:A,ok:z,fail:D})});this.$callbacks.handleToPath(m,k)}}catch(w){k.fail(w)}};var F={commit:true,serverDecode:true,syncStructVals:true};a.BoxComponentSpace.prototype.$fw=function(k,m){if(k==="commitSyncOps"){V(m,
Array);var A,n,w;for(w=0;w<m.length;++w){A=m[w];try{if(A.h!==undefined){if((n=this.findByHandle(A.h))&&n.getPropertyInParent()!==null){n.getPropertyInParent().$setDisplayName(A.cdn);n.getPropertyInParent().$setDisplay(A.cd)}}else n=null;C.hasOwnProperty(A.nm)&&typeof C[A.nm]==="function"&&typeof C[A.nm].id==="string"&&C[A.nm].decodeAndCommit(n,A)}catch(z){a.error(z)}}}else if(k==="commitSlotInfo"){var D,c,i;for(i=0;i<m.length;++i){c=m[i];A=this.findByHandle(c.h);if(A!==null&&!A.$bPropsLoaded){w=y(c.v,
Q);if(w.getType().isComponent())w.$bPropsLoaded=false;n={commit:true,serverDecode:true};if(c.dn)n.displayName=c.dn;if(c.d)n.display=c.d;D=A.getSlot(c.n);if(D===null)A.add({slot:c.n,value:w,flags:a.Flags.decodeFromString(O(c.f,"")),facets:a.Facets.DEFAULT.decodeFromString(O(c.x,"")),cx:n});else{c.dn&&D.$setDisplayName(c.dn);T(w,A,D,c.d)}}}}else a.BoxComponentSpace.$super.prototype.$fw.apply(this,arguments)}})(baja);
(function(a,U){function R(b,e){if(e>0){b.size();var f;for(f=0;f<e;++f)b.remove(0);return true}return false}function T(b,e,f,g,p,v){var B=new o(e),r=e.object;B.slotPath=f;var F=B.slotPath,k=null,m=null;v=K(v,true);var A=F.constructor!==a.SlotPath;if(r.getType().is("baja:VirtualGateway")&&A){k=r.getVirtualSpace();m=k.getRootComponent()}else if(r.getType().is("baja:ComponentSpace")){k=r;m=r.getRootComponent()}else if(r.getType().isComponent()){k=r.getComponentSpace();m=F.isAbsolute()?k.getRootComponent():
r}else throw Error("Slot Scheme Unsupported ORD base: "+r.getType());if(A&&F.getBody()===""){B.object=k;g.resolveNext(B,p)}else{if(v)v=k===null?false:k.hasCallbacks();var n=m,w,z=w=null,D=-1,c=F.getBackupDepth(),i;for(i=0;i<c;++i){n=m=m.getType().isComponent()?m.getParent():null;if(n===null)throw Error("Cannot walk backup depth: "+r);}for(r=0;r<F.depth();++r){w=F.nameAt(r);if(A)w=a.SlotPath.escape(w);if(n.getType().isComplex())w=n.getSlot(w);else throw Error("Unable to resolve ORD: "+F);if(w===null){if(v){D=
r;break}throw Error("Unresolved ORD - unable to resolve SlotPath");}if(!w.isProperty()){if(r!==F.depth()-1)throw Error("Unresolved ORD - Actions/Topics must be at final depth: "+F);B.container=m;B.slot=w;g.resolveNext(B,p);return}n=n.get(w);if(n.getType().isComponent()&&n.$handle===null&&k!==null){if(v){D=r;break}throw Error("Unresolved ORD - unable to load handle for Component");}if(z===null&&n.getType().is("baja:IPropertyContainer"))m=n;else{if(z===null)z=[];z.push(w)}}if(v&&D>-1){n=new a.comm.Batch;
B="slot:";if(F.isAbsolute())B+="/";z=[];for(v=0;v<F.depth();++v){if(v>=D)z.push({o:B,sn:A?a.SlotPath.escape(F.nameAt(v)):F.nameAt(v)});if(v>0)B+="/";B+=A?a.SlotPath.escape(F.nameAt(v)):F.nameAt(v)}k.getCallbacks().loadSlotPath(z,m,new I(function(){b.resolve(e,f,g,p,false)},function(s){p.callback.fail(s)},n));n.commit()}else{if(w===null&&F.depth()>0)throw Error("Unable to resolve ORD: "+F);if(z===null)B.object=m;else{w=z[0];B.container=m;B.object=n;B.slot=w;B.propertyPath=z}g.resolveNext(B,p)}}}function V(b,
e,f,g,p,v){var B=new o(e),r=e.object;B.slotPath=f;var F=B.slotPath,k=null,m=null,A=F.constructor!==a.SlotPath;v=K(v,true);if(r.getType().is("baja:VirtualGateway")&&A){k=r.getVirtualSpace();m=k.getRootComponent()}else if(r.getType().is("baja:ComponentSpace")){k=r;m=r.getRootComponent()}else if(r.getType().isComponent()){k=r.getComponentSpace();m=F.isAbsolute()?k.getRootComponent():r}else throw Error("Slot Scheme Unsupported ORD base: "+r.getType());if(A&&F.getBody()===""){B.object=k;g.resolveNext(B,
p)}else{if(v)v=k===null?false:k.hasCallbacks();var n=m,w,z=w=null,D=new a.comm.Batch,c=0,i=F.getBackupDepth(),s;for(s=0;s<i;++s){n=m=m.getType().isComponent()?m.getParent():null;if(n===null)throw Error("Cannot walk backup depth: "+r);}m.getType().isComplex()&&m.loadSlots({ok:a.ok,fail:q,batch:D});if(D.isEmpty())for(r=0;r<F.depth();++r){w=F.nameAt(r);if(A)w=a.SlotPath.escape(w);if(n.getType().isComplex()){n.loadSlots({ok:a.ok,fail:q,batch:D});w=n.getSlot(w)}else throw Error("Unable to resolve ORD: "+
F);if(v&&!D.isEmpty()){c=r;break}if(w===null)throw Error("Unresolved ORD - unable to resolve SlotPath");if(!w.isProperty()){if(r!==F.depth()-1)throw Error("Unresolved ORD - Actions/Topics must be at final depth: "+F);B.container=m;B.slot=w;g.resolveNext(B,p);return}n=n.get(w);if(n.getType().isComponent()&&n.$handle===null&&k!==null){if(v){c=r;break}throw Error("Unresolved ORD - unable to load handle for Component");}if(z===null&&n.getType().is("baja:IPropertyContainer"))m=n;else{if(z===null)z=[];
z.push(w)}}if(!D.isEmpty()&&v){B="slot:";if(F.isAbsolute())B+="/";for(v=0;v<F.depth();++v){if(v>0)B+="/";B+=A?a.SlotPath.escape(F.nameAt(v)):F.nameAt(v);v>=c&&k.getCallbacks().loadSlots(B,0,new I(a.ok,q,D))}a.comm.poll(new I(function(){b.resolve(e,f,g,p,false)},function(x){p.callback.fail(x)},D));D.commit()}else{if(w===null&&F.depth()>0)throw Error("Unable to resolve ORD: "+F);if(z===null)B.object=m;else{w=z[0];B.container=m;B.object=n;B.slot=w;B.propertyPath=z}g.resolveNext(B,p)}}}function O(b){b=
b.charCodeAt(0);var e=b.toString(16),f="$";f+=b<16?"0"+e:b<256?e:b<4096?"u0"+e:"u"+e;return f}function Q(b){var e;if(b)e=/^([^?]*)(?:[\?](.*))?$/.exec(b);if(!e||e&&e.length<2)throw Error("Invalid view query: "+b);b={id:e[1]||"",params:{}};if(e[2])for(var f=/([^=]+)\=([^;]+)\;?/g,g=f.exec(e[2]);g;){b.params[decodeURIComponent(g[1])]=decodeURIComponent(g[2]);g=f.exec(e[2])}return b}var y=a.strictArg,K=a.def,C=a.objectify,I=a.comm.Callback;a.nav.localhost=a.nav.$addChildNode(new a.LocalHost);a.nav.localhost.station=
a.nav.localhost.$addChildNode(new a.BoxComponentSpace("station","station:",a.nav.localhost));a.station=a.nav.localhost.station;var G=function(b){b=b||{};this.$scheme=b.scheme;this.$schemeName=b.schemeName;this.$body=b.body;this.$isHost=b.isHost||false;this.$isSession=b.isSession||false;for(var e in b)if(b.hasOwnProperty(e)&&typeof b[e]==="function")this[e]=b[e]}.$extend(U);G.prototype.getScheme=function(){return this.$scheme};G.prototype.getSchemeName=function(){return this.$schemeName};G.prototype.getBody=
function(){return this.$body};G.prototype.toString=function(){return this.getSchemeName()+":"+this.getBody()};G.prototype.isHost=function(){return this.$isHost};G.prototype.isSession=function(){return this.$isSession};G.prototype.normalize=function(){return false};var u=function(b){u.$super.apply(this,arguments);this.$list=b;this.$index=-1}.$extend(a.SyncCursor);u.prototype.hasNext=function(){return this.$index+1<this.$list.$queries.length};u.prototype.next=function(){if(this.hasNext()){this.$index++;
return true}else return false};u.prototype.get=function(){if(this.$index===-1)throw Error("Illegal cursor index");return this.$list.$queries[this.$index]};u.prototype.each=function(b){for(var e;this.next();)if(e=b(this.get(),this.$index))return e};u.prototype.getIndex=function(){return this.$index};u.prototype.getOrd=function(){return this.$list.toString(this.$index+1)};u.prototype.resolveNext=function(b,e){try{if(this.next()){var f=this.get();f.getScheme().resolve(b,f,this,e)}else e.callback.ok(b)}catch(g){e.callback.fail(g)}};
a.OrdQueryList=function(b){this.$queries=b||[]}.$extend(U);a.OrdQueryList.prototype.add=function(b){this.$queries.push(b);this.$hasUnknown=undefined};a.OrdQueryList.prototype.isEmpty=function(){return this.$queries.length===0};a.OrdQueryList.prototype.hasUnknown=function(){if(this.$hasUnknown!==undefined)return this.$hasUnknown;var b,e=false;for(b=0;b<this.$queries.length;++b)if(this.$queries[b].getScheme()instanceof a.UnknownScheme)e=true;return this.$hasUnknown=e};a.OrdQueryList.prototype.getCursor=
function(){return new u(this)};a.OrdQueryList.prototype.normalize=function(){if(!this.hasUnknown())for(;;){var b;a:{b=void 0;for(b=0;b<this.$queries.length;++b)if(this.$queries[b].normalize(this,b)){b=true;break a}b=false}if(!b)break}return this};a.OrdQueryList.prototype.toString=function(b){b=K(b,this.$queries.length);var e=[],f;for(f=0;f<b;++f)e.push(this.$queries[f].toString());return e.join("|")};a.OrdQueryList.prototype.get=function(b){var e=typeof b,f=this.$queries,g;if(e==="number")g=f[b];
else if(e==="string")for(e=0;e<f.length;++e)if(f[e].getSchemeName()===b){g=f[e];break}return g||null};a.OrdQueryList.prototype.set=function(b,e){if(b<0||b>this.$queries.length)throw Error("Invalid index ("+b+")");this.$queries[b]=e;this.$hasUnknown=undefined};a.OrdQueryList.prototype.remove=function(b){var e=null;if(b>=0&&b<this.$queries.length){e=this.$queries.splice(b,1)[0];this.$hasUnknown=undefined}return e};a.OrdQueryList.prototype.size=function(){return this.$queries.length};var o=function(b){this.base=
b||null;this.object=null;if(b&&typeof b==="object")b.next=this}.$extend(U);o.prototype.getComponent=function(){if(a.hasType(this.container)&&this.container.getType().isComponent())return this.container;else if(a.hasType(this.object))if(this.object.getType().isComponent())return this.object;else if(this.object.getType().isComplex()){for(var b=this.object.getParent();b!==null;){if(b.getType().isComponent())break;b=b.getParent()}if(b!==null)return b}if(this.base&&typeof this.base==="object")return this.base.getComponent();
return null};o.prototype.getObject=function(){var b=this.container,e=this.slot,f=this.propertyPath;if(b)if(f){if(f.length>0){e=b;for(b=0;b<f.length;++b)e=e.get(f[b]);return e}}else if(e&&e.isProperty())return b.get(e);return this.object};a.Ord=function(b){a.Ord.$super.apply(this,arguments);this.$ord=y(b,String)}.$extend(a.Simple);a.Ord.DEFAULT=new a.Ord("");a.Ord.make=function(b){if(arguments.length===0)return a.Ord.DEFAULT;b=typeof b==="object"&&b.base&&b.child?b.base.toString()+"|"+b.child.toString():
b.toString();if(b.match(/^\/ord/)){b=b.substring(5,b.length);b=decodeURI(b)}if(b===""||b==="null")return a.Ord.DEFAULT;return new a.Ord(b)};a.Ord.prototype.make=function(b){return a.Ord.make(b)};a.Ord.prototype.decodeFromString=function(b){return a.Ord.make(b)};a.Ord.prototype.encodeToString=function(){return this.$ord};a.Ord.registerType("baja:Ord");a.Ord.prototype.toString=function(){return this.$ord};a.Ord.prototype.valueOf=function(){return this.toString()};a.Ord.prototype.parse=function(){var b=
new a.OrdQueryList;if(this.$ord.length===0)return b;var e=this.$ord.split("|"),f,g,p,v;for(f=0;f<e.length;++f){g=e[f].indexOf(":");if(g===-1)throw Error("Unable to resolve ORD: "+e[f]);p=e[f].substring(0,g);v=e[f].substring(g+1,e[f].length);g=a.OrdScheme.lookup(p);b.add(g.parse(p,v))}return b};a.Ord.prototype.resolve=function(b){b=C(b,"ok");var e=K(b.base,a.nav.localhost),f=b.cb===undefined?new I(b.ok,b.fail):b.cb,g=K(b.subscriber,null),p=K(b.lease,false),v=b.leaseTime,B=K(b.full,false),r=b.cursor;
f.addOk(function(n,w,z){(w=z.getComponent())||(w=z.getObject());w!==null?n.call(w,z):n(z)});g!==null&&f.addOk(function(n,w,z){function D(){n(z)}var c=z.getComponent();c!==null&&c.isMounted()?g.subscribe({comps:[c],ok:D,fail:w,importAsync:true}):D()});p&&f.addOk(function(n,w,z){function D(){n(z)}var c=z.getComponent();c!==null&&c.isMounted()?c.lease({ok:D,fail:w,time:v,importAsync:true}):D()});try{if(b.batch)throw Error("Cannot batch ORD resolution");var F=this.parse();if(F.isEmpty())throw Error("Cannot resolve null ORD: "+
this.toString());var k=new o;k.object=e;p={full:B,callback:f,queries:F,ord:this,cursor:r};F.normalize();if(F.hasUnknown()){var m=new o(k);f.addOk(function(n,w,z){var D=function(){var s=m.object=a.bson.decodeValue(z.o,a.$serverDecodeContext);n(m);if(z.c&&a.hasType(s)&&s.getType().is("baja:ICollection")&&typeof s.cursor==="function"){r.$data=z.c;s.cursor(r)}},c=a.bson.scanForUnknownTypes(z);if(c.length>0){var i=new a.comm.Batch;a.importTypes({typeSpecs:c,ok:D,fail:w,batch:i});b.fromBatchResolve?i.commitSync():
i.commit()}else D()});if(p.cursor){p.cursor.limit=p.cursor.limit||10;p.cursor.offset=p.cursor.offset||0}a.comm.resolve(this,e,f,p)}else F.getCursor().resolveNext(k,p)}catch(A){f.fail(A)}};a.Ord.prototype.get=function(b){b=C(b,"ok");b.cb=new I(b.ok,b.fail);b.cb.addOk(function(e,f,g){e.call(this,g.getObject())});this.resolve(b)};a.Ord.prototype.normalize=function(){return a.Ord.make(this.parse().normalize())};a.Ord.prototype.relativizeToSession=function(){var b=this.parse().normalize(),e,f=new a.OrdQueryList,
g;for(g=0;g<b.size();++g){e=b.get(g);!e.isSession()&&!e.isHost()&&f.add(e)}return a.Ord.make(f)};a.Ord.prototype.toUri=function(){var b=encodeURI(this.relativizeToSession().toString());return b.match(/^http/i)?b:"/ord?"+b};a.OrdScheme=function(){a.OrdScheme.$super.apply(this,arguments)}.$extend(a.Singleton).registerType("baja:OrdScheme");a.OrdScheme.prototype.resolve=function(){throw Error("ORD Scheme must implement resolve: "+this.getType());};a.OrdScheme.lookup=function(b){return(b=a.registry.getOrdScheme(b))&&
b.hasConstructor()?b.getInstance():a.UnknownScheme.DEFAULT};a.OrdScheme.prototype.parse=function(b,e){return new G({scheme:this,schemeName:b,body:e})};a.UnknownScheme=function(){a.UnknownScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.UnknownScheme.DEFAULT=new a.UnknownScheme;a.UnknownScheme.prototype.resolve=function(b,e,f,g){new o(b);g.callback.fail("Unknown BajaScript ORD Scheme: "+e.getSchemeName())};a.HttpScheme=function(){a.HttpScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme).registerType("net:HttpScheme");
a.HttpScheme.DEFAULT=new a.HttpScheme;a.HttpScheme.prototype.resolve=function(b,e,f,g){f.resolveNext(new o(b),g)};a.HttpScheme.prototype.parse=function(b,e){return new G({scheme:this,schemeName:b,body:e,normalize:R})};a.LocalScheme=function(){a.LocalScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.LocalScheme.DEFAULT=new a.LocalScheme;a.LocalScheme.registerType("baja:LocalScheme");a.LocalScheme.prototype.resolve=function(b,e,f,g){b=new o(b);b.object=a.nav.localhost;f.resolveNext(b,g)};
a.LocalScheme.prototype.parse=function(b,e){return new G({scheme:this,schemeName:b,body:e,isHost:true,isSession:true,normalize:R})};a.FoxScheme=function(){a.FoxScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.FoxScheme.DEFAULT=new a.FoxScheme;a.FoxScheme.registerType("fox:FoxScheme");a.FoxScheme.prototype.resolve=function(b,e,f,g){e=new o(b);e.object=b.object;f.resolveNext(e,g)};a.FoxScheme.prototype.parse=function(b,e){return new G({scheme:this,schemeName:b,body:e,isSession:true,normalize:function(f,
g){var p,v,B=false;for(p=g-1;p>=0;--p){v=f.get(p);if(!v.isHost()){f.remove(p);B=true}}return B}})};a.StationScheme=function(){a.StationScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.StationScheme.DEFAULT=new a.StationScheme;a.StationScheme.registerType("baja:StationScheme");a.StationScheme.prototype.resolve=function(b,e,f,g){e=new o(b);e.object=b.object;if(!e.object.getType().is("baja:ComponentSpace"))e.object=a.nav.localhost.station;f.resolveNext(e,g)};a.StationScheme.prototype.parse=
function(b,e){return new G({scheme:this,schemeName:b,body:e,normalize:function(f,g){var p,v,B=false;for(p=g-1;p>=0;--p){v=f.get(p);if(!v.isHost()&&!v.isSession()){f.remove(p);B=true}}return B}})};a.SlotScheme=function(){a.SlotScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.SlotScheme.DEFAULT=new a.SlotScheme;a.SlotScheme.registerType("baja:SlotScheme");var q=function(){};a.SlotScheme.prototype.resolve=function(b,e,f,g,p){g.full?V(this,b,e,f,g,p):T(this,b,e,f,g,p)};a.SlotScheme.prototype.parse=
function(b,e){return new a.SlotPath(e)};a.SlotPath=function(b){a.SlotPath.$super.call(this,{scheme:a.SlotScheme.DEFAULT,schemeName:"slot",body:y(b,String)});this.$abs=false;this.$names=[];this.$backupDepth=0;this.$names=[];this.$abs=false;if(this.getBody().length!==0){b=0;var e=this.getBody().charAt(0);if(e==="/"){this.$abs=true;b=1}else if(e===".")b:{b=this.getBody();e=b.length;var f,g,p,v;for(v=0;v<e;v+=3){f=b.charAt(v);g=v+1<e?b.charAt(v+1):-1;p=v+2<e?b.charAt(v+2):"/";if(f!=="."){b=v;break b}if(g!==
"."||p!=="/"){if(this.isValidPathName(f)){b=v;break b}throw Error("Expecting ../ backup");}this.$backupDepth++}b=e}g=b;b=this.getBody();e=b.length;if(!(g>=e)){if(b.charAt(e-1)==="/")throw Error("Invalid Slot Path - Trailing Slash");for(f=g;f<e;++f){p=b.charAt(f);if(p==="/"){if(f===g)throw Error("Invalid Slot Path - Double Slashes");g=b.substring(g,f);if(!this.isValidPathName(g))throw Error("Invalid name in path");this.$names.push(g);g=f+1}}g=b.substring(g,e);if(!this.isValidPathName(g))throw Error("Invalid name in path");
this.$names.push(g)}}}.$extend(G);a.SlotPath.prototype.makeSlotPath=function(b){return new a.SlotPath(b)};a.SlotPath.prototype.depth=function(){return this.$names.length};a.SlotPath.prototype.getBackupDepth=function(){return this.$backupDepth};a.SlotPath.prototype.nameAt=function(b){a.strictArg(b,Number);return this.$names[b]};a.SlotPath.prototype.isAbsolute=function(){return this.$abs};a.SlotPath.prototype.isValidPathName=function(b){return a.SlotPath.isValidName(b)};a.SlotPath.isValidName=function(b){return/^([a-zA-Z$]([a-zA-Z0-9_]|(\$([0-9a-fA-F]{2}))|(\$u([0-9a-fA-F]{4})))*)$/.test(b)};
a.SlotPath.verifyValidName=function(b){if(!a.SlotPath.isValidName(b))throw Error("Illegal name for Slot: "+b);};a.SlotPath.escape=function(b){if(b.length===0)return b;var e=b.charAt(0).replace(/[^a-zA-Z]/,function(f){return O(f)});if(b.length>1)e+=b.substring(1,b.length).replace(/[^a-zA-Z0-9_]/g,function(f){return O(f)});return e};a.SlotPath.unescape=function(b){if(b.length===0)return b;b=b.replace(/\$[0-9a-fA-F]{2}/g,function(e){return String.fromCharCode(parseInt(e.substring(1,e.length),16))});
return b=b.replace(/\$u[0-9a-fA-F]{4}/g,function(e){return String.fromCharCode(parseInt(e.substring(2,e.length),16))})};a.SlotPath.prototype.merge=function(b){if(b.isAbsolute())return b.getBody();var e="";if(this.isAbsolute())e+="/";if(b.getBackupDepth()>0&&b.getBackupDepth()>this.depth()){if(this.isAbsolute())throw Error("Invalid merge "+this+" + "+b);var f=b.getBackupDepth()-this.depth()+this.getBackupDepth(),g;for(g=0;g<f;++g)e+="../"}f=false;for(g=0;g<this.depth()-b.getBackupDepth();++g){if(f)e+=
"/";else f=true;e+=this.nameAt(g)}for(g=0;g<b.depth();++g){if(f)e+="/";else f=true;e+=b.nameAt(g)}return e};a.SlotPath.prototype.normalize=function(b,e){var f=b.get(e),g=b.get(e+1),p=false;if(g&&g.getSchemeName()===f.getSchemeName()){f=this.makeSlotPath(this.makeSlotPath(f.getBody()).merge(this.makeSlotPath(g.getBody())));b.set(e,f);b.remove(e+1);p=true}return p};a.HandleScheme=function(){a.HandleScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.HandleScheme.DEFAULT=new a.HandleScheme;a.HandleScheme.registerType("baja:HandleScheme");
a.HandleScheme.prototype.resolve=function(b,e,f,g){var p=b.object;e=e.getBody();var v;if(a.hasType(p))if(p.getType().isComponent())v=p.getComponentSpace();else{if(p.getType().is("baja:ComponentSpace"))v=p}else throw Error("Not based via ComponentSpace. Invalid Object");if(!a.hasType(v))throw Error("Not based via ComponentSpace");v.resolveByHandle({handle:e,ok:function(B){var r=new o(b);r.object=B;f.resolveNext(r,g)},fail:function(B){g.callback.fail(B)}})};a.ServiceScheme=function(){a.ServiceScheme.$super.apply(this,
arguments)}.$extend(a.OrdScheme);a.ServiceScheme.DEFAULT=new a.ServiceScheme;a.ServiceScheme.registerType("baja:ServiceScheme");a.ServiceScheme.prototype.resolve=function(b,e,f,g){var p=b.object;e=e.getBody();var v;if(a.hasType(p))if(p.getType().isComponent())v=p.getComponentSpace();else if(p.getType().is("baja:ComponentSpace"))v=p;else{if(p.getType().is("baja:ISession")&&p.station)v=p.station}else throw Error("Not based via ComponentSpace. Invalid Object");if(!a.hasType(v))throw Error("Not based via ComponentSpace");
p=function(r){var F=new o(b);F.object=r;f.resolveNext(F,g)};var B=function(r){g.callback.fail(r)};if(v.hasCallbacks())v.getCallbacks().getService(e,new I(p,B));else throw Error("Unable to resolve Service: "+e);};a.ViewScheme=function(){a.ViewScheme.$super.apply(this,arguments)}.$extend(a.OrdScheme);a.ViewScheme.DEFAULT=new a.ViewScheme;a.ViewScheme.registerType("baja:ViewScheme");a.ViewScheme.prototype.resolve=function(b,e,f,g){b.view={id:e.getViewId(),params:e.getParameters()};f.resolveNext(b,g)};
a.ViewScheme.prototype.parse=function(b,e){return new a.ViewQuery(e)};a.ViewQuery=function(b){if(b&&typeof b==="object"){var e=b.params||{};this.$view={id:b.id||"",params:e};var f=0;b=this.$view.id;a.iterate(e,function(g,p){if(f===0)b+="?";else if(f>0)b+=";";b+=encodeURIComponent(p)+"="+encodeURIComponent(g);++f})}else this.$view=Q(b);a.ViewQuery.$super.call(this,{scheme:a.ViewScheme.DEFAULT,schemeName:"view",body:y(b,String)})}.$extend(G);a.ViewQuery.prototype.normalize=function(b,e){var f=false;
if(b.get(e+1)&&b.get(e+1).getSchemeName().equals("view")){b.remove(e+1);f=true}else if(e<b.size()-1){b.remove(e);f=true}return f};a.ViewQuery.prototype.getViewId=function(){return this.$view.id};a.ViewQuery.prototype.getParameters=function(){var b={};a.iterate(this.$view.params,function(e,f){b[f]=e});return b};(function(){function b(n,w){function z(){c++;c===D?w():a.runAsync(function(){n[c]({ok:z,fail:z})})}var D=n.length,c=-1;z()}function e(n){var w=[];n=n.$groups;var z,D,c,i;for(c=0;c<n.length;c++){z=
n[c].items;for(i=0;i<z.length;i++)if(D=z[i].target)(D=D.getComponent())&&D.isMounted()&&D.getComponentSpace().hasCallbacks()&&w.push(D)}return w}function f(n,w){var z=new a.comm.Batch,D=[],c=w.subscriber,i=w.lease;if(c||i){D=e(n);if(D.length>0){c&&c.subscribe({comps:D,batch:z});i&&a.Component.lease({comps:D,time:w.leaseTime,batch:z})}}z.addCallback(function(){var s,x;for(x=0;x<n.$items.length;++x)if(!n.$items[x].target){s=n.$items[x].fail||Error("Unresolved ORD");break}s?n.$fail.call(n,s):n.$ok.call(n)});
z.commit()}function g(n,w){var z=[];a.iterate(n.$items,function(D){z.push(function(c){D.unknown?c.ok():D.ord.resolve({ok:function(i){D.target=i;c.ok()},fail:function(i){D.fail=i;c.fail(i)}})})});b(z,function(){f(n,w)})}function p(n,w){var z=w instanceof a.VirtualPath,D,c;for(c=0;c<w.depth();++c){D=w.nameAt(c);if(z)D=a.SlotPath.escape(D);D=n.getSlot(D);if(D===null)return c;if(!D.isProperty())break;if(!D.getType().isComponent())break;n=n.get(D)}return-1}function v(n,w,z){var D="slot:/",c=w instanceof
a.VirtualPath,i,s,x,E;for(E=0;E<w.depth();E++){i=w.nameAt(E);s=D;x=c?a.SlotPath.escape(i):i;if(E>=z){i=s+"/"+x;n.hasOwnProperty(i)||(n[i]={o:s,sn:x})}if(E>0)D+="/";D+=x}}function B(n,w,z){var D=n.$groups,c,i,s,x,E,L=[],S={},Y=z.subscriber?[]:null,Z,ca;for(Z=0;Z<D.length;Z++){c=D[Z];i=c.items;s=c.space.getRootComponent();for(ca=0;ca<i.length;ca++)if(x=i[ca].slot){Y&&Y.push(x.toString());E=p(s,x);E>-1&&v(S,x,E)}}a.iterate(S,function(ha){L.push(ha)});if(L.length>0){c.space.getCallbacks().loadSlotPath(L,
c.space,new I(a.ok,a.fail,w),false);Y&&z.subscriber.$ordSubscribe({ords:Y,space:c.space,batch:w})}w.addCallback(function(){g(n,z)});w.commit()}function r(n,w,z){a.iterate(n.$items,function(D){var c=D.h,i=D.space;c&&i&&i.hasCallbacks()&&i.findByHandle(c)===null&&i.getCallbacks().handleToPath(c,new I(function(s){D.slot=s},function(s){D.fail=s},w))});w.addCallback(function(){B(n,n.$unknownBatch||new a.comm.Batch,z)});w.commit()}function F(n,w,z){var D=[];a.iterate(n.$items,function(c){var i=c.spaceOrd;
i&&D.push(function(s){var x=i.toString();if(x==="station:"||x==="local:|station:"){c.space=a.station;c.spaceOrd=a.station.getNavOrd();return s.ok()}i.get({ok:function(E){if(E.getType().is("baja:ComponentSpace")){E=c.space=E;c.spaceOrd=E.getNavOrd()}else if(this.getType().is("baja:VirtualGateway")){E=c.space=this.getVirtualSpace();c.spaceOrd=E.getNavOrd()}else if(this.getType().is("baja:Component")){E=c.space=this.getComponentSpace();c.spaceOrd=E.getNavOrd()}s.ok()},fail:function(E){a.error(E);s.fail(E)},
base:z.base})})});b(D,function(){var c,i,s,x,E;for(x=0;x<n.$items.length;++x){i=n.$items[x];c=false;if(i.space)if(i.space.hasCallbacks()){for(E=0;E<n.$groups.length;++E){s=n.$groups[E];if(s.space.getNavOrd().toString().equals(i.spaceOrd.toString())){s.items.push(i);c=true;break}}c||n.$groups.push({space:i.space,items:[i]})}}r(n,new a.comm.Batch,z)})}function k(n,w){var z=n.getSchemeName()==="virtual",D=z?new a.VirtualPath(n.getBody()):new a.SlotPath(n.getBody());if(D.isAbsolute())return D;if(w.base.getType().isComponent()&&
!z){var c=w.base.getSlotPath();if(c!==null){D=c.merge(D);return z?new a.VirtualPath(D):new a.SlotPath(D)}}return null}function m(n,w,z){z=new I(function(D){n.target=D},function(D){n.fail=D},z);n.ord.resolve({cb:z,base:w.base,fromBatchResolve:true})}function A(n,w){var z,D,c,i,s,x;for(x=0;x<n.$items.length;++x){D=n.$items[x];z=D.list=D.ord.parse();if(z.hasUnknown()){D.unknown=true;if(!n.$unknownBatch)n.$unknownBatch=new a.comm.Batch;m(D,w,n.$unknownBatch)}else{c=z.getCursor();for(i=-1;c.next();){s=
c.get();if(s.getSchemeName()==="virtual"){i=c.getIndex();D.slot=k(s,w);break}else if(s.getSchemeName()==="h"&&i===-1){i=c.getIndex();D.h=s.getBody()}else if(s.getSchemeName()==="slot"&&i===-1){i=c.getIndex();D.slot=k(s,w)}}if(i!==-1){D.spaceOrd=a.Ord.make(z.toString(i));if(D.spaceOrd===a.Ord.DEFAULT)D.spaceOrd=w.base.getNavOrd()}}}F(n,0,w)}a.BatchResolve=function(n){a.BatchResolve.$super.apply(this,arguments);y(n,Array);var w=[],z;for(z=0;z<n.length;++z)w.push({ord:a.Ord.make(n[z].toString()).normalize(),
target:null});this.$items=w;this.$groups=[];this.$ok=a.ok;this.$fail=a.fail;this.$resolved=false}.$extend(U);a.BatchResolve.prototype.size=function(){return this.$items.length};a.BatchResolve.prototype.getOrd=function(n){y(n,Number);return(n=this.$items[n])?n.ord:null};a.BatchResolve.prototype.isResolved=function(n){y(n,Number);return(n=this.$items[n])&&n.target?true:false};a.BatchResolve.prototype.getFail=function(n){y(n,Number);return(n=this.$items[n])&&n.fail?n.fail:null};a.BatchResolve.prototype.getTarget=
function(n){y(n,Number);if((n=this.$items[n])&&n.target)return n.target;else throw n&&n.fail?n.fail:Error("Unresolved ORD");};a.BatchResolve.prototype.getTargets=function(){var n=[],w;for(w=0;w<this.$items.length;++w)n.push(this.getTarget(w));return n};a.BatchResolve.prototype.getTargetObjects=function(){var n=[],w;for(w=0;w<this.$items.length;++w)n.push(this.get(w));return n};a.BatchResolve.prototype.get=function(n){return this.getTarget(n).getObject()};a.BatchResolve.prototype.each=function(n){y(n,
Function);var w,z,D,c;for(D=0;D<this.$items.length;++D){w=this.getTarget(D);try{(c=w.getComponent())||(c=w.getObject());if(z=n.call(c,w.getObject(),D))return z}catch(i){a.error(i)}}};a.BatchResolve.prototype.resolve=function(n){n=C(n);var w=n.ok||a.ok;this.$ok=function(){var z;if(typeof n.each==="function")try{z=this.each(n.each)}catch(D){a.error()}w.call(this,z)};this.$fail=n.fail||a.fail;if(this.$resolved)this.$fail.call(this,"Cannot call resolve more than once");else{this.$resolved=true;n.base=
K(n.base,a.nav.localhost);if(n.batch)this.$fail.call(this,"Cannot batch ORD resolution");else this.$items.length>0?A(this,n):this.$ok.call(this)}}})()})(baja,BaseBajaObj);
(function(a){function U(y){for(var K in y)if(y.hasOwnProperty(K))return false;return true}function R(y,K,C){var I=typeof K;if(I==="undefined")return O.call(y);else if(K&&I==="object")K=K.getName();else if(I!=="string")throw Error("Invalid Column name: "+K);y=O.call(y);if(y!==null)return C?y.getDisplay(K):y.get(K);return null}var T=a.strictArg;a.coll=new BaseBajaObj;var V=function(y,K){V.$super.apply(this,arguments);this.$collection=y;this.$curData=K;this.$index=-1;this.$after=this.$before=a.noop}.$extend(a.AsyncCursor);
V.prototype.getCollection=function(){return this.$collection};var O=function(){return this.$curData[this.$index]||null};V.prototype.get=O;V.prototype.before=function(y){T(y,Function);this.$before=y};V.prototype.after=function(y){T(y,Function);this.$after=y};V.prototype.each=function(y){T(y,Function);this.$index=-1;var K=this.$curData.length,C,I;this.$before.call(this,this);for(C=0;C<K;++C){++this.$index;if(I=y.call(this,this.get(),this.$index))break}this.$after.call(this,this)};a.coll.Collection=
function(y){a.coll.Collection.$super.apply(this,arguments);this.$collData=y;this.$Cursor=V}.$extend(a.Simple);a.coll.Collection.DEFAULT=new a.coll.Collection({});a.coll.Collection.make=function(y){if(U(y))return a.coll.Collection.DEFAULT;return new a.coll.Collection(y)};a.coll.Collection.prototype.make=function(y){return a.coll.Collection.make(y)};a.coll.Collection.prototype.decodeFromString=function(y){return a.coll.Collection.make(JSON.parse(y))};a.coll.Collection.prototype.encodeToString=function(){return JSON.stringify(this.$collData)};
a.coll.Collection.registerType("box:BoxCollection");a.coll.Collection.prototype.cursor=function(y){y=a.objectify(y,"each");var K=new a.comm.Callback(y.ok,y.fail,y.batch),C=this;K.addOk(function(I,G,u){var o=function(){var e;for(e=0;e<u.length;++e)u[e]=a.bson.decodeValue(u[e],a.$serverDecodeContext);e=new C.$Cursor(C,u);typeof y.before==="function"&&e.before(y.before);typeof y.after==="function"&&e.after(y.after);typeof y.each==="function"&&e.each(y.each);I(e)};if(y.$data)o();else{var q=a.bson.scanForUnknownTypes(u);
if(q.length>0){var b=new a.comm.Batch;a.importTypes({typeSpecs:q,ok:o,fail:G,batch:b});K.getBatch().isAsync()?b.commit():b.commitSync()}else o()}});y.limit=y.limit||10;y.offset=y.offset||0;y.$data?K.ok(y.$data):a.comm.cursor(this.$collData.req,K,y)};var Q=function(y){Q.$super.apply(this,arguments);this.$collection=y}.$extend(V);Q.prototype.get=function(y){return R(this,y,false)};Q.prototype.getDisplay=function(y){return R(this,y,true)};a.coll.Table=function(y){a.coll.Table.$super.apply(this,arguments);
this.$tableData=y;this.$Cursor=Q}.$extend(a.coll.Collection);a.coll.Table.DEFAULT=new a.coll.Table({});a.coll.Table.make=function(y){if(U(y))return a.coll.Table.DEFAULT;return new a.coll.Table(y)};a.coll.Table.prototype.make=function(y){return a.coll.Table.make(y)};a.coll.Table.prototype.decodeFromString=function(y){return a.coll.Table.make(JSON.parse(y))};a.coll.Table.prototype.encodeToString=function(){return JSON.stringify(this.$tableData)};a.coll.Table.registerType("box:BoxTable");a.coll.Table.prototype.getColumns=
function(){var y=[],K=this.$tableData.cols,C;for(C=0;C<K.length;++C)y.push(this.getCol(K[C].n));return y};a.coll.Table.prototype.getCol=function(y){T(y);var K=typeof y,C=this.$tableData.cols,I;if(K==="number")I=C[y];else if(K==="string")for(K=0;K<C.length;++K)if(C[K].n===y){I=C[K];break}if(!I)return null;return{getName:function(){return I.n},getDisplayName:function(){return I.dn},getType:function(){return a.lt(I.t)},getFlags:function(){return I.f},getFacets:function(){return a.Facets.DEFAULT.decodeFromString(I.x)}}}})(baja);
(function(a){a.VirtualComponentSpace=function(U){a.VirtualComponentSpace.$super.call(this,"virtual");this.$gateway=a.strictArg(U)}.$extend(a.BoxComponentSpace).registerType("baja:VirtualComponentSpace");a.VirtualComponentSpace.prototype.getAbsoluteOrd=function(){return a.Ord.make(this.$gateway.getNavOrd().toString()+"|virtual:")};a.VirtualComponentSpace.prototype.$fw=function(U,R){if(U==="unmount"){var T=R.getParent();if(T)T.$bPropsLoaded=false}a.VirtualComponentSpace.$super.prototype.$fw.apply(this,
arguments)};a.VirtualComponent=function(){a.VirtualComponent.$super.apply(this,arguments)}.$extend(a.Component).registerType("baja:VirtualComponent");a.VirtualComponent.prototype.getNavOrd=function(){if(!this.isMounted())return null;var U=this.$space.getAbsoluteOrd(),R="/",T=this.getSlotPath(),V;for(V=0;V<T.depth();++V){if(V>0)R+="/";R+=a.SlotPath.unescape(T.nameAt(V))}return a.Ord.make(U.toString()+R)};a.VirtualGateway=function(){a.VirtualGateway.$super.apply(this,arguments);this.$virtualSpace=null}.$extend(a.Component).registerType("baja:VirtualGateway");
a.VirtualGateway.prototype.$fw=function(U){if(U==="loadVirtualSpace"){var R=new a.comm.Callback;if(this.$virtualSpace)R.ok();else try{this.$virtualSpace=new a.VirtualComponentSpace(this);this.$virtualSpace.init(R.getBatch());R.commitSync()}catch(T){R.fail(T)}}else return a.VirtualGateway.$super.prototype.$fw.apply(this,arguments)};a.VirtualGateway.prototype.getVirtualSpace=function(){this.$virtualSpace===null&&this.$fw("loadVirtualSpace");return this.$virtualSpace};a.VirtualGateway.prototype.loadSlots=
function(){this.getVirtualSpace();a.VirtualGateway.$super.prototype.loadSlots.apply(this,arguments)};a.VirtualGateway.prototype.getNavChildren=function(U){var R=this.getVirtualSpace();R?R.getRootComponent().getNavChildren(U):a.VirtualGateway.$super.prototype.getNavChildren(U)};a.VirtualPath=function(){a.VirtualPath.$super.apply(this,arguments)}.$extend(new a.SlotPath(""));a.VirtualPath.prototype.makeSlotPath=function(U){return new a.VirtualPath(U)};a.VirtualPath.prototype.isValidPathName=function(U){return a.VirtualPath.isValidName(U)};
a.VirtualPath.isValidName=function(U){return/^[^\/\|\$\:]+$/.test(U)};a.VirtualPath.prototype.getSchemeName=function(){return"virtual"};a.VirtualPath.prototype.getScheme=function(){return a.VirtualScheme.DEFAULT};a.VirtualScheme=function(){a.VirtualScheme.$super.apply(this,arguments)}.$extend(a.SlotScheme);a.VirtualScheme.DEFAULT=new a.VirtualScheme;a.VirtualScheme.registerType("baja:VirtualScheme");a.VirtualScheme.prototype.parse=function(U,R){return new a.VirtualPath(R)}})(baja);
(function(){function a(V){var O=function(){if(T)return false;if(document&&document.getElementsByTagName&&document.getElementById&&document.body){clearInterval(U);U=null;var Q;for(Q=0;Q<R.length;++Q)R[Q]();R=null;T=true}};if(T)V();else if(typeof U==="number")R.push(V);else{if(document&&document.addEventListener)document.addEventListener("DOMContentLoaded",O,false);else window.onload=O;R=[V];U=setInterval(O,13)}}var U,R,T;if(!baja.comm)throw Error("comm.js required");(function(){function V(Q,y,K,C,
I,G){var u=null,o,q=false;o=function(){var p;if(u.readyState===4)try{p=parseInt(u.status,10);p!==200&&!baja.isStopping()?C.fail(new baja.comm.HttpError(u)):C.ok(u.responseText)}catch(v){C.fail(v)}finally{u.onreadystatechange=baja.ok;u=null}};try{try{u=new XMLHttpRequest}catch(b){try{u=new ActiveXObject("Msxml2.XMLHTTP");q=true}catch(e){try{u=new ActiveXObject("Microsoft.XMLHTTP");q=true}catch(f){throw Error("Failed to create XMLHttpRequest: "+f);}}}u.open(Q,y,K);G&&u.setRequestHeader("Content-Type",
G);q===undefined&&u.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");if(K)u.onreadystatechange=o;u.send(I)}catch(g){C.fail(g);return}!K&&u!==null&&o.call(u)}var O=baja.comm.start;baja.comm.start=function(Q){var y=Q.started||baja.ok;Q.started=function(){a(y)};O(Q)};baja.comm.reconnect=function(){baja.clock.schedule(function(){location&&location.reload&&location.reload(false)},2500)};baja.comm.HttpError=function(Q){var y=Q.responseText||"Session disconnected",K=Q.status;this.name=
"HttpError";this.message=y+" err: "+Q.status;this.status=K;this.delayReconnect=!K||K===404}.$extend(baja.comm.ServerError);baja.comm.BoxFrame.prototype.send=function(Q,y){V("post","/box/",Q,y,this.toString(),"application/json")}})();(function(){var V=baja.outln,O=baja.clearOut,Q=baja.error;baja.outln=function(y){if(baja.isStopping())return this;var K,C;y+="\n";if(document&&document.getElementById){K=document.getElementById("bajaScriptOut");if(K!==null){C=y.replace(/</g,"(").replace(/>/g,")");C=C.replace(/\n/g,
"\r\n");K.appendChild(document.createTextNode(C))}}window.console&&window.console.log&&window.console.log(y);return V.call(this,y)};baja.clearOut=function(){if(document&&document.getElementById){var y=document.getElementById("bajaScriptOut");if(y!==null)y.innerHTML=""}return O.apply(this,arguments)};baja.error=function(y){if(baja.isStopping())return this;window.console&&window.console.error&&window.console.error(y);return Q.apply(this,arguments)}})();(function(){baja.registry.clearStorage=function(){if(window.localStorage)try{window.localStorage.removeItem("bajaScriptReg")}catch(V){}};
baja.registry.saveToStorage=function(V){if(V&&window.localStorage)try{window.localStorage.setItem("bajaScriptReg",JSON.stringify(V))}catch(O){baja.registry.clearStorage()}};baja.registry.loadFromStorage=function(){var V=null;if(window.localStorage)try{if(V=window.localStorage.getItem("bajaScriptReg"))V=JSON.parse(V)}catch(O){baja.registry.clearStorage()}return V}})()})();